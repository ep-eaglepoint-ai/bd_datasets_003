services:
  repository-after:
    build: .
    working_dir: /app
    command: bash -c "cd /app/repository_after && mvn clean install -DskipTests -q && mkdir -p /app/repository_after/target/test-classes && javac -cp /app/repository_after/target/crane-sync-orchestrator-1.0.0.jar:/app/libs/junit-platform-console-standalone-1.10.0.jar -d /app/repository_after/target/test-classes /app/tests/*.java && java -jar /app/libs/junit-platform-console-standalone-1.10.0.jar execute --class-path /app/repository_after/target/test-classes:/app/repository_after/target/crane-sync-orchestrator-1.0.0.jar --scan-class-path"
    volumes:
      - ./repository_after:/app/repository_after
      - ./tests:/app/tests
      - maven-cache:/root/.m2

  evaluation:
    build: .
    working_dir: /app
    command: bash -c "cd /app/repository_after && mvn clean install -DskipTests -q && mkdir -p /app/repository_after/target/test-classes /app/repository_after/target/eval-classes && javac -cp /app/repository_after/target/crane-sync-orchestrator-1.0.0.jar:/app/libs/junit-platform-console-standalone-1.10.0.jar -d /app/repository_after/target/test-classes /app/tests/*.java && java -jar /app/libs/junit-platform-console-standalone-1.10.0.jar execute --class-path /app/repository_after/target/test-classes:/app/repository_after/target/crane-sync-orchestrator-1.0.0.jar --scan-class-path > /tmp/test-output.txt 2>&1; cat /tmp/test-output.txt; javac -cp /app/repository_after/target/crane-sync-orchestrator-1.0.0.jar -d /app/repository_after/target/eval-classes /app/evaluation/Evaluation.java && java -cp /app/repository_after/target/eval-classes:/app/repository_after/target/crane-sync-orchestrator-1.0.0.jar Evaluation /tmp/test-output.txt"
    volumes:
      - ./repository_after:/app/repository_after
      - ./tests:/app/tests
      - ./evaluation:/app/evaluation
      - maven-cache:/root/.m2

volumes:
  maven-cache: