diff --git a/repository_after/coverage/clover.xml b/repository_after/coverage/clover.xml
new file mode 100644
index 0000000..67e6526
--- /dev/null
+++ b/repository_after/coverage/clover.xml
@@ -0,0 +1,570 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<coverage generated="1770281834358" clover="3.2.0">
+  <project timestamp="1770281834359" name="All files">
+    <metrics statements="552" coveredstatements="537" conditionals="103" coveredconditionals="93" methods="22" coveredmethods="22" elements="677" coveredelements="652" complexity="0" loc="552" ncloc="552" packages="1" files="4" classes="4"/>
+    <file name="InventoryService.ts" path="/app/repository_before/services/InventoryService.ts">
+      <metrics statements="123" coveredstatements="117" conditionals="21" coveredconditionals="18" methods="7" coveredmethods="7"/>
+      <line num="1" count="1" type="stmt"/>
+      <line num="2" count="1" type="stmt"/>
+      <line num="3" count="1" type="stmt"/>
+      <line num="4" count="1" type="stmt"/>
+      <line num="5" count="1" type="stmt"/>
+      <line num="6" count="1" type="stmt"/>
+      <line num="7" count="1" type="stmt"/>
+      <line num="8" count="1" type="stmt"/>
+      <line num="9" count="1" type="stmt"/>
+      <line num="10" count="1" type="cond" truecount="1" falsecount="0"/>
+      <line num="11" count="27" type="stmt"/>
+      <line num="12" count="27" type="stmt"/>
+      <line num="13" count="27" type="stmt"/>
+      <line num="14" count="1" type="stmt"/>
+      <line num="15" count="1" type="cond" truecount="1" falsecount="0"/>
+      <line num="16" count="45" type="stmt"/>
+      <line num="17" count="45" type="stmt"/>
+      <line num="18" count="45" type="stmt"/>
+      <line num="19" count="45" type="stmt"/>
+      <line num="20" count="45" type="stmt"/>
+      <line num="21" count="45" type="cond" truecount="1" falsecount="0"/>
+      <line num="22" count="1" type="stmt"/>
+      <line num="23" count="1" type="stmt"/>
+      <line num="24" count="44" type="cond" truecount="1" falsecount="0"/>
+      <line num="25" count="44" type="stmt"/>
+      <line num="26" count="44" type="stmt"/>
+      <line num="27" count="44" type="stmt"/>
+      <line num="28" count="44" type="stmt"/>
+      <line num="29" count="44" type="stmt"/>
+      <line num="30" count="1" type="stmt"/>
+      <line num="31" count="1" type="cond" truecount="1" falsecount="0"/>
+      <line num="32" count="82" type="stmt"/>
+      <line num="33" count="82" type="cond" truecount="2" falsecount="0"/>
+      <line num="34" count="82" type="stmt"/>
+      <line num="35" count="1" type="stmt"/>
+      <line num="36" count="1" type="cond" truecount="1" falsecount="0"/>
+      <line num="37" count="25" type="stmt"/>
+      <line num="38" count="25" type="stmt"/>
+      <line num="39" count="25" type="stmt"/>
+      <line num="40" count="25" type="cond" truecount="1" falsecount="0"/>
+      <line num="41" count="4" type="cond" truecount="1" falsecount="0"/>
+      <line num="42" count="4" type="stmt"/>
+      <line num="43" count="4" type="stmt"/>
+      <line num="44" count="21" type="cond" truecount="1" falsecount="0"/>
+      <line num="45" count="21" type="stmt"/>
+      <line num="46" count="21" type="stmt"/>
+      <line num="47" count="21" type="stmt"/>
+      <line num="48" count="25" type="cond" truecount="1" falsecount="0"/>
+      <line num="49" count="3" type="stmt"/>
+      <line num="50" count="3" type="stmt"/>
+      <line num="51" count="18" type="cond" truecount="1" falsecount="0"/>
+      <line num="52" count="18" type="stmt"/>
+      <line num="53" count="18" type="stmt"/>
+      <line num="54" count="18" type="stmt"/>
+      <line num="55" count="18" type="stmt"/>
+      <line num="56" count="18" type="stmt"/>
+      <line num="57" count="18" type="stmt"/>
+      <line num="58" count="18" type="stmt"/>
+      <line num="59" count="18" type="cond" truecount="1" falsecount="0"/>
+      <line num="60" count="21" type="stmt"/>
+      <line num="61" count="21" type="stmt"/>
+      <line num="62" count="25" type="stmt"/>
+      <line num="63" count="1" type="stmt"/>
+      <line num="64" count="1" type="cond" truecount="1" falsecount="0"/>
+      <line num="65" count="12" type="stmt"/>
+      <line num="66" count="12" type="stmt"/>
+      <line num="67" count="12" type="stmt"/>
+      <line num="68" count="12" type="stmt"/>
+      <line num="69" count="12" type="stmt"/>
+      <line num="70" count="12" type="stmt"/>
+      <line num="71" count="12" type="stmt"/>
+      <line num="72" count="12" type="stmt"/>
+      <line num="73" count="12" type="stmt"/>
+      <line num="74" count="12" type="stmt"/>
+      <line num="75" count="12" type="stmt"/>
+      <line num="76" count="12" type="stmt"/>
+      <line num="77" count="12" type="stmt"/>
+      <line num="78" count="12" type="stmt"/>
+      <line num="79" count="12" type="cond" truecount="0" falsecount="1"/>
+      <line num="80" count="0" type="stmt"/>
+      <line num="81" count="0" type="stmt"/>
+      <line num="82" count="12" type="stmt"/>
+      <line num="83" count="12" type="stmt"/>
+      <line num="84" count="12" type="stmt"/>
+      <line num="85" count="12" type="stmt"/>
+      <line num="86" count="12" type="stmt"/>
+      <line num="87" count="12" type="cond" truecount="0" falsecount="1"/>
+      <line num="88" count="0" type="stmt"/>
+      <line num="89" count="0" type="stmt"/>
+      <line num="90" count="12" type="stmt"/>
+      <line num="91" count="12" type="stmt"/>
+      <line num="92" count="12" type="stmt"/>
+      <line num="93" count="12" type="stmt"/>
+      <line num="94" count="1" type="stmt"/>
+      <line num="95" count="1" type="cond" truecount="1" falsecount="0"/>
+      <line num="96" count="8" type="stmt"/>
+      <line num="97" count="8" type="stmt"/>
+      <line num="98" count="8" type="stmt"/>
+      <line num="99" count="8" type="cond" truecount="1" falsecount="0"/>
+      <line num="100" count="4" type="stmt"/>
+      <line num="101" count="4" type="cond" truecount="0" falsecount="1"/>
+      <line num="102" count="0" type="stmt"/>
+      <line num="103" count="0" type="stmt"/>
+      <line num="104" count="4" type="stmt"/>
+      <line num="105" count="4" type="stmt"/>
+      <line num="106" count="4" type="stmt"/>
+      <line num="107" count="4" type="stmt"/>
+      <line num="108" count="4" type="stmt"/>
+      <line num="109" count="4" type="stmt"/>
+      <line num="110" count="4" type="stmt"/>
+      <line num="111" count="4" type="stmt"/>
+      <line num="112" count="4" type="stmt"/>
+      <line num="113" count="8" type="stmt"/>
+      <line num="114" count="1" type="stmt"/>
+      <line num="115" count="1" type="cond" truecount="1" falsecount="0"/>
+      <line num="116" count="1" type="stmt"/>
+      <line num="117" count="1" type="stmt"/>
+      <line num="118" count="1" type="stmt"/>
+      <line num="119" count="1" type="stmt"/>
+      <line num="120" count="1" type="stmt"/>
+      <line num="121" count="1" type="stmt"/>
+      <line num="122" count="1" type="stmt"/>
+      <line num="123" count="1" type="stmt"/>
+    </file>
+    <file name="OrderService.ts" path="/app/repository_before/services/OrderService.ts">
+      <metrics statements="270" coveredstatements="262" conditionals="41" coveredconditionals="35" methods="6" coveredmethods="6"/>
+      <line num="1" count="1" type="stmt"/>
+      <line num="2" count="1" type="stmt"/>
+      <line num="3" count="1" type="stmt"/>
+      <line num="4" count="1" type="stmt"/>
+      <line num="5" count="1" type="stmt"/>
+      <line num="6" count="1" type="stmt"/>
+      <line num="7" count="1" type="stmt"/>
+      <line num="8" count="1" type="stmt"/>
+      <line num="9" count="1" type="stmt"/>
+      <line num="10" count="1" type="stmt"/>
+      <line num="11" count="1" type="stmt"/>
+      <line num="12" count="1" type="stmt"/>
+      <line num="13" count="1" type="stmt"/>
+      <line num="14" count="1" type="stmt"/>
+      <line num="15" count="1" type="stmt"/>
+      <line num="16" count="1" type="stmt"/>
+      <line num="17" count="1" type="stmt"/>
+      <line num="18" count="1" type="stmt"/>
+      <line num="19" count="1" type="stmt"/>
+      <line num="20" count="1" type="stmt"/>
+      <line num="21" count="1" type="stmt"/>
+      <line num="22" count="1" type="stmt"/>
+      <line num="23" count="1" type="stmt"/>
+      <line num="24" count="1" type="stmt"/>
+      <line num="25" count="1" type="stmt"/>
+      <line num="26" count="1" type="stmt"/>
+      <line num="27" count="1" type="stmt"/>
+      <line num="28" count="1" type="stmt"/>
+      <line num="29" count="1" type="stmt"/>
+      <line num="30" count="1" type="stmt"/>
+      <line num="31" count="1" type="stmt"/>
+      <line num="32" count="1" type="stmt"/>
+      <line num="33" count="1" type="stmt"/>
+      <line num="34" count="1" type="stmt"/>
+      <line num="35" count="1" type="stmt"/>
+      <line num="36" count="1" type="stmt"/>
+      <line num="37" count="1" type="stmt"/>
+      <line num="38" count="1" type="stmt"/>
+      <line num="39" count="1" type="stmt"/>
+      <line num="40" count="1" type="stmt"/>
+      <line num="41" count="1" type="stmt"/>
+      <line num="42" count="1" type="stmt"/>
+      <line num="43" count="1" type="stmt"/>
+      <line num="44" count="1" type="stmt"/>
+      <line num="45" count="1" type="stmt"/>
+      <line num="46" count="1" type="stmt"/>
+      <line num="47" count="1" type="stmt"/>
+      <line num="48" count="1" type="stmt"/>
+      <line num="49" count="1" type="stmt"/>
+      <line num="50" count="1" type="stmt"/>
+      <line num="51" count="1" type="stmt"/>
+      <line num="52" count="1" type="stmt"/>
+      <line num="53" count="1" type="cond" truecount="1" falsecount="0"/>
+      <line num="54" count="27" type="stmt"/>
+      <line num="55" count="27" type="stmt"/>
+      <line num="56" count="27" type="stmt"/>
+      <line num="57" count="27" type="stmt"/>
+      <line num="58" count="27" type="stmt"/>
+      <line num="59" count="27" type="stmt"/>
+      <line num="60" count="27" type="stmt"/>
+      <line num="61" count="27" type="stmt"/>
+      <line num="62" count="27" type="stmt"/>
+      <line num="63" count="27" type="stmt"/>
+      <line num="64" count="27" type="stmt"/>
+      <line num="65" count="27" type="stmt"/>
+      <line num="66" count="1" type="stmt"/>
+      <line num="67" count="1" type="cond" truecount="1" falsecount="0"/>
+      <line num="68" count="20" type="stmt"/>
+      <line num="69" count="20" type="cond" truecount="1" falsecount="0"/>
+      <line num="70" count="2" type="stmt"/>
+      <line num="71" count="2" type="stmt"/>
+      <line num="72" count="18" type="cond" truecount="1" falsecount="0"/>
+      <line num="73" count="18" type="cond" truecount="1" falsecount="0"/>
+      <line num="74" count="21" type="stmt"/>
+      <line num="75" count="21" type="cond" truecount="1" falsecount="0"/>
+      <line num="76" count="2" type="stmt"/>
+      <line num="77" count="2" type="stmt"/>
+      <line num="78" count="21" type="stmt"/>
+      <line num="79" count="16" type="cond" truecount="2" falsecount="0"/>
+      <line num="80" count="17" type="cond" truecount="1" falsecount="0"/>
+      <line num="81" count="18" type="stmt"/>
+      <line num="82" count="18" type="cond" truecount="1" falsecount="0"/>
+      <line num="83" count="2" type="stmt"/>
+      <line num="84" count="2" type="stmt"/>
+      <line num="85" count="0" type="cond" truecount="0" falsecount="1"/>
+      <line num="86" count="0" type="stmt"/>
+      <line num="87" count="2" type="stmt"/>
+      <line num="88" count="2" type="stmt"/>
+      <line num="89" count="18" type="stmt"/>
+      <line num="90" count="14" type="cond" truecount="1" falsecount="0"/>
+      <line num="91" count="14" type="stmt"/>
+      <line num="92" count="14" type="cond" truecount="1" falsecount="0"/>
+      <line num="93" count="14" type="stmt"/>
+      <line num="94" count="14" type="stmt"/>
+      <line num="95" count="14" type="stmt"/>
+      <line num="96" count="14" type="stmt"/>
+      <line num="97" count="14" type="stmt"/>
+      <line num="98" count="14" type="stmt"/>
+      <line num="99" count="14" type="stmt"/>
+      <line num="100" count="14" type="stmt"/>
+      <line num="101" count="14" type="stmt"/>
+      <line num="102" count="14" type="stmt"/>
+      <line num="103" count="14" type="stmt"/>
+      <line num="104" count="14" type="stmt"/>
+      <line num="105" count="14" type="stmt"/>
+      <line num="106" count="14" type="stmt"/>
+      <line num="107" count="14" type="stmt"/>
+      <line num="108" count="14" type="stmt"/>
+      <line num="109" count="14" type="stmt"/>
+      <line num="110" count="14" type="stmt"/>
+      <line num="111" count="14" type="stmt"/>
+      <line num="112" count="14" type="stmt"/>
+      <line num="113" count="14" type="stmt"/>
+      <line num="114" count="14" type="stmt"/>
+      <line num="115" count="14" type="stmt"/>
+      <line num="116" count="14" type="stmt"/>
+      <line num="117" count="14" type="stmt"/>
+      <line num="118" count="14" type="stmt"/>
+      <line num="119" count="14" type="stmt"/>
+      <line num="120" count="14" type="stmt"/>
+      <line num="121" count="14" type="stmt"/>
+      <line num="122" count="14" type="stmt"/>
+      <line num="123" count="14" type="stmt"/>
+      <line num="124" count="14" type="stmt"/>
+      <line num="125" count="14" type="stmt"/>
+      <line num="126" count="14" type="stmt"/>
+      <line num="127" count="10" type="cond" truecount="1" falsecount="0"/>
+      <line num="128" count="14" type="cond" truecount="1" falsecount="0"/>
+      <line num="129" count="12" type="stmt"/>
+      <line num="130" count="12" type="stmt"/>
+      <line num="131" count="10" type="cond" truecount="1" falsecount="0"/>
+      <line num="132" count="10" type="stmt"/>
+      <line num="133" count="10" type="stmt"/>
+      <line num="134" count="10" type="stmt"/>
+      <line num="135" count="10" type="stmt"/>
+      <line num="136" count="10" type="stmt"/>
+      <line num="137" count="10" type="stmt"/>
+      <line num="138" count="10" type="stmt"/>
+      <line num="139" count="10" type="stmt"/>
+      <line num="140" count="10" type="stmt"/>
+      <line num="141" count="10" type="stmt"/>
+      <line num="142" count="10" type="stmt"/>
+      <line num="143" count="10" type="stmt"/>
+      <line num="144" count="10" type="stmt"/>
+      <line num="145" count="20" type="cond" truecount="1" falsecount="0"/>
+      <line num="146" count="4" type="stmt"/>
+      <line num="147" count="4" type="stmt"/>
+      <line num="148" count="4" type="stmt"/>
+      <line num="149" count="4" type="stmt"/>
+      <line num="150" count="4" type="stmt"/>
+      <line num="151" count="4" type="stmt"/>
+      <line num="152" count="4" type="stmt"/>
+      <line num="153" count="4" type="stmt"/>
+      <line num="154" count="4" type="stmt"/>
+      <line num="155" count="4" type="stmt"/>
+      <line num="156" count="4" type="stmt"/>
+      <line num="157" count="4" type="stmt"/>
+      <line num="158" count="20" type="stmt"/>
+      <line num="159" count="1" type="stmt"/>
+      <line num="160" count="1" type="cond" truecount="1" falsecount="0"/>
+      <line num="161" count="13" type="stmt"/>
+      <line num="162" count="13" type="stmt"/>
+      <line num="163" count="13" type="stmt"/>
+      <line num="164" count="13" type="stmt"/>
+      <line num="165" count="13" type="stmt"/>
+      <line num="166" count="13" type="cond" truecount="0" falsecount="1"/>
+      <line num="167" count="0" type="stmt"/>
+      <line num="168" count="0" type="stmt"/>
+      <line num="169" count="13" type="stmt"/>
+      <line num="170" count="13" type="stmt"/>
+      <line num="171" count="13" type="stmt"/>
+      <line num="172" count="1" type="stmt"/>
+      <line num="173" count="1" type="cond" truecount="1" falsecount="0"/>
+      <line num="174" count="2" type="stmt"/>
+      <line num="175" count="2" type="stmt"/>
+      <line num="176" count="2" type="cond" truecount="1" falsecount="0"/>
+      <line num="177" count="1" type="stmt"/>
+      <line num="178" count="1" type="stmt"/>
+      <line num="179" count="1" type="stmt"/>
+      <line num="180" count="1" type="stmt"/>
+      <line num="181" count="1" type="stmt"/>
+      <line num="182" count="1" type="cond" truecount="0" falsecount="1"/>
+      <line num="183" count="0" type="stmt"/>
+      <line num="184" count="0" type="stmt"/>
+      <line num="185" count="1" type="stmt"/>
+      <line num="186" count="1" type="stmt"/>
+      <line num="187" count="1" type="stmt"/>
+      <line num="188" count="1" type="stmt"/>
+      <line num="189" count="1" type="stmt"/>
+      <line num="190" count="1" type="stmt"/>
+      <line num="191" count="1" type="stmt"/>
+      <line num="192" count="1" type="stmt"/>
+      <line num="193" count="1" type="stmt"/>
+      <line num="194" count="1" type="stmt"/>
+      <line num="195" count="1" type="stmt"/>
+      <line num="196" count="1" type="stmt"/>
+      <line num="197" count="1" type="stmt"/>
+      <line num="198" count="1" type="stmt"/>
+      <line num="199" count="1" type="stmt"/>
+      <line num="200" count="1" type="cond" truecount="1" falsecount="0"/>
+      <line num="201" count="5" type="stmt"/>
+      <line num="202" count="5" type="stmt"/>
+      <line num="203" count="5" type="cond" truecount="1" falsecount="0"/>
+      <line num="204" count="1" type="stmt"/>
+      <line num="205" count="1" type="stmt"/>
+      <line num="206" count="4" type="cond" truecount="1" falsecount="0"/>
+      <line num="207" count="4" type="stmt"/>
+      <line num="208" count="4" type="stmt"/>
+      <line num="209" count="4" type="cond" truecount="1" falsecount="0"/>
+      <line num="210" count="4" type="cond" truecount="1" falsecount="0"/>
+      <line num="211" count="1" type="stmt"/>
+      <line num="212" count="1" type="stmt"/>
+      <line num="213" count="3" type="cond" truecount="2" falsecount="0"/>
+      <line num="214" count="1" type="stmt"/>
+      <line num="215" count="1" type="stmt"/>
+      <line num="216" count="2" type="cond" truecount="1" falsecount="0"/>
+      <line num="217" count="2" type="stmt"/>
+      <line num="218" count="2" type="cond" truecount="1" falsecount="0"/>
+      <line num="219" count="2" type="stmt"/>
+      <line num="220" count="4" type="cond" truecount="0" falsecount="1"/>
+      <line num="221" count="0" type="stmt"/>
+      <line num="222" count="0" type="stmt"/>
+      <line num="223" count="2" type="cond" truecount="1" falsecount="0"/>
+      <line num="224" count="2" type="stmt"/>
+      <line num="225" count="2" type="stmt"/>
+      <line num="226" count="2" type="stmt"/>
+      <line num="227" count="2" type="stmt"/>
+      <line num="228" count="2" type="stmt"/>
+      <line num="229" count="2" type="stmt"/>
+      <line num="230" count="2" type="stmt"/>
+      <line num="231" count="2" type="stmt"/>
+      <line num="232" count="2" type="stmt"/>
+      <line num="233" count="2" type="stmt"/>
+      <line num="234" count="2" type="stmt"/>
+      <line num="235" count="2" type="cond" truecount="1" falsecount="0"/>
+      <line num="236" count="2" type="cond" truecount="1" falsecount="0"/>
+      <line num="237" count="2" type="stmt"/>
+      <line num="238" count="2" type="stmt"/>
+      <line num="239" count="2" type="stmt"/>
+      <line num="240" count="2" type="cond" truecount="1" falsecount="0"/>
+      <line num="241" count="2" type="stmt"/>
+      <line num="242" count="4" type="cond" truecount="1" falsecount="0"/>
+      <line num="243" count="1" type="stmt"/>
+      <line num="244" count="1" type="stmt"/>
+      <line num="245" count="1" type="stmt"/>
+      <line num="246" count="1" type="stmt"/>
+      <line num="247" count="1" type="stmt"/>
+      <line num="248" count="1" type="stmt"/>
+      <line num="249" count="2" type="cond" truecount="1" falsecount="0"/>
+      <line num="250" count="2" type="stmt"/>
+      <line num="251" count="2" type="stmt"/>
+      <line num="252" count="1" type="stmt"/>
+      <line num="253" count="1" type="cond" truecount="1" falsecount="0"/>
+      <line num="254" count="27" type="stmt"/>
+      <line num="255" count="27" type="stmt"/>
+      <line num="256" count="27" type="stmt"/>
+      <line num="257" count="27" type="cond" truecount="0" falsecount="1"/>
+      <line num="258" count="27" type="stmt"/>
+      <line num="259" count="27" type="stmt"/>
+      <line num="260" count="27" type="stmt"/>
+      <line num="261" count="27" type="stmt"/>
+      <line num="262" count="27" type="stmt"/>
+      <line num="263" count="27" type="stmt"/>
+      <line num="264" count="27" type="cond" truecount="0" falsecount="1"/>
+      <line num="265" count="27" type="stmt"/>
+      <line num="266" count="27" type="stmt"/>
+      <line num="267" count="27" type="stmt"/>
+      <line num="268" count="27" type="stmt"/>
+      <line num="269" count="27" type="stmt"/>
+      <line num="270" count="1" type="stmt"/>
+    </file>
+    <file name="PaymentService.ts" path="/app/repository_before/services/PaymentService.ts">
+      <metrics statements="68" coveredstatements="68" conditionals="9" coveredconditionals="9" methods="5" coveredmethods="5"/>
+      <line num="1" count="1" type="stmt"/>
+      <line num="2" count="1" type="stmt"/>
+      <line num="3" count="1" type="stmt"/>
+      <line num="4" count="1" type="stmt"/>
+      <line num="5" count="1" type="stmt"/>
+      <line num="6" count="1" type="stmt"/>
+      <line num="7" count="1" type="stmt"/>
+      <line num="8" count="1" type="stmt"/>
+      <line num="9" count="1" type="stmt"/>
+      <line num="10" count="1" type="stmt"/>
+      <line num="11" count="1" type="stmt"/>
+      <line num="12" count="1" type="stmt"/>
+      <line num="13" count="1" type="stmt"/>
+      <line num="14" count="1" type="stmt"/>
+      <line num="15" count="1" type="stmt"/>
+      <line num="16" count="1" type="cond" truecount="1" falsecount="0"/>
+      <line num="17" count="33" type="stmt"/>
+      <line num="18" count="33" type="stmt"/>
+      <line num="19" count="33" type="stmt"/>
+      <line num="20" count="33" type="stmt"/>
+      <line num="21" count="1" type="stmt"/>
+      <line num="22" count="1" type="cond" truecount="1" falsecount="0"/>
+      <line num="23" count="14" type="stmt"/>
+      <line num="24" count="14" type="stmt"/>
+      <line num="25" count="14" type="stmt"/>
+      <line num="26" count="14" type="stmt"/>
+      <line num="27" count="14" type="stmt"/>
+      <line num="28" count="14" type="stmt"/>
+      <line num="29" count="14" type="stmt"/>
+      <line num="30" count="14" type="stmt"/>
+      <line num="31" count="14" type="stmt"/>
+      <line num="32" count="14" type="stmt"/>
+      <line num="33" count="14" type="stmt"/>
+      <line num="34" count="14" type="stmt"/>
+      <line num="35" count="14" type="stmt"/>
+      <line num="36" count="14" type="stmt"/>
+      <line num="37" count="14" type="stmt"/>
+      <line num="38" count="14" type="stmt"/>
+      <line num="39" count="14" type="cond" truecount="1" falsecount="0"/>
+      <line num="40" count="4" type="stmt"/>
+      <line num="41" count="4" type="stmt"/>
+      <line num="42" count="10" type="cond" truecount="1" falsecount="0"/>
+      <line num="43" count="10" type="stmt"/>
+      <line num="44" count="10" type="stmt"/>
+      <line num="45" count="1" type="stmt"/>
+      <line num="46" count="1" type="cond" truecount="1" falsecount="0"/>
+      <line num="47" count="3" type="stmt"/>
+      <line num="48" count="3" type="stmt"/>
+      <line num="49" count="3" type="stmt"/>
+      <line num="50" count="3" type="stmt"/>
+      <line num="51" count="3" type="cond" truecount="2" falsecount="0"/>
+      <line num="52" count="3" type="stmt"/>
+      <line num="53" count="1" type="stmt"/>
+      <line num="54" count="1" type="cond" truecount="1" falsecount="0"/>
+      <line num="55" count="2" type="stmt"/>
+      <line num="56" count="2" type="stmt"/>
+      <line num="57" count="2" type="stmt"/>
+      <line num="58" count="2" type="stmt"/>
+      <line num="59" count="2" type="stmt"/>
+      <line num="60" count="1" type="stmt"/>
+      <line num="61" count="1" type="cond" truecount="1" falsecount="0"/>
+      <line num="62" count="6" type="stmt"/>
+      <line num="63" count="6" type="stmt"/>
+      <line num="64" count="6" type="stmt"/>
+      <line num="65" count="6" type="stmt"/>
+      <line num="66" count="6" type="stmt"/>
+      <line num="67" count="6" type="stmt"/>
+      <line num="68" count="1" type="stmt"/>
+    </file>
+    <file name="ShippingService.ts" path="/app/repository_before/services/ShippingService.ts">
+      <metrics statements="91" coveredstatements="90" conditionals="32" coveredconditionals="31" methods="4" coveredmethods="4"/>
+      <line num="1" count="1" type="stmt"/>
+      <line num="2" count="1" type="stmt"/>
+      <line num="3" count="1" type="stmt"/>
+      <line num="4" count="1" type="stmt"/>
+      <line num="5" count="1" type="stmt"/>
+      <line num="6" count="1" type="stmt"/>
+      <line num="7" count="1" type="stmt"/>
+      <line num="8" count="1" type="stmt"/>
+      <line num="9" count="1" type="stmt"/>
+      <line num="10" count="1" type="stmt"/>
+      <line num="11" count="1" type="stmt"/>
+      <line num="12" count="1" type="stmt"/>
+      <line num="13" count="1" type="stmt"/>
+      <line num="14" count="1" type="stmt"/>
+      <line num="15" count="1" type="stmt"/>
+      <line num="16" count="1" type="stmt"/>
+      <line num="17" count="1" type="stmt"/>
+      <line num="18" count="1" type="stmt"/>
+      <line num="19" count="1" type="cond" truecount="1" falsecount="0"/>
+      <line num="20" count="18" type="stmt"/>
+      <line num="21" count="18" type="stmt"/>
+      <line num="22" count="18" type="stmt"/>
+      <line num="23" count="18" type="cond" truecount="1" falsecount="0"/>
+      <line num="24" count="18" type="stmt"/>
+      <line num="25" count="18" type="stmt"/>
+      <line num="26" count="18" type="stmt"/>
+      <line num="27" count="18" type="stmt"/>
+      <line num="28" count="1" type="stmt"/>
+      <line num="29" count="1" type="cond" truecount="1" falsecount="0"/>
+      <line num="30" count="22" type="cond" truecount="1" falsecount="0"/>
+      <line num="31" count="2" type="stmt"/>
+      <line num="32" count="2" type="stmt"/>
+      <line num="33" count="20" type="cond" truecount="1" falsecount="0"/>
+      <line num="34" count="20" type="stmt"/>
+      <line num="35" count="20" type="stmt"/>
+      <line num="36" count="22" type="cond" truecount="1" falsecount="0"/>
+      <line num="37" count="16" type="stmt"/>
+      <line num="38" count="16" type="stmt"/>
+      <line num="39" count="4" type="cond" truecount="2" falsecount="0"/>
+      <line num="40" count="8" type="cond" truecount="1" falsecount="0"/>
+      <line num="41" count="2" type="stmt"/>
+      <line num="42" count="2" type="stmt"/>
+      <line num="43" count="2" type="stmt"/>
+      <line num="44" count="2" type="stmt"/>
+      <line num="45" count="2" type="stmt"/>
+      <line num="46" count="1" type="stmt"/>
+      <line num="47" count="1" type="cond" truecount="1" falsecount="0"/>
+      <line num="48" count="4" type="stmt"/>
+      <line num="49" count="4" type="stmt"/>
+      <line num="50" count="4" type="stmt"/>
+      <line num="51" count="4" type="cond" truecount="1" falsecount="0"/>
+      <line num="52" count="1" type="stmt"/>
+      <line num="53" count="4" type="cond" truecount="1" falsecount="0"/>
+      <line num="54" count="1" type="stmt"/>
+      <line num="55" count="4" type="cond" truecount="1" falsecount="0"/>
+      <line num="56" count="1" type="stmt"/>
+      <line num="57" count="4" type="cond" truecount="1" falsecount="0"/>
+      <line num="58" count="1" type="stmt"/>
+      <line num="59" count="4" type="cond" truecount="0" falsecount="1"/>
+      <line num="60" count="0" type="stmt"/>
+      <line num="61" count="4" type="stmt"/>
+      <line num="62" count="4" type="stmt"/>
+      <line num="63" count="1" type="stmt"/>
+      <line num="64" count="1" type="cond" truecount="1" falsecount="0"/>
+      <line num="65" count="7" type="cond" truecount="2" falsecount="0"/>
+      <line num="66" count="1" type="stmt"/>
+      <line num="67" count="1" type="stmt"/>
+      <line num="68" count="6" type="cond" truecount="1" falsecount="0"/>
+      <line num="69" count="7" type="cond" truecount="2" falsecount="0"/>
+      <line num="70" count="1" type="stmt"/>
+      <line num="71" count="1" type="stmt"/>
+      <line num="72" count="5" type="cond" truecount="1" falsecount="0"/>
+      <line num="73" count="7" type="cond" truecount="2" falsecount="0"/>
+      <line num="74" count="1" type="stmt"/>
+      <line num="75" count="1" type="stmt"/>
+      <line num="76" count="4" type="cond" truecount="1" falsecount="0"/>
+      <line num="77" count="7" type="cond" truecount="2" falsecount="0"/>
+      <line num="78" count="1" type="stmt"/>
+      <line num="79" count="1" type="stmt"/>
+      <line num="80" count="3" type="cond" truecount="1" falsecount="0"/>
+      <line num="81" count="7" type="cond" truecount="2" falsecount="0"/>
+      <line num="82" count="1" type="stmt"/>
+      <line num="83" count="1" type="stmt"/>
+      <line num="84" count="2" type="cond" truecount="1" falsecount="0"/>
+      <line num="85" count="7" type="cond" truecount="1" falsecount="0"/>
+      <line num="86" count="1" type="stmt"/>
+      <line num="87" count="1" type="stmt"/>
+      <line num="88" count="1" type="stmt"/>
+      <line num="89" count="1" type="stmt"/>
+      <line num="90" count="1" type="stmt"/>
+      <line num="91" count="1" type="stmt"/>
+    </file>
+  </project>
+</coverage>
diff --git a/repository_after/coverage/coverage-final.json b/repository_after/coverage/coverage-final.json
new file mode 100644
index 0000000..5ec9245
--- /dev/null
+++ b/repository_after/coverage/coverage-final.json
@@ -0,0 +1,5 @@
+{"/app/repository_before/services/InventoryService.ts": {"path":"/app/repository_before/services/InventoryService.ts","all":false,"statementMap":{"0":{"start":{"line":1,"column":0},"end":{"line":1,"column":26}},"1":{"start":{"line":2,"column":0},"end":{"line":2,"column":32}},"2":{"start":{"line":3,"column":0},"end":{"line":3,"column":0}},"3":{"start":{"line":4,"column":0},"end":{"line":4,"column":40}},"4":{"start":{"line":5,"column":0},"end":{"line":5,"column":0}},"5":{"start":{"line":6,"column":0},"end":{"line":6,"column":31}},"6":{"start":{"line":7,"column":0},"end":{"line":7,"column":23}},"7":{"start":{"line":8,"column":0},"end":{"line":8,"column":25}},"8":{"start":{"line":9,"column":0},"end":{"line":9,"column":0}},"9":{"start":{"line":10,"column":0},"end":{"line":10,"column":43}},"10":{"start":{"line":11,"column":0},"end":{"line":11,"column":25}},"11":{"start":{"line":12,"column":0},"end":{"line":12,"column":27}},"12":{"start":{"line":13,"column":0},"end":{"line":13,"column":5}},"13":{"start":{"line":14,"column":0},"end":{"line":14,"column":0}},"14":{"start":{"line":15,"column":0},"end":{"line":15,"column":68}},"15":{"start":{"line":16,"column":0},"end":{"line":16,"column":45}},"16":{"start":{"line":17,"column":0},"end":{"line":17,"column":67}},"17":{"start":{"line":18,"column":0},"end":{"line":18,"column":23}},"18":{"start":{"line":19,"column":0},"end":{"line":19,"column":10}},"19":{"start":{"line":20,"column":0},"end":{"line":20,"column":0}},"20":{"start":{"line":21,"column":0},"end":{"line":21,"column":39}},"21":{"start":{"line":22,"column":0},"end":{"line":22,"column":21}},"22":{"start":{"line":23,"column":0},"end":{"line":23,"column":9}},"23":{"start":{"line":24,"column":0},"end":{"line":24,"column":0}},"24":{"start":{"line":25,"column":0},"end":{"line":25,"column":51}},"25":{"start":{"line":26,"column":0},"end":{"line":26,"column":67}},"26":{"start":{"line":27,"column":0},"end":{"line":27,"column":0}},"27":{"start":{"line":28,"column":0},"end":{"line":28,"column":50}},"28":{"start":{"line":29,"column":0},"end":{"line":29,"column":5}},"29":{"start":{"line":30,"column":0},"end":{"line":30,"column":0}},"30":{"start":{"line":31,"column":0},"end":{"line":31,"column":67}},"31":{"start":{"line":32,"column":0},"end":{"line":32,"column":74}},"32":{"start":{"line":33,"column":0},"end":{"line":33,"column":53}},"33":{"start":{"line":34,"column":0},"end":{"line":34,"column":5}},"34":{"start":{"line":35,"column":0},"end":{"line":35,"column":0}},"35":{"start":{"line":36,"column":0},"end":{"line":36,"column":74}},"36":{"start":{"line":37,"column":0},"end":{"line":37,"column":54}},"37":{"start":{"line":38,"column":0},"end":{"line":38,"column":80}},"38":{"start":{"line":39,"column":0},"end":{"line":39,"column":0}},"39":{"start":{"line":40,"column":0},"end":{"line":40,"column":28}},"40":{"start":{"line":41,"column":0},"end":{"line":41,"column":69}},"41":{"start":{"line":42,"column":0},"end":{"line":42,"column":53}},"42":{"start":{"line":43,"column":0},"end":{"line":43,"column":9}},"43":{"start":{"line":44,"column":0},"end":{"line":44,"column":0}},"44":{"start":{"line":45,"column":0},"end":{"line":45,"column":13}},"45":{"start":{"line":46,"column":0},"end":{"line":46,"column":73}},"46":{"start":{"line":47,"column":0},"end":{"line":47,"column":0}},"47":{"start":{"line":48,"column":0},"end":{"line":48,"column":39}},"48":{"start":{"line":49,"column":0},"end":{"line":49,"column":29}},"49":{"start":{"line":50,"column":0},"end":{"line":50,"column":13}},"50":{"start":{"line":51,"column":0},"end":{"line":51,"column":0}},"51":{"start":{"line":52,"column":0},"end":{"line":52,"column":62}},"52":{"start":{"line":53,"column":0},"end":{"line":53,"column":78}},"53":{"start":{"line":54,"column":0},"end":{"line":54,"column":59}},"54":{"start":{"line":55,"column":0},"end":{"line":55,"column":0}},"55":{"start":{"line":56,"column":0},"end":{"line":56,"column":100}},"56":{"start":{"line":57,"column":0},"end":{"line":57,"column":0}},"57":{"start":{"line":58,"column":0},"end":{"line":58,"column":24}},"58":{"start":{"line":59,"column":0},"end":{"line":59,"column":19}},"59":{"start":{"line":60,"column":0},"end":{"line":60,"column":42}},"60":{"start":{"line":61,"column":0},"end":{"line":61,"column":9}},"61":{"start":{"line":62,"column":0},"end":{"line":62,"column":5}},"62":{"start":{"line":63,"column":0},"end":{"line":63,"column":0}},"63":{"start":{"line":64,"column":0},"end":{"line":64,"column":82}},"64":{"start":{"line":65,"column":0},"end":{"line":65,"column":49}},"65":{"start":{"line":66,"column":0},"end":{"line":66,"column":0}},"66":{"start":{"line":67,"column":0},"end":{"line":67,"column":13}},"67":{"start":{"line":68,"column":0},"end":{"line":68,"column":40}},"68":{"start":{"line":69,"column":0},"end":{"line":69,"column":0}},"69":{"start":{"line":70,"column":0},"end":{"line":70,"column":31}},"70":{"start":{"line":71,"column":0},"end":{"line":71,"column":106}},"71":{"start":{"line":72,"column":0},"end":{"line":72,"column":37}},"72":{"start":{"line":73,"column":0},"end":{"line":73,"column":14}},"73":{"start":{"line":74,"column":0},"end":{"line":74,"column":0}},"74":{"start":{"line":75,"column":0},"end":{"line":75,"column":62}},"75":{"start":{"line":76,"column":0},"end":{"line":76,"column":78}},"76":{"start":{"line":77,"column":0},"end":{"line":77,"column":72}},"77":{"start":{"line":78,"column":0},"end":{"line":78,"column":0}},"78":{"start":{"line":79,"column":0},"end":{"line":79,"column":34}},"79":{"start":{"line":80,"column":0},"end":{"line":80,"column":65}},"80":{"start":{"line":81,"column":0},"end":{"line":81,"column":120}},"81":{"start":{"line":82,"column":0},"end":{"line":82,"column":20}},"82":{"start":{"line":83,"column":0},"end":{"line":83,"column":53}},"83":{"start":{"line":84,"column":0},"end":{"line":84,"column":13}},"84":{"start":{"line":85,"column":0},"end":{"line":85,"column":0}},"85":{"start":{"line":86,"column":0},"end":{"line":86,"column":41}},"86":{"start":{"line":87,"column":0},"end":{"line":87,"column":25}},"87":{"start":{"line":88,"column":0},"end":{"line":88,"column":43}},"88":{"start":{"line":89,"column":0},"end":{"line":89,"column":24}},"89":{"start":{"line":90,"column":0},"end":{"line":90,"column":19}},"90":{"start":{"line":91,"column":0},"end":{"line":91,"column":29}},"91":{"start":{"line":92,"column":0},"end":{"line":92,"column":9}},"92":{"start":{"line":93,"column":0},"end":{"line":93,"column":5}},"93":{"start":{"line":94,"column":0},"end":{"line":94,"column":0}},"94":{"start":{"line":95,"column":0},"end":{"line":95,"column":71}},"95":{"start":{"line":96,"column":0},"end":{"line":96,"column":58}},"96":{"start":{"line":97,"column":0},"end":{"line":97,"column":74}},"97":{"start":{"line":98,"column":0},"end":{"line":98,"column":0}},"98":{"start":{"line":99,"column":0},"end":{"line":99,"column":34}},"99":{"start":{"line":100,"column":0},"end":{"line":100,"column":72}},"100":{"start":{"line":101,"column":0},"end":{"line":101,"column":34}},"101":{"start":{"line":102,"column":0},"end":{"line":102,"column":65}},"102":{"start":{"line":103,"column":0},"end":{"line":103,"column":120}},"103":{"start":{"line":104,"column":0},"end":{"line":104,"column":20}},"104":{"start":{"line":105,"column":0},"end":{"line":105,"column":53}},"105":{"start":{"line":106,"column":0},"end":{"line":106,"column":13}},"106":{"start":{"line":107,"column":0},"end":{"line":107,"column":16}},"107":{"start":{"line":108,"column":0},"end":{"line":108,"column":34}},"108":{"start":{"line":109,"column":0},"end":{"line":109,"column":106}},"109":{"start":{"line":110,"column":0},"end":{"line":110,"column":37}},"110":{"start":{"line":111,"column":0},"end":{"line":111,"column":14}},"111":{"start":{"line":112,"column":0},"end":{"line":112,"column":9}},"112":{"start":{"line":113,"column":0},"end":{"line":113,"column":5}},"113":{"start":{"line":114,"column":0},"end":{"line":114,"column":0}},"114":{"start":{"line":115,"column":0},"end":{"line":115,"column":75}},"115":{"start":{"line":116,"column":0},"end":{"line":116,"column":30}},"116":{"start":{"line":117,"column":0},"end":{"line":117,"column":57}},"117":{"start":{"line":118,"column":0},"end":{"line":118,"column":28}},"118":{"start":{"line":119,"column":0},"end":{"line":119,"column":87}},"119":{"start":{"line":120,"column":0},"end":{"line":120,"column":33}},"120":{"start":{"line":121,"column":0},"end":{"line":121,"column":10}},"121":{"start":{"line":122,"column":0},"end":{"line":122,"column":5}},"122":{"start":{"line":123,"column":0},"end":{"line":123,"column":1}}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":27,"11":27,"12":27,"13":1,"14":1,"15":45,"16":45,"17":45,"18":45,"19":45,"20":45,"21":1,"22":1,"23":44,"24":44,"25":44,"26":44,"27":44,"28":44,"29":1,"30":1,"31":82,"32":82,"33":82,"34":1,"35":1,"36":25,"37":25,"38":25,"39":25,"40":4,"41":4,"42":4,"43":21,"44":21,"45":21,"46":21,"47":25,"48":3,"49":3,"50":18,"51":18,"52":18,"53":18,"54":18,"55":18,"56":18,"57":18,"58":18,"59":21,"60":21,"61":25,"62":1,"63":1,"64":12,"65":12,"66":12,"67":12,"68":12,"69":12,"70":12,"71":12,"72":12,"73":12,"74":12,"75":12,"76":12,"77":12,"78":12,"79":0,"80":0,"81":12,"82":12,"83":12,"84":12,"85":12,"86":12,"87":0,"88":0,"89":12,"90":12,"91":12,"92":12,"93":1,"94":1,"95":8,"96":8,"97":8,"98":8,"99":4,"100":4,"101":0,"102":0,"103":4,"104":4,"105":4,"106":4,"107":4,"108":4,"109":4,"110":4,"111":4,"112":8,"113":1,"114":1,"115":1,"116":1,"117":1,"118":1,"119":1,"120":1,"121":1,"122":1},"branchMap":{"0":{"type":"branch","line":10,"loc":{"start":{"line":10,"column":4},"end":{"line":13,"column":5}},"locations":[{"start":{"line":10,"column":4},"end":{"line":13,"column":5}}]},"1":{"type":"branch","line":15,"loc":{"start":{"line":15,"column":4},"end":{"line":29,"column":5}},"locations":[{"start":{"line":15,"column":4},"end":{"line":29,"column":5}}]},"2":{"type":"branch","line":21,"loc":{"start":{"line":21,"column":38},"end":{"line":23,"column":9}},"locations":[{"start":{"line":21,"column":38},"end":{"line":23,"column":9}}]},"3":{"type":"branch","line":24,"loc":{"start":{"line":24,"column":-1},"end":{"line":29,"column":5}},"locations":[{"start":{"line":24,"column":-1},"end":{"line":29,"column":5}}]},"4":{"type":"branch","line":31,"loc":{"start":{"line":31,"column":4},"end":{"line":34,"column":5}},"locations":[{"start":{"line":31,"column":4},"end":{"line":34,"column":5}}]},"5":{"type":"branch","line":33,"loc":{"start":{"line":33,"column":24},"end":{"line":33,"column":48}},"locations":[{"start":{"line":33,"column":24},"end":{"line":33,"column":48}}]},"6":{"type":"branch","line":33,"loc":{"start":{"line":33,"column":49},"end":{"line":33,"column":52}},"locations":[{"start":{"line":33,"column":49},"end":{"line":33,"column":52}}]},"7":{"type":"branch","line":36,"loc":{"start":{"line":36,"column":4},"end":{"line":62,"column":5}},"locations":[{"start":{"line":36,"column":4},"end":{"line":62,"column":5}}]},"8":{"type":"branch","line":40,"loc":{"start":{"line":40,"column":27},"end":{"line":43,"column":9}},"locations":[{"start":{"line":40,"column":27},"end":{"line":43,"column":9}}]},"9":{"type":"branch","line":44,"loc":{"start":{"line":44,"column":-1},"end":{"line":48,"column":38}},"locations":[{"start":{"line":44,"column":-1},"end":{"line":48,"column":38}}]},"10":{"type":"branch","line":48,"loc":{"start":{"line":48,"column":38},"end":{"line":50,"column":13}},"locations":[{"start":{"line":48,"column":38},"end":{"line":50,"column":13}}]},"11":{"type":"branch","line":51,"loc":{"start":{"line":51,"column":-1},"end":{"line":59,"column":19}},"locations":[{"start":{"line":51,"column":-1},"end":{"line":59,"column":19}}]},"12":{"type":"branch","line":59,"loc":{"start":{"line":59,"column":18},"end":{"line":61,"column":9}},"locations":[{"start":{"line":59,"column":18},"end":{"line":61,"column":9}}]},"13":{"type":"branch","line":41,"loc":{"start":{"line":41,"column":30},"end":{"line":41,"column":67}},"locations":[{"start":{"line":41,"column":30},"end":{"line":41,"column":67}}]},"14":{"type":"branch","line":64,"loc":{"start":{"line":64,"column":4},"end":{"line":93,"column":5}},"locations":[{"start":{"line":64,"column":4},"end":{"line":93,"column":5}}]},"15":{"type":"branch","line":79,"loc":{"start":{"line":79,"column":33},"end":{"line":82,"column":13}},"locations":[{"start":{"line":79,"column":33},"end":{"line":82,"column":13}}]},"16":{"type":"branch","line":87,"loc":{"start":{"line":87,"column":10},"end":{"line":90,"column":9}},"locations":[{"start":{"line":87,"column":10},"end":{"line":90,"column":9}}]},"17":{"type":"branch","line":95,"loc":{"start":{"line":95,"column":4},"end":{"line":113,"column":5}},"locations":[{"start":{"line":95,"column":4},"end":{"line":113,"column":5}}]},"18":{"type":"branch","line":99,"loc":{"start":{"line":99,"column":33},"end":{"line":112,"column":9}},"locations":[{"start":{"line":99,"column":33},"end":{"line":112,"column":9}}]},"19":{"type":"branch","line":101,"loc":{"start":{"line":101,"column":33},"end":{"line":104,"column":13}},"locations":[{"start":{"line":101,"column":33},"end":{"line":104,"column":13}}]},"20":{"type":"branch","line":115,"loc":{"start":{"line":115,"column":4},"end":{"line":122,"column":5}},"locations":[{"start":{"line":115,"column":4},"end":{"line":122,"column":5}}]}},"b":{"0":[27],"1":[45],"2":[1],"3":[44],"4":[82],"5":[17],"6":[65],"7":[25],"8":[4],"9":[21],"10":[3],"11":[18],"12":[21],"13":[4],"14":[12],"15":[0],"16":[0],"17":[8],"18":[4],"19":[0],"20":[1]},"fnMap":{"0":{"name":"InventoryService","decl":{"start":{"line":10,"column":4},"end":{"line":13,"column":5}},"loc":{"start":{"line":10,"column":4},"end":{"line":13,"column":5}},"line":10},"1":{"name":"getAvailableQuantity","decl":{"start":{"line":15,"column":4},"end":{"line":29,"column":5}},"loc":{"start":{"line":15,"column":4},"end":{"line":29,"column":5}},"line":15},"2":{"name":"getReservedQuantity","decl":{"start":{"line":31,"column":4},"end":{"line":34,"column":5}},"loc":{"start":{"line":31,"column":4},"end":{"line":34,"column":5}},"line":31},"3":{"name":"reserve","decl":{"start":{"line":36,"column":4},"end":{"line":62,"column":5}},"loc":{"start":{"line":36,"column":4},"end":{"line":62,"column":5}},"line":36},"4":{"name":"confirmReservation","decl":{"start":{"line":64,"column":4},"end":{"line":93,"column":5}},"loc":{"start":{"line":64,"column":4},"end":{"line":93,"column":5}},"line":64},"5":{"name":"release","decl":{"start":{"line":95,"column":4},"end":{"line":113,"column":5}},"loc":{"start":{"line":95,"column":4},"end":{"line":113,"column":5}},"line":95},"6":{"name":"setQuantity","decl":{"start":{"line":115,"column":4},"end":{"line":122,"column":5}},"loc":{"start":{"line":115,"column":4},"end":{"line":122,"column":5}},"line":115}},"f":{"0":27,"1":45,"2":82,"3":25,"4":12,"5":8,"6":1}}
+,"/app/repository_before/services/OrderService.ts": {"path":"/app/repository_before/services/OrderService.ts","all":false,"statementMap":{"0":{"start":{"line":1,"column":0},"end":{"line":1,"column":26}},"1":{"start":{"line":2,"column":0},"end":{"line":2,"column":32}},"2":{"start":{"line":3,"column":0},"end":{"line":3,"column":54}},"3":{"start":{"line":4,"column":0},"end":{"line":4,"column":50}},"4":{"start":{"line":5,"column":0},"end":{"line":5,"column":52}},"5":{"start":{"line":6,"column":0},"end":{"line":6,"column":0}},"6":{"start":{"line":7,"column":0},"end":{"line":7,"column":28}},"7":{"start":{"line":8,"column":0},"end":{"line":8,"column":22}},"8":{"start":{"line":9,"column":0},"end":{"line":9,"column":21}},"9":{"start":{"line":10,"column":0},"end":{"line":10,"column":25}},"10":{"start":{"line":11,"column":0},"end":{"line":11,"column":1}},"11":{"start":{"line":12,"column":0},"end":{"line":12,"column":0}},"12":{"start":{"line":13,"column":0},"end":{"line":13,"column":34}},"13":{"start":{"line":14,"column":0},"end":{"line":14,"column":19}},"14":{"start":{"line":15,"column":0},"end":{"line":15,"column":17}},"15":{"start":{"line":16,"column":0},"end":{"line":16,"column":18}},"16":{"start":{"line":17,"column":0},"end":{"line":17,"column":20}},"17":{"start":{"line":18,"column":0},"end":{"line":18,"column":20}},"18":{"start":{"line":19,"column":0},"end":{"line":19,"column":1}},"19":{"start":{"line":20,"column":0},"end":{"line":20,"column":0}},"20":{"start":{"line":21,"column":0},"end":{"line":21,"column":37}},"21":{"start":{"line":22,"column":0},"end":{"line":22,"column":19}},"22":{"start":{"line":23,"column":0},"end":{"line":23,"column":23}},"23":{"start":{"line":24,"column":0},"end":{"line":24,"column":37}},"24":{"start":{"line":25,"column":0},"end":{"line":25,"column":27}},"25":{"start":{"line":26,"column":0},"end":{"line":26,"column":1}},"26":{"start":{"line":27,"column":0},"end":{"line":27,"column":0}},"27":{"start":{"line":28,"column":0},"end":{"line":28,"column":24}},"28":{"start":{"line":29,"column":0},"end":{"line":29,"column":15}},"29":{"start":{"line":30,"column":0},"end":{"line":30,"column":19}},"30":{"start":{"line":31,"column":0},"end":{"line":31,"column":23}},"31":{"start":{"line":32,"column":0},"end":{"line":32,"column":21}},"32":{"start":{"line":33,"column":0},"end":{"line":33,"column":25}},"33":{"start":{"line":34,"column":0},"end":{"line":34,"column":18}},"34":{"start":{"line":35,"column":0},"end":{"line":35,"column":19}},"35":{"start":{"line":36,"column":0},"end":{"line":36,"column":37}},"36":{"start":{"line":37,"column":0},"end":{"line":37,"column":20}},"37":{"start":{"line":38,"column":0},"end":{"line":38,"column":20}},"38":{"start":{"line":39,"column":0},"end":{"line":39,"column":1}},"39":{"start":{"line":40,"column":0},"end":{"line":40,"column":0}},"40":{"start":{"line":41,"column":0},"end":{"line":41,"column":29}},"41":{"start":{"line":42,"column":0},"end":{"line":42,"column":22}},"42":{"start":{"line":43,"column":0},"end":{"line":43,"column":21}},"43":{"start":{"line":44,"column":0},"end":{"line":44,"column":1}},"44":{"start":{"line":45,"column":0},"end":{"line":45,"column":0}},"45":{"start":{"line":46,"column":0},"end":{"line":46,"column":27}},"46":{"start":{"line":47,"column":0},"end":{"line":47,"column":23}},"47":{"start":{"line":48,"column":0},"end":{"line":48,"column":25}},"48":{"start":{"line":49,"column":0},"end":{"line":49,"column":47}},"49":{"start":{"line":50,"column":0},"end":{"line":50,"column":43}},"50":{"start":{"line":51,"column":0},"end":{"line":51,"column":45}},"51":{"start":{"line":52,"column":0},"end":{"line":52,"column":0}},"52":{"start":{"line":53,"column":0},"end":{"line":53,"column":16}},"53":{"start":{"line":54,"column":0},"end":{"line":54,"column":19}},"54":{"start":{"line":55,"column":0},"end":{"line":55,"column":21}},"55":{"start":{"line":56,"column":0},"end":{"line":56,"column":43}},"56":{"start":{"line":57,"column":0},"end":{"line":57,"column":39}},"57":{"start":{"line":58,"column":0},"end":{"line":58,"column":40}},"58":{"start":{"line":59,"column":0},"end":{"line":59,"column":7}},"59":{"start":{"line":60,"column":0},"end":{"line":60,"column":25}},"60":{"start":{"line":61,"column":0},"end":{"line":61,"column":27}},"61":{"start":{"line":62,"column":0},"end":{"line":62,"column":49}},"62":{"start":{"line":63,"column":0},"end":{"line":63,"column":45}},"63":{"start":{"line":64,"column":0},"end":{"line":64,"column":47}},"64":{"start":{"line":65,"column":0},"end":{"line":65,"column":5}},"65":{"start":{"line":66,"column":0},"end":{"line":66,"column":0}},"66":{"start":{"line":67,"column":0},"end":{"line":67,"column":68}},"67":{"start":{"line":68,"column":0},"end":{"line":68,"column":94}},"68":{"start":{"line":69,"column":0},"end":{"line":69,"column":30}},"69":{"start":{"line":70,"column":0},"end":{"line":70,"column":54}},"70":{"start":{"line":71,"column":0},"end":{"line":71,"column":9}},"71":{"start":{"line":72,"column":0},"end":{"line":72,"column":0}},"72":{"start":{"line":73,"column":0},"end":{"line":73,"column":43}},"73":{"start":{"line":74,"column":0},"end":{"line":74,"column":95}},"74":{"start":{"line":75,"column":0},"end":{"line":75,"column":44}},"75":{"start":{"line":76,"column":0},"end":{"line":76,"column":88}},"76":{"start":{"line":77,"column":0},"end":{"line":77,"column":13}},"77":{"start":{"line":78,"column":0},"end":{"line":78,"column":9}},"78":{"start":{"line":79,"column":0},"end":{"line":79,"column":0}},"79":{"start":{"line":80,"column":0},"end":{"line":80,"column":43}},"80":{"start":{"line":81,"column":0},"end":{"line":81,"column":96}},"81":{"start":{"line":82,"column":0},"end":{"line":82,"column":28}},"82":{"start":{"line":83,"column":0},"end":{"line":83,"column":55}},"83":{"start":{"line":84,"column":0},"end":{"line":84,"column":69}},"84":{"start":{"line":85,"column":0},"end":{"line":85,"column":95}},"85":{"start":{"line":86,"column":0},"end":{"line":86,"column":17}},"86":{"start":{"line":87,"column":0},"end":{"line":87,"column":88}},"87":{"start":{"line":88,"column":0},"end":{"line":88,"column":13}},"88":{"start":{"line":89,"column":0},"end":{"line":89,"column":9}},"89":{"start":{"line":90,"column":0},"end":{"line":90,"column":0}},"90":{"start":{"line":91,"column":0},"end":{"line":91,"column":46}},"91":{"start":{"line":92,"column":0},"end":{"line":92,"column":67}},"92":{"start":{"line":93,"column":0},"end":{"line":93,"column":13}},"93":{"start":{"line":94,"column":0},"end":{"line":94,"column":10}},"94":{"start":{"line":95,"column":0},"end":{"line":95,"column":72}},"95":{"start":{"line":96,"column":0},"end":{"line":96,"column":36}},"96":{"start":{"line":97,"column":0},"end":{"line":97,"column":25}},"97":{"start":{"line":98,"column":0},"end":{"line":98,"column":10}},"98":{"start":{"line":99,"column":0},"end":{"line":99,"column":46}},"99":{"start":{"line":100,"column":0},"end":{"line":100,"column":0}},"100":{"start":{"line":101,"column":0},"end":{"line":101,"column":50}},"101":{"start":{"line":102,"column":0},"end":{"line":102,"column":106}},"102":{"start":{"line":103,"column":0},"end":{"line":103,"column":55}},"103":{"start":{"line":104,"column":0},"end":{"line":104,"column":26}},"104":{"start":{"line":105,"column":0},"end":{"line":105,"column":13}},"105":{"start":{"line":106,"column":0},"end":{"line":106,"column":31}},"106":{"start":{"line":107,"column":0},"end":{"line":107,"column":46}},"107":{"start":{"line":108,"column":0},"end":{"line":108,"column":25}},"108":{"start":{"line":109,"column":0},"end":{"line":109,"column":29}},"109":{"start":{"line":110,"column":0},"end":{"line":110,"column":22}},"110":{"start":{"line":111,"column":0},"end":{"line":111,"column":56}},"111":{"start":{"line":112,"column":0},"end":{"line":112,"column":13}},"112":{"start":{"line":113,"column":0},"end":{"line":113,"column":10}},"113":{"start":{"line":114,"column":0},"end":{"line":114,"column":0}},"114":{"start":{"line":115,"column":0},"end":{"line":115,"column":62}},"115":{"start":{"line":116,"column":0},"end":{"line":116,"column":0}},"116":{"start":{"line":117,"column":0},"end":{"line":117,"column":13}},"117":{"start":{"line":118,"column":0},"end":{"line":118,"column":46}},"118":{"start":{"line":119,"column":0},"end":{"line":119,"column":48}},"119":{"start":{"line":120,"column":0},"end":{"line":120,"column":32}},"120":{"start":{"line":121,"column":0},"end":{"line":121,"column":27}},"121":{"start":{"line":122,"column":0},"end":{"line":122,"column":38}},"122":{"start":{"line":123,"column":0},"end":{"line":123,"column":47}},"123":{"start":{"line":124,"column":0},"end":{"line":124,"column":18}},"124":{"start":{"line":125,"column":0},"end":{"line":125,"column":55}},"125":{"start":{"line":126,"column":0},"end":{"line":126,"column":15}},"126":{"start":{"line":127,"column":0},"end":{"line":127,"column":0}},"127":{"start":{"line":128,"column":0},"end":{"line":128,"column":47}},"128":{"start":{"line":129,"column":0},"end":{"line":129,"column":94}},"129":{"start":{"line":130,"column":0},"end":{"line":130,"column":13}},"130":{"start":{"line":131,"column":0},"end":{"line":131,"column":0}},"131":{"start":{"line":132,"column":0},"end":{"line":132,"column":34}},"132":{"start":{"line":133,"column":0},"end":{"line":133,"column":86}},"133":{"start":{"line":134,"column":0},"end":{"line":134,"column":26}},"134":{"start":{"line":135,"column":0},"end":{"line":135,"column":14}},"135":{"start":{"line":136,"column":0},"end":{"line":136,"column":34}},"136":{"start":{"line":137,"column":0},"end":{"line":137,"column":0}},"137":{"start":{"line":138,"column":0},"end":{"line":138,"column":35}},"138":{"start":{"line":139,"column":0},"end":{"line":139,"column":56}},"139":{"start":{"line":140,"column":0},"end":{"line":140,"column":22}},"140":{"start":{"line":141,"column":0},"end":{"line":141,"column":24}},"141":{"start":{"line":142,"column":0},"end":{"line":142,"column":14}},"142":{"start":{"line":143,"column":0},"end":{"line":143,"column":0}},"143":{"start":{"line":144,"column":0},"end":{"line":144,"column":25}},"144":{"start":{"line":145,"column":0},"end":{"line":145,"column":25}},"145":{"start":{"line":146,"column":0},"end":{"line":146,"column":47}},"146":{"start":{"line":147,"column":0},"end":{"line":147,"column":83}},"147":{"start":{"line":148,"column":0},"end":{"line":148,"column":13}},"148":{"start":{"line":149,"column":0},"end":{"line":149,"column":0}},"149":{"start":{"line":150,"column":0},"end":{"line":150,"column":34}},"150":{"start":{"line":151,"column":0},"end":{"line":151,"column":96}},"151":{"start":{"line":152,"column":0},"end":{"line":152,"column":26}},"152":{"start":{"line":153,"column":0},"end":{"line":153,"column":14}},"153":{"start":{"line":154,"column":0},"end":{"line":154,"column":44}},"154":{"start":{"line":155,"column":0},"end":{"line":155,"column":0}},"155":{"start":{"line":156,"column":0},"end":{"line":156,"column":24}},"156":{"start":{"line":157,"column":0},"end":{"line":157,"column":9}},"157":{"start":{"line":158,"column":0},"end":{"line":158,"column":5}},"158":{"start":{"line":159,"column":0},"end":{"line":159,"column":0}},"159":{"start":{"line":160,"column":0},"end":{"line":160,"column":57}},"160":{"start":{"line":161,"column":0},"end":{"line":161,"column":45}},"161":{"start":{"line":162,"column":0},"end":{"line":162,"column":49}},"162":{"start":{"line":163,"column":0},"end":{"line":163,"column":21}},"163":{"start":{"line":164,"column":0},"end":{"line":164,"column":10}},"164":{"start":{"line":165,"column":0},"end":{"line":165,"column":0}},"165":{"start":{"line":166,"column":0},"end":{"line":166,"column":39}},"166":{"start":{"line":167,"column":0},"end":{"line":167,"column":47}},"167":{"start":{"line":168,"column":0},"end":{"line":168,"column":9}},"168":{"start":{"line":169,"column":0},"end":{"line":169,"column":0}},"169":{"start":{"line":170,"column":0},"end":{"line":170,"column":50}},"170":{"start":{"line":171,"column":0},"end":{"line":171,"column":5}},"171":{"start":{"line":172,"column":0},"end":{"line":172,"column":0}},"172":{"start":{"line":173,"column":0},"end":{"line":173,"column":56}},"173":{"start":{"line":174,"column":0},"end":{"line":174,"column":55}},"174":{"start":{"line":175,"column":0},"end":{"line":175,"column":0}},"175":{"start":{"line":176,"column":0},"end":{"line":176,"column":58}},"176":{"start":{"line":177,"column":0},"end":{"line":177,"column":57}},"177":{"start":{"line":178,"column":0},"end":{"line":178,"column":9}},"178":{"start":{"line":179,"column":0},"end":{"line":179,"column":0}},"179":{"start":{"line":180,"column":0},"end":{"line":180,"column":38}},"180":{"start":{"line":181,"column":0},"end":{"line":181,"column":90}},"181":{"start":{"line":182,"column":0},"end":{"line":182,"column":32}},"182":{"start":{"line":183,"column":0},"end":{"line":183,"column":98}},"183":{"start":{"line":184,"column":0},"end":{"line":184,"column":13}},"184":{"start":{"line":185,"column":0},"end":{"line":185,"column":9}},"185":{"start":{"line":186,"column":0},"end":{"line":186,"column":0}},"186":{"start":{"line":187,"column":0},"end":{"line":187,"column":41}},"187":{"start":{"line":188,"column":0},"end":{"line":188,"column":79}},"188":{"start":{"line":189,"column":0},"end":{"line":189,"column":9}},"189":{"start":{"line":190,"column":0},"end":{"line":190,"column":0}},"190":{"start":{"line":191,"column":0},"end":{"line":191,"column":30}},"191":{"start":{"line":192,"column":0},"end":{"line":192,"column":87}},"192":{"start":{"line":193,"column":0},"end":{"line":193,"column":21}},"193":{"start":{"line":194,"column":0},"end":{"line":194,"column":10}},"194":{"start":{"line":195,"column":0},"end":{"line":195,"column":0}},"195":{"start":{"line":196,"column":0},"end":{"line":196,"column":35}},"196":{"start":{"line":197,"column":0},"end":{"line":197,"column":21}},"197":{"start":{"line":198,"column":0},"end":{"line":198,"column":5}},"198":{"start":{"line":199,"column":0},"end":{"line":199,"column":0}},"199":{"start":{"line":200,"column":0},"end":{"line":200,"column":87}},"200":{"start":{"line":201,"column":0},"end":{"line":201,"column":55}},"201":{"start":{"line":202,"column":0},"end":{"line":202,"column":0}},"202":{"start":{"line":203,"column":0},"end":{"line":203,"column":38}},"203":{"start":{"line":204,"column":0},"end":{"line":204,"column":56}},"204":{"start":{"line":205,"column":0},"end":{"line":205,"column":9}},"205":{"start":{"line":206,"column":0},"end":{"line":206,"column":0}},"206":{"start":{"line":207,"column":0},"end":{"line":207,"column":29}},"207":{"start":{"line":208,"column":0},"end":{"line":208,"column":49}},"208":{"start":{"line":209,"column":0},"end":{"line":209,"column":92}},"209":{"start":{"line":210,"column":0},"end":{"line":210,"column":29}},"210":{"start":{"line":211,"column":0},"end":{"line":211,"column":80}},"211":{"start":{"line":212,"column":0},"end":{"line":212,"column":13}},"212":{"start":{"line":213,"column":0},"end":{"line":213,"column":59}},"213":{"start":{"line":214,"column":0},"end":{"line":214,"column":76}},"214":{"start":{"line":215,"column":0},"end":{"line":215,"column":13}},"215":{"start":{"line":216,"column":0},"end":{"line":216,"column":73}},"216":{"start":{"line":217,"column":0},"end":{"line":217,"column":9}},"217":{"start":{"line":218,"column":0},"end":{"line":218,"column":0}},"218":{"start":{"line":219,"column":0},"end":{"line":219,"column":86}},"219":{"start":{"line":220,"column":0},"end":{"line":220,"column":29}},"220":{"start":{"line":221,"column":0},"end":{"line":221,"column":59}},"221":{"start":{"line":222,"column":0},"end":{"line":222,"column":9}},"222":{"start":{"line":223,"column":0},"end":{"line":223,"column":0}},"223":{"start":{"line":224,"column":0},"end":{"line":224,"column":91}},"224":{"start":{"line":225,"column":0},"end":{"line":225,"column":0}},"225":{"start":{"line":226,"column":0},"end":{"line":226,"column":49}},"226":{"start":{"line":227,"column":0},"end":{"line":227,"column":91}},"227":{"start":{"line":228,"column":0},"end":{"line":228,"column":9}},"228":{"start":{"line":229,"column":0},"end":{"line":229,"column":0}},"229":{"start":{"line":230,"column":0},"end":{"line":230,"column":30}},"230":{"start":{"line":231,"column":0},"end":{"line":231,"column":80}},"231":{"start":{"line":232,"column":0},"end":{"line":232,"column":66}},"232":{"start":{"line":233,"column":0},"end":{"line":233,"column":10}},"233":{"start":{"line":234,"column":0},"end":{"line":234,"column":0}},"234":{"start":{"line":235,"column":0},"end":{"line":235,"column":67}},"235":{"start":{"line":236,"column":0},"end":{"line":236,"column":86}},"236":{"start":{"line":237,"column":0},"end":{"line":237,"column":39}},"237":{"start":{"line":238,"column":0},"end":{"line":238,"column":14}},"238":{"start":{"line":239,"column":0},"end":{"line":239,"column":0}},"239":{"start":{"line":240,"column":0},"end":{"line":240,"column":87}},"240":{"start":{"line":241,"column":0},"end":{"line":241,"column":0}},"241":{"start":{"line":242,"column":0},"end":{"line":242,"column":45}},"242":{"start":{"line":243,"column":0},"end":{"line":243,"column":34}},"243":{"start":{"line":244,"column":0},"end":{"line":244,"column":90}},"244":{"start":{"line":245,"column":0},"end":{"line":245,"column":25}},"245":{"start":{"line":246,"column":0},"end":{"line":246,"column":14}},"246":{"start":{"line":247,"column":0},"end":{"line":247,"column":38}},"247":{"start":{"line":248,"column":0},"end":{"line":248,"column":9}},"248":{"start":{"line":249,"column":0},"end":{"line":249,"column":0}},"249":{"start":{"line":250,"column":0},"end":{"line":250,"column":21}},"250":{"start":{"line":251,"column":0},"end":{"line":251,"column":5}},"251":{"start":{"line":252,"column":0},"end":{"line":252,"column":0}},"252":{"start":{"line":253,"column":0},"end":{"line":253,"column":44}},"253":{"start":{"line":254,"column":0},"end":{"line":254,"column":16}},"254":{"start":{"line":255,"column":0},"end":{"line":255,"column":23}},"255":{"start":{"line":256,"column":0},"end":{"line":256,"column":32}},"256":{"start":{"line":257,"column":0},"end":{"line":257,"column":85}},"257":{"start":{"line":258,"column":0},"end":{"line":258,"column":47}},"258":{"start":{"line":259,"column":0},"end":{"line":259,"column":56}},"259":{"start":{"line":260,"column":0},"end":{"line":260,"column":41}},"260":{"start":{"line":261,"column":0},"end":{"line":261,"column":31}},"261":{"start":{"line":262,"column":0},"end":{"line":262,"column":28}},"262":{"start":{"line":263,"column":0},"end":{"line":263,"column":56}},"263":{"start":{"line":264,"column":0},"end":{"line":264,"column":54}},"264":{"start":{"line":265,"column":0},"end":{"line":265,"column":43}},"265":{"start":{"line":266,"column":0},"end":{"line":266,"column":38}},"266":{"start":{"line":267,"column":0},"end":{"line":267,"column":38}},"267":{"start":{"line":268,"column":0},"end":{"line":268,"column":10}},"268":{"start":{"line":269,"column":0},"end":{"line":269,"column":5}},"269":{"start":{"line":270,"column":0},"end":{"line":270,"column":1}}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1,"24":1,"25":1,"26":1,"27":1,"28":1,"29":1,"30":1,"31":1,"32":1,"33":1,"34":1,"35":1,"36":1,"37":1,"38":1,"39":1,"40":1,"41":1,"42":1,"43":1,"44":1,"45":1,"46":1,"47":1,"48":1,"49":1,"50":1,"51":1,"52":1,"53":27,"54":27,"55":27,"56":27,"57":27,"58":27,"59":27,"60":27,"61":27,"62":27,"63":27,"64":27,"65":1,"66":1,"67":20,"68":20,"69":2,"70":2,"71":18,"72":18,"73":21,"74":21,"75":2,"76":2,"77":21,"78":16,"79":17,"80":18,"81":18,"82":2,"83":2,"84":0,"85":0,"86":2,"87":2,"88":18,"89":14,"90":14,"91":14,"92":14,"93":14,"94":14,"95":14,"96":14,"97":14,"98":14,"99":14,"100":14,"101":14,"102":14,"103":14,"104":14,"105":14,"106":14,"107":14,"108":14,"109":14,"110":14,"111":14,"112":14,"113":14,"114":14,"115":14,"116":14,"117":14,"118":14,"119":14,"120":14,"121":14,"122":14,"123":14,"124":14,"125":14,"126":10,"127":14,"128":12,"129":12,"130":10,"131":10,"132":10,"133":10,"134":10,"135":10,"136":10,"137":10,"138":10,"139":10,"140":10,"141":10,"142":10,"143":10,"144":20,"145":4,"146":4,"147":4,"148":4,"149":4,"150":4,"151":4,"152":4,"153":4,"154":4,"155":4,"156":4,"157":20,"158":1,"159":1,"160":13,"161":13,"162":13,"163":13,"164":13,"165":13,"166":0,"167":0,"168":13,"169":13,"170":13,"171":1,"172":1,"173":2,"174":2,"175":2,"176":1,"177":1,"178":1,"179":1,"180":1,"181":1,"182":0,"183":0,"184":1,"185":1,"186":1,"187":1,"188":1,"189":1,"190":1,"191":1,"192":1,"193":1,"194":1,"195":1,"196":1,"197":1,"198":1,"199":1,"200":5,"201":5,"202":5,"203":1,"204":1,"205":4,"206":4,"207":4,"208":4,"209":4,"210":1,"211":1,"212":3,"213":1,"214":1,"215":2,"216":2,"217":2,"218":2,"219":4,"220":0,"221":0,"222":2,"223":2,"224":2,"225":2,"226":2,"227":2,"228":2,"229":2,"230":2,"231":2,"232":2,"233":2,"234":2,"235":2,"236":2,"237":2,"238":2,"239":2,"240":2,"241":4,"242":1,"243":1,"244":1,"245":1,"246":1,"247":1,"248":2,"249":2,"250":2,"251":1,"252":1,"253":27,"254":27,"255":27,"256":27,"257":27,"258":27,"259":27,"260":27,"261":27,"262":27,"263":27,"264":27,"265":27,"266":27,"267":27,"268":27,"269":1},"branchMap":{"0":{"type":"branch","line":53,"loc":{"start":{"line":53,"column":4},"end":{"line":65,"column":5}},"locations":[{"start":{"line":53,"column":4},"end":{"line":65,"column":5}}]},"1":{"type":"branch","line":67,"loc":{"start":{"line":67,"column":4},"end":{"line":158,"column":5}},"locations":[{"start":{"line":67,"column":4},"end":{"line":158,"column":5}}]},"2":{"type":"branch","line":69,"loc":{"start":{"line":69,"column":29},"end":{"line":71,"column":9}},"locations":[{"start":{"line":69,"column":29},"end":{"line":71,"column":9}}]},"3":{"type":"branch","line":72,"loc":{"start":{"line":72,"column":-1},"end":{"line":78,"column":9}},"locations":[{"start":{"line":72,"column":-1},"end":{"line":78,"column":9}}]},"4":{"type":"branch","line":73,"loc":{"start":{"line":73,"column":42},"end":{"line":78,"column":9}},"locations":[{"start":{"line":73,"column":42},"end":{"line":78,"column":9}}]},"5":{"type":"branch","line":75,"loc":{"start":{"line":75,"column":43},"end":{"line":77,"column":13}},"locations":[{"start":{"line":75,"column":43},"end":{"line":77,"column":13}}]},"6":{"type":"branch","line":79,"loc":{"start":{"line":79,"column":-1},"end":{"line":89,"column":9}},"locations":[{"start":{"line":79,"column":-1},"end":{"line":89,"column":9}}]},"7":{"type":"branch","line":79,"loc":{"start":{"line":79,"column":-1},"end":{"line":80,"column":42}},"locations":[{"start":{"line":79,"column":-1},"end":{"line":80,"column":42}}]},"8":{"type":"branch","line":80,"loc":{"start":{"line":80,"column":42},"end":{"line":89,"column":9}},"locations":[{"start":{"line":80,"column":42},"end":{"line":89,"column":9}}]},"9":{"type":"branch","line":82,"loc":{"start":{"line":82,"column":27},"end":{"line":88,"column":13}},"locations":[{"start":{"line":82,"column":27},"end":{"line":88,"column":13}}]},"10":{"type":"branch","line":85,"loc":{"start":{"line":85,"column":-1},"end":{"line":86,"column":17}},"locations":[{"start":{"line":85,"column":-1},"end":{"line":86,"column":17}}]},"11":{"type":"branch","line":90,"loc":{"start":{"line":90,"column":-1},"end":{"line":145,"column":17}},"locations":[{"start":{"line":90,"column":-1},"end":{"line":145,"column":17}}]},"12":{"type":"branch","line":127,"loc":{"start":{"line":127,"column":-1},"end":{"line":128,"column":46}},"locations":[{"start":{"line":127,"column":-1},"end":{"line":128,"column":46}}]},"13":{"type":"branch","line":128,"loc":{"start":{"line":128,"column":46},"end":{"line":130,"column":13}},"locations":[{"start":{"line":128,"column":46},"end":{"line":130,"column":13}}]},"14":{"type":"branch","line":131,"loc":{"start":{"line":131,"column":-1},"end":{"line":145,"column":17}},"locations":[{"start":{"line":131,"column":-1},"end":{"line":145,"column":17}}]},"15":{"type":"branch","line":145,"loc":{"start":{"line":145,"column":10},"end":{"line":157,"column":9}},"locations":[{"start":{"line":145,"column":10},"end":{"line":157,"column":9}}]},"16":{"type":"branch","line":92,"loc":{"start":{"line":92,"column":12},"end":{"line":92,"column":66}},"locations":[{"start":{"line":92,"column":12},"end":{"line":92,"column":66}}]},"17":{"type":"branch","line":160,"loc":{"start":{"line":160,"column":4},"end":{"line":171,"column":5}},"locations":[{"start":{"line":160,"column":4},"end":{"line":171,"column":5}}]},"18":{"type":"branch","line":166,"loc":{"start":{"line":166,"column":38},"end":{"line":168,"column":9}},"locations":[{"start":{"line":166,"column":38},"end":{"line":168,"column":9}}]},"19":{"type":"branch","line":173,"loc":{"start":{"line":173,"column":4},"end":{"line":198,"column":5}},"locations":[{"start":{"line":173,"column":4},"end":{"line":198,"column":5}}]},"20":{"type":"branch","line":176,"loc":{"start":{"line":176,"column":57},"end":{"line":198,"column":5}},"locations":[{"start":{"line":176,"column":57},"end":{"line":198,"column":5}}]},"21":{"type":"branch","line":182,"loc":{"start":{"line":182,"column":31},"end":{"line":184,"column":13}},"locations":[{"start":{"line":182,"column":31},"end":{"line":184,"column":13}}]},"22":{"type":"branch","line":200,"loc":{"start":{"line":200,"column":4},"end":{"line":251,"column":5}},"locations":[{"start":{"line":200,"column":4},"end":{"line":251,"column":5}}]},"23":{"type":"branch","line":203,"loc":{"start":{"line":203,"column":37},"end":{"line":205,"column":9}},"locations":[{"start":{"line":203,"column":37},"end":{"line":205,"column":9}}]},"24":{"type":"branch","line":206,"loc":{"start":{"line":206,"column":-1},"end":{"line":251,"column":5}},"locations":[{"start":{"line":206,"column":-1},"end":{"line":251,"column":5}}]},"25":{"type":"branch","line":210,"loc":{"start":{"line":210,"column":28},"end":{"line":212,"column":13}},"locations":[{"start":{"line":210,"column":28},"end":{"line":212,"column":13}}]},"26":{"type":"branch","line":213,"loc":{"start":{"line":213,"column":-1},"end":{"line":217,"column":9}},"locations":[{"start":{"line":213,"column":-1},"end":{"line":217,"column":9}}]},"27":{"type":"branch","line":213,"loc":{"start":{"line":213,"column":58},"end":{"line":215,"column":13}},"locations":[{"start":{"line":213,"column":58},"end":{"line":215,"column":13}}]},"28":{"type":"branch","line":216,"loc":{"start":{"line":216,"column":-1},"end":{"line":217,"column":9}},"locations":[{"start":{"line":216,"column":-1},"end":{"line":217,"column":9}}]},"29":{"type":"branch","line":218,"loc":{"start":{"line":218,"column":-1},"end":{"line":220,"column":28}},"locations":[{"start":{"line":218,"column":-1},"end":{"line":220,"column":28}}]},"30":{"type":"branch","line":220,"loc":{"start":{"line":220,"column":28},"end":{"line":222,"column":9}},"locations":[{"start":{"line":220,"column":28},"end":{"line":222,"column":9}}]},"31":{"type":"branch","line":223,"loc":{"start":{"line":223,"column":-1},"end":{"line":242,"column":44}},"locations":[{"start":{"line":223,"column":-1},"end":{"line":242,"column":44}}]},"32":{"type":"branch","line":242,"loc":{"start":{"line":242,"column":44},"end":{"line":248,"column":9}},"locations":[{"start":{"line":242,"column":44},"end":{"line":248,"column":9}}]},"33":{"type":"branch","line":249,"loc":{"start":{"line":249,"column":-1},"end":{"line":251,"column":5}},"locations":[{"start":{"line":249,"column":-1},"end":{"line":251,"column":5}}]},"34":{"type":"branch","line":209,"loc":{"start":{"line":209,"column":47},"end":{"line":209,"column":90}},"locations":[{"start":{"line":209,"column":47},"end":{"line":209,"column":90}}]},"35":{"type":"branch","line":235,"loc":{"start":{"line":235,"column":51},"end":{"line":238,"column":9}},"locations":[{"start":{"line":235,"column":51},"end":{"line":238,"column":9}}]},"36":{"type":"branch","line":236,"loc":{"start":{"line":236,"column":47},"end":{"line":236,"column":84}},"locations":[{"start":{"line":236,"column":47},"end":{"line":236,"column":84}}]},"37":{"type":"branch","line":240,"loc":{"start":{"line":240,"column":48},"end":{"line":240,"column":82}},"locations":[{"start":{"line":240,"column":48},"end":{"line":240,"column":82}}]},"38":{"type":"branch","line":253,"loc":{"start":{"line":253,"column":12},"end":{"line":269,"column":5}},"locations":[{"start":{"line":253,"column":12},"end":{"line":269,"column":5}}]},"39":{"type":"branch","line":257,"loc":{"start":{"line":257,"column":49},"end":{"line":257,"column":72}},"locations":[{"start":{"line":257,"column":49},"end":{"line":257,"column":72}}]},"40":{"type":"branch","line":264,"loc":{"start":{"line":264,"column":20},"end":{"line":264,"column":54}},"locations":[{"start":{"line":264,"column":20},"end":{"line":264,"column":54}}]}},"b":{"0":[27],"1":[20],"2":[2],"3":[18],"4":[21],"5":[2],"6":[17],"7":[16],"8":[18],"9":[2],"10":[0],"11":[14],"12":[10],"13":[12],"14":[10],"15":[4],"16":[16],"17":[13],"18":[0],"19":[2],"20":[1],"21":[0],"22":[5],"23":[1],"24":[4],"25":[1],"26":[3],"27":[1],"28":[2],"29":[2],"30":[0],"31":[2],"32":[1],"33":[2],"34":[4],"35":[2],"36":[2],"37":[2],"38":[27],"39":[0],"40":[0]},"fnMap":{"0":{"name":"OrderService","decl":{"start":{"line":53,"column":4},"end":{"line":65,"column":5}},"loc":{"start":{"line":53,"column":4},"end":{"line":65,"column":5}},"line":53},"1":{"name":"createOrder","decl":{"start":{"line":67,"column":4},"end":{"line":158,"column":5}},"loc":{"start":{"line":67,"column":4},"end":{"line":158,"column":5}},"line":67},"2":{"name":"getOrderById","decl":{"start":{"line":160,"column":4},"end":{"line":171,"column":5}},"loc":{"start":{"line":160,"column":4},"end":{"line":171,"column":5}},"line":160},"3":{"name":"cancelOrder","decl":{"start":{"line":173,"column":4},"end":{"line":198,"column":5}},"loc":{"start":{"line":173,"column":4},"end":{"line":198,"column":5}},"line":173},"4":{"name":"processRefund","decl":{"start":{"line":200,"column":4},"end":{"line":251,"column":5}},"loc":{"start":{"line":200,"column":4},"end":{"line":251,"column":5}},"line":200},"5":{"name":"mapRowToOrder","decl":{"start":{"line":253,"column":12},"end":{"line":269,"column":5}},"loc":{"start":{"line":253,"column":12},"end":{"line":269,"column":5}},"line":253}},"f":{"0":27,"1":20,"2":13,"3":2,"4":5,"5":27}}
+,"/app/repository_before/services/PaymentService.ts": {"path":"/app/repository_before/services/PaymentService.ts","all":false,"statementMap":{"0":{"start":{"line":1,"column":0},"end":{"line":1,"column":28}},"1":{"start":{"line":2,"column":0},"end":{"line":2,"column":0}},"2":{"start":{"line":3,"column":0},"end":{"line":3,"column":32}},"3":{"start":{"line":4,"column":0},"end":{"line":4,"column":19}},"4":{"start":{"line":5,"column":0},"end":{"line":5,"column":21}},"5":{"start":{"line":6,"column":0},"end":{"line":6,"column":15}},"6":{"start":{"line":7,"column":0},"end":{"line":7,"column":24}},"7":{"start":{"line":8,"column":0},"end":{"line":8,"column":27}},"8":{"start":{"line":9,"column":0},"end":{"line":9,"column":6}},"9":{"start":{"line":10,"column":0},"end":{"line":10,"column":27}},"10":{"start":{"line":11,"column":0},"end":{"line":11,"column":1}},"11":{"start":{"line":12,"column":0},"end":{"line":12,"column":0}},"12":{"start":{"line":13,"column":0},"end":{"line":13,"column":29}},"13":{"start":{"line":14,"column":0},"end":{"line":14,"column":27}},"14":{"start":{"line":15,"column":0},"end":{"line":15,"column":0}},"15":{"start":{"line":16,"column":0},"end":{"line":16,"column":36}},"16":{"start":{"line":17,"column":0},"end":{"line":17,"column":45}},"17":{"start":{"line":18,"column":0},"end":{"line":18,"column":37}},"18":{"start":{"line":19,"column":0},"end":{"line":19,"column":11}},"19":{"start":{"line":20,"column":0},"end":{"line":20,"column":5}},"20":{"start":{"line":21,"column":0},"end":{"line":21,"column":0}},"21":{"start":{"line":22,"column":0},"end":{"line":22,"column":73}},"22":{"start":{"line":23,"column":0},"end":{"line":23,"column":70}},"23":{"start":{"line":24,"column":0},"end":{"line":24,"column":13}},"24":{"start":{"line":25,"column":0},"end":{"line":25,"column":39}},"25":{"start":{"line":26,"column":0},"end":{"line":26,"column":43}},"26":{"start":{"line":27,"column":0},"end":{"line":27,"column":43}},"27":{"start":{"line":28,"column":0},"end":{"line":28,"column":30}},"28":{"start":{"line":29,"column":0},"end":{"line":29,"column":44}},"29":{"start":{"line":30,"column":0},"end":{"line":30,"column":34}},"30":{"start":{"line":31,"column":0},"end":{"line":31,"column":45}},"31":{"start":{"line":32,"column":0},"end":{"line":32,"column":18}},"32":{"start":{"line":33,"column":0},"end":{"line":33,"column":14}},"33":{"start":{"line":34,"column":0},"end":{"line":34,"column":13}},"34":{"start":{"line":35,"column":0},"end":{"line":35,"column":55}},"35":{"start":{"line":36,"column":0},"end":{"line":36,"column":13}},"36":{"start":{"line":37,"column":0},"end":{"line":37,"column":10}},"37":{"start":{"line":38,"column":0},"end":{"line":38,"column":0}},"38":{"start":{"line":39,"column":0},"end":{"line":39,"column":51}},"39":{"start":{"line":40,"column":0},"end":{"line":40,"column":83}},"40":{"start":{"line":41,"column":0},"end":{"line":41,"column":9}},"41":{"start":{"line":42,"column":0},"end":{"line":42,"column":0}},"42":{"start":{"line":43,"column":0},"end":{"line":43,"column":29}},"43":{"start":{"line":44,"column":0},"end":{"line":44,"column":5}},"44":{"start":{"line":45,"column":0},"end":{"line":45,"column":0}},"45":{"start":{"line":46,"column":0},"end":{"line":46,"column":87}},"46":{"start":{"line":47,"column":0},"end":{"line":47,"column":64}},"47":{"start":{"line":48,"column":0},"end":{"line":48,"column":54}},"48":{"start":{"line":49,"column":0},"end":{"line":49,"column":11}},"49":{"start":{"line":50,"column":0},"end":{"line":50,"column":0}},"50":{"start":{"line":51,"column":0},"end":{"line":51,"column":62}},"51":{"start":{"line":52,"column":0},"end":{"line":52,"column":5}},"52":{"start":{"line":53,"column":0},"end":{"line":53,"column":0}},"53":{"start":{"line":54,"column":0},"end":{"line":54,"column":83}},"54":{"start":{"line":55,"column":0},"end":{"line":55,"column":43}},"55":{"start":{"line":56,"column":0},"end":{"line":56,"column":44}},"56":{"start":{"line":57,"column":0},"end":{"line":57,"column":19}},"57":{"start":{"line":58,"column":0},"end":{"line":58,"column":11}},"58":{"start":{"line":59,"column":0},"end":{"line":59,"column":5}},"59":{"start":{"line":60,"column":0},"end":{"line":60,"column":0}},"60":{"start":{"line":61,"column":0},"end":{"line":61,"column":27}},"61":{"start":{"line":62,"column":0},"end":{"line":62,"column":33}},"62":{"start":{"line":63,"column":0},"end":{"line":63,"column":26}},"63":{"start":{"line":64,"column":0},"end":{"line":64,"column":29}},"64":{"start":{"line":65,"column":0},"end":{"line":65,"column":21}},"65":{"start":{"line":66,"column":0},"end":{"line":66,"column":86}},"66":{"start":{"line":67,"column":0},"end":{"line":67,"column":5}},"67":{"start":{"line":68,"column":0},"end":{"line":68,"column":1}}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":33,"17":33,"18":33,"19":33,"20":1,"21":1,"22":14,"23":14,"24":14,"25":14,"26":14,"27":14,"28":14,"29":14,"30":14,"31":14,"32":14,"33":14,"34":14,"35":14,"36":14,"37":14,"38":14,"39":4,"40":4,"41":10,"42":10,"43":10,"44":1,"45":1,"46":3,"47":3,"48":3,"49":3,"50":3,"51":3,"52":1,"53":1,"54":2,"55":2,"56":2,"57":2,"58":2,"59":1,"60":1,"61":6,"62":6,"63":6,"64":6,"65":6,"66":6,"67":1},"branchMap":{"0":{"type":"branch","line":16,"loc":{"start":{"line":16,"column":4},"end":{"line":20,"column":5}},"locations":[{"start":{"line":16,"column":4},"end":{"line":20,"column":5}}]},"1":{"type":"branch","line":22,"loc":{"start":{"line":22,"column":4},"end":{"line":44,"column":5}},"locations":[{"start":{"line":22,"column":4},"end":{"line":44,"column":5}}]},"2":{"type":"branch","line":39,"loc":{"start":{"line":39,"column":50},"end":{"line":41,"column":9}},"locations":[{"start":{"line":39,"column":50},"end":{"line":41,"column":9}}]},"3":{"type":"branch","line":42,"loc":{"start":{"line":42,"column":-1},"end":{"line":44,"column":5}},"locations":[{"start":{"line":42,"column":-1},"end":{"line":44,"column":5}}]},"4":{"type":"branch","line":46,"loc":{"start":{"line":46,"column":4},"end":{"line":52,"column":5}},"locations":[{"start":{"line":46,"column":4},"end":{"line":52,"column":5}}]},"5":{"type":"branch","line":51,"loc":{"start":{"line":51,"column":38},"end":{"line":51,"column":54}},"locations":[{"start":{"line":51,"column":38},"end":{"line":51,"column":54}}]},"6":{"type":"branch","line":51,"loc":{"start":{"line":51,"column":55},"end":{"line":51,"column":61}},"locations":[{"start":{"line":51,"column":55},"end":{"line":51,"column":61}}]},"7":{"type":"branch","line":54,"loc":{"start":{"line":54,"column":4},"end":{"line":59,"column":5}},"locations":[{"start":{"line":54,"column":4},"end":{"line":59,"column":5}}]},"8":{"type":"branch","line":61,"loc":{"start":{"line":61,"column":4},"end":{"line":67,"column":5}},"locations":[{"start":{"line":61,"column":4},"end":{"line":67,"column":5}}]}},"b":{"0":[33],"1":[14],"2":[4],"3":[10],"4":[3],"5":[2],"6":[1],"7":[2],"8":[6]},"fnMap":{"0":{"name":"PaymentService","decl":{"start":{"line":16,"column":4},"end":{"line":20,"column":5}},"loc":{"start":{"line":16,"column":4},"end":{"line":20,"column":5}},"line":16},"1":{"name":"charge","decl":{"start":{"line":22,"column":4},"end":{"line":44,"column":5}},"loc":{"start":{"line":22,"column":4},"end":{"line":44,"column":5}},"line":22},"2":{"name":"findPaymentByOrderId","decl":{"start":{"line":46,"column":4},"end":{"line":52,"column":5}},"loc":{"start":{"line":46,"column":4},"end":{"line":52,"column":5}},"line":46},"3":{"name":"refund","decl":{"start":{"line":54,"column":4},"end":{"line":59,"column":5}},"loc":{"start":{"line":54,"column":4},"end":{"line":59,"column":5}},"line":54},"4":{"name":"verifyWebhookSignature","decl":{"start":{"line":61,"column":4},"end":{"line":67,"column":5}},"loc":{"start":{"line":61,"column":4},"end":{"line":67,"column":5}},"line":61}},"f":{"0":33,"1":14,"2":3,"3":2,"4":6}}
+,"/app/repository_before/services/ShippingService.ts": {"path":"/app/repository_before/services/ShippingService.ts","all":false,"statementMap":{"0":{"start":{"line":1,"column":0},"end":{"line":1,"column":60}},"1":{"start":{"line":2,"column":0},"end":{"line":2,"column":0}},"2":{"start":{"line":3,"column":0},"end":{"line":3,"column":24}},"3":{"start":{"line":4,"column":0},"end":{"line":4,"column":21}},"4":{"start":{"line":5,"column":0},"end":{"line":5,"column":24}},"5":{"start":{"line":6,"column":0},"end":{"line":6,"column":1}},"6":{"start":{"line":7,"column":0},"end":{"line":7,"column":0}},"7":{"start":{"line":8,"column":0},"end":{"line":8,"column":54}},"8":{"start":{"line":9,"column":0},"end":{"line":9,"column":51}},"9":{"start":{"line":10,"column":0},"end":{"line":10,"column":51}},"10":{"start":{"line":11,"column":0},"end":{"line":11,"column":54}},"11":{"start":{"line":12,"column":0},"end":{"line":12,"column":58}},"12":{"start":{"line":13,"column":0},"end":{"line":13,"column":2}},"13":{"start":{"line":14,"column":0},"end":{"line":14,"column":0}},"14":{"start":{"line":15,"column":0},"end":{"line":15,"column":102}},"15":{"start":{"line":16,"column":0},"end":{"line":16,"column":126}},"16":{"start":{"line":17,"column":0},"end":{"line":17,"column":0}},"17":{"start":{"line":18,"column":0},"end":{"line":18,"column":30}},"18":{"start":{"line":19,"column":0},"end":{"line":19,"column":81}},"19":{"start":{"line":20,"column":0},"end":{"line":20,"column":51}},"20":{"start":{"line":21,"column":0},"end":{"line":21,"column":42}},"21":{"start":{"line":22,"column":0},"end":{"line":22,"column":0}},"22":{"start":{"line":23,"column":0},"end":{"line":23,"column":79}},"23":{"start":{"line":24,"column":0},"end":{"line":24,"column":73}},"24":{"start":{"line":25,"column":0},"end":{"line":25,"column":0}},"25":{"start":{"line":26,"column":0},"end":{"line":26,"column":44}},"26":{"start":{"line":27,"column":0},"end":{"line":27,"column":5}},"27":{"start":{"line":28,"column":0},"end":{"line":28,"column":0}},"28":{"start":{"line":29,"column":0},"end":{"line":29,"column":63}},"29":{"start":{"line":30,"column":0},"end":{"line":30,"column":39}},"30":{"start":{"line":31,"column":0},"end":{"line":31,"column":35}},"31":{"start":{"line":32,"column":0},"end":{"line":32,"column":9}},"32":{"start":{"line":33,"column":0},"end":{"line":33,"column":0}},"33":{"start":{"line":34,"column":0},"end":{"line":34,"column":50}},"34":{"start":{"line":35,"column":0},"end":{"line":35,"column":0}},"35":{"start":{"line":36,"column":0},"end":{"line":36,"column":45}},"36":{"start":{"line":37,"column":0},"end":{"line":37,"column":29}},"37":{"start":{"line":38,"column":0},"end":{"line":38,"column":9}},"38":{"start":{"line":39,"column":0},"end":{"line":39,"column":0}},"39":{"start":{"line":40,"column":0},"end":{"line":40,"column":45}},"40":{"start":{"line":41,"column":0},"end":{"line":41,"column":29}},"41":{"start":{"line":42,"column":0},"end":{"line":42,"column":9}},"42":{"start":{"line":43,"column":0},"end":{"line":43,"column":0}},"43":{"start":{"line":44,"column":0},"end":{"line":44,"column":28}},"44":{"start":{"line":45,"column":0},"end":{"line":45,"column":5}},"45":{"start":{"line":46,"column":0},"end":{"line":46,"column":0}},"46":{"start":{"line":47,"column":0},"end":{"line":47,"column":60}},"47":{"start":{"line":48,"column":0},"end":{"line":48,"column":51}},"48":{"start":{"line":49,"column":0},"end":{"line":49,"column":0}},"49":{"start":{"line":50,"column":0},"end":{"line":50,"column":23}},"50":{"start":{"line":51,"column":0},"end":{"line":51,"column":27}},"51":{"start":{"line":52,"column":0},"end":{"line":52,"column":25}},"52":{"start":{"line":53,"column":0},"end":{"line":53,"column":27}},"53":{"start":{"line":54,"column":0},"end":{"line":54,"column":25}},"54":{"start":{"line":55,"column":0},"end":{"line":55,"column":30}},"55":{"start":{"line":56,"column":0},"end":{"line":56,"column":25}},"56":{"start":{"line":57,"column":0},"end":{"line":57,"column":33}},"57":{"start":{"line":58,"column":0},"end":{"line":58,"column":26}},"58":{"start":{"line":59,"column":0},"end":{"line":59,"column":20}},"59":{"start":{"line":60,"column":0},"end":{"line":60,"column":25}},"60":{"start":{"line":61,"column":0},"end":{"line":61,"column":9}},"61":{"start":{"line":62,"column":0},"end":{"line":62,"column":5}},"62":{"start":{"line":63,"column":0},"end":{"line":63,"column":0}},"63":{"start":{"line":64,"column":0},"end":{"line":64,"column":56}},"64":{"start":{"line":65,"column":0},"end":{"line":65,"column":68}},"65":{"start":{"line":66,"column":0},"end":{"line":66,"column":25}},"66":{"start":{"line":67,"column":0},"end":{"line":67,"column":9}},"67":{"start":{"line":68,"column":0},"end":{"line":68,"column":0}},"68":{"start":{"line":69,"column":0},"end":{"line":69,"column":64}},"69":{"start":{"line":70,"column":0},"end":{"line":70,"column":25}},"70":{"start":{"line":71,"column":0},"end":{"line":71,"column":9}},"71":{"start":{"line":72,"column":0},"end":{"line":72,"column":0}},"72":{"start":{"line":73,"column":0},"end":{"line":73,"column":66}},"73":{"start":{"line":74,"column":0},"end":{"line":74,"column":25}},"74":{"start":{"line":75,"column":0},"end":{"line":75,"column":9}},"75":{"start":{"line":76,"column":0},"end":{"line":76,"column":0}},"76":{"start":{"line":77,"column":0},"end":{"line":77,"column":70}},"77":{"start":{"line":78,"column":0},"end":{"line":78,"column":25}},"78":{"start":{"line":79,"column":0},"end":{"line":79,"column":9}},"79":{"start":{"line":80,"column":0},"end":{"line":80,"column":0}},"80":{"start":{"line":81,"column":0},"end":{"line":81,"column":70}},"81":{"start":{"line":82,"column":0},"end":{"line":82,"column":25}},"82":{"start":{"line":83,"column":0},"end":{"line":83,"column":9}},"83":{"start":{"line":84,"column":0},"end":{"line":84,"column":0}},"84":{"start":{"line":85,"column":0},"end":{"line":85,"column":84}},"85":{"start":{"line":86,"column":0},"end":{"line":86,"column":25}},"86":{"start":{"line":87,"column":0},"end":{"line":87,"column":9}},"87":{"start":{"line":88,"column":0},"end":{"line":88,"column":0}},"88":{"start":{"line":89,"column":0},"end":{"line":89,"column":20}},"89":{"start":{"line":90,"column":0},"end":{"line":90,"column":5}},"90":{"start":{"line":91,"column":0},"end":{"line":91,"column":1}}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":18,"20":18,"21":18,"22":18,"23":18,"24":18,"25":18,"26":18,"27":1,"28":1,"29":22,"30":2,"31":2,"32":20,"33":20,"34":20,"35":22,"36":16,"37":16,"38":4,"39":8,"40":2,"41":2,"42":2,"43":2,"44":2,"45":1,"46":1,"47":4,"48":4,"49":4,"50":4,"51":1,"52":4,"53":1,"54":4,"55":1,"56":4,"57":1,"58":4,"59":0,"60":4,"61":4,"62":1,"63":1,"64":7,"65":1,"66":1,"67":6,"68":7,"69":1,"70":1,"71":5,"72":7,"73":1,"74":1,"75":4,"76":7,"77":1,"78":1,"79":3,"80":7,"81":1,"82":1,"83":2,"84":7,"85":1,"86":1,"87":1,"88":1,"89":1,"90":1},"branchMap":{"0":{"type":"branch","line":19,"loc":{"start":{"line":19,"column":4},"end":{"line":27,"column":5}},"locations":[{"start":{"line":19,"column":4},"end":{"line":27,"column":5}}]},"1":{"type":"branch","line":23,"loc":{"start":{"line":23,"column":40},"end":{"line":23,"column":74}},"locations":[{"start":{"line":23,"column":40},"end":{"line":23,"column":74}}]},"2":{"type":"branch","line":29,"loc":{"start":{"line":29,"column":12},"end":{"line":45,"column":5}},"locations":[{"start":{"line":29,"column":12},"end":{"line":45,"column":5}}]},"3":{"type":"branch","line":30,"loc":{"start":{"line":30,"column":38},"end":{"line":32,"column":9}},"locations":[{"start":{"line":30,"column":38},"end":{"line":32,"column":9}}]},"4":{"type":"branch","line":33,"loc":{"start":{"line":33,"column":-1},"end":{"line":36,"column":44}},"locations":[{"start":{"line":33,"column":-1},"end":{"line":36,"column":44}}]},"5":{"type":"branch","line":36,"loc":{"start":{"line":36,"column":44},"end":{"line":38,"column":9}},"locations":[{"start":{"line":36,"column":44},"end":{"line":38,"column":9}}]},"6":{"type":"branch","line":39,"loc":{"start":{"line":39,"column":-1},"end":{"line":45,"column":5}},"locations":[{"start":{"line":39,"column":-1},"end":{"line":45,"column":5}}]},"7":{"type":"branch","line":39,"loc":{"start":{"line":39,"column":-1},"end":{"line":40,"column":44}},"locations":[{"start":{"line":39,"column":-1},"end":{"line":40,"column":44}}]},"8":{"type":"branch","line":40,"loc":{"start":{"line":40,"column":44},"end":{"line":45,"column":5}},"locations":[{"start":{"line":40,"column":44},"end":{"line":45,"column":5}}]},"9":{"type":"branch","line":47,"loc":{"start":{"line":47,"column":4},"end":{"line":62,"column":5}},"locations":[{"start":{"line":47,"column":4},"end":{"line":62,"column":5}}]},"10":{"type":"branch","line":51,"loc":{"start":{"line":51,"column":12},"end":{"line":52,"column":25}},"locations":[{"start":{"line":51,"column":12},"end":{"line":52,"column":25}}]},"11":{"type":"branch","line":53,"loc":{"start":{"line":53,"column":12},"end":{"line":54,"column":25}},"locations":[{"start":{"line":53,"column":12},"end":{"line":54,"column":25}}]},"12":{"type":"branch","line":55,"loc":{"start":{"line":55,"column":12},"end":{"line":56,"column":25}},"locations":[{"start":{"line":55,"column":12},"end":{"line":56,"column":25}}]},"13":{"type":"branch","line":57,"loc":{"start":{"line":57,"column":12},"end":{"line":58,"column":26}},"locations":[{"start":{"line":57,"column":12},"end":{"line":58,"column":26}}]},"14":{"type":"branch","line":59,"loc":{"start":{"line":59,"column":12},"end":{"line":60,"column":25}},"locations":[{"start":{"line":59,"column":12},"end":{"line":60,"column":25}}]},"15":{"type":"branch","line":64,"loc":{"start":{"line":64,"column":4},"end":{"line":90,"column":5}},"locations":[{"start":{"line":64,"column":4},"end":{"line":90,"column":5}}]},"16":{"type":"branch","line":65,"loc":{"start":{"line":65,"column":27},"end":{"line":65,"column":65}},"locations":[{"start":{"line":65,"column":27},"end":{"line":65,"column":65}}]},"17":{"type":"branch","line":65,"loc":{"start":{"line":65,"column":67},"end":{"line":67,"column":9}},"locations":[{"start":{"line":65,"column":67},"end":{"line":67,"column":9}}]},"18":{"type":"branch","line":68,"loc":{"start":{"line":68,"column":-1},"end":{"line":69,"column":29}},"locations":[{"start":{"line":68,"column":-1},"end":{"line":69,"column":29}}]},"19":{"type":"branch","line":69,"loc":{"start":{"line":69,"column":25},"end":{"line":69,"column":61}},"locations":[{"start":{"line":69,"column":25},"end":{"line":69,"column":61}}]},"20":{"type":"branch","line":69,"loc":{"start":{"line":69,"column":63},"end":{"line":71,"column":9}},"locations":[{"start":{"line":69,"column":63},"end":{"line":71,"column":9}}]},"21":{"type":"branch","line":72,"loc":{"start":{"line":72,"column":-1},"end":{"line":73,"column":30}},"locations":[{"start":{"line":72,"column":-1},"end":{"line":73,"column":30}}]},"22":{"type":"branch","line":73,"loc":{"start":{"line":73,"column":26},"end":{"line":73,"column":63}},"locations":[{"start":{"line":73,"column":26},"end":{"line":73,"column":63}}]},"23":{"type":"branch","line":73,"loc":{"start":{"line":73,"column":65},"end":{"line":75,"column":9}},"locations":[{"start":{"line":73,"column":65},"end":{"line":75,"column":9}}]},"24":{"type":"branch","line":76,"loc":{"start":{"line":76,"column":-1},"end":{"line":77,"column":32}},"locations":[{"start":{"line":76,"column":-1},"end":{"line":77,"column":32}}]},"25":{"type":"branch","line":77,"loc":{"start":{"line":77,"column":28},"end":{"line":77,"column":67}},"locations":[{"start":{"line":77,"column":28},"end":{"line":77,"column":67}}]},"26":{"type":"branch","line":77,"loc":{"start":{"line":77,"column":69},"end":{"line":79,"column":9}},"locations":[{"start":{"line":77,"column":69},"end":{"line":79,"column":9}}]},"27":{"type":"branch","line":80,"loc":{"start":{"line":80,"column":-1},"end":{"line":81,"column":32}},"locations":[{"start":{"line":80,"column":-1},"end":{"line":81,"column":32}}]},"28":{"type":"branch","line":81,"loc":{"start":{"line":81,"column":28},"end":{"line":81,"column":67}},"locations":[{"start":{"line":81,"column":28},"end":{"line":81,"column":67}}]},"29":{"type":"branch","line":81,"loc":{"start":{"line":81,"column":69},"end":{"line":83,"column":9}},"locations":[{"start":{"line":81,"column":69},"end":{"line":83,"column":9}}]},"30":{"type":"branch","line":84,"loc":{"start":{"line":84,"column":-1},"end":{"line":85,"column":81}},"locations":[{"start":{"line":84,"column":-1},"end":{"line":85,"column":81}}]},"31":{"type":"branch","line":85,"loc":{"start":{"line":85,"column":83},"end":{"line":90,"column":5}},"locations":[{"start":{"line":85,"column":83},"end":{"line":90,"column":5}}]}},"b":{"0":[18],"1":[20],"2":[22],"3":[2],"4":[20],"5":[16],"6":[8],"7":[4],"8":[2],"9":[4],"10":[1],"11":[1],"12":[1],"13":[1],"14":[0],"15":[7],"16":[6],"17":[1],"18":[6],"19":[5],"20":[1],"21":[5],"22":[4],"23":[1],"24":[4],"25":[3],"26":[1],"27":[3],"28":[2],"29":[1],"30":[2],"31":[1]},"fnMap":{"0":{"name":"calculateShippingCost","decl":{"start":{"line":19,"column":4},"end":{"line":27,"column":5}},"loc":{"start":{"line":19,"column":4},"end":{"line":27,"column":5}},"line":19},"1":{"name":"getShippingZone","decl":{"start":{"line":29,"column":12},"end":{"line":45,"column":5}},"loc":{"start":{"line":29,"column":12},"end":{"line":45,"column":5}},"line":29},"2":{"name":"estimateDeliveryDays","decl":{"start":{"line":47,"column":4},"end":{"line":62,"column":5}},"loc":{"start":{"line":47,"column":4},"end":{"line":62,"column":5}},"line":47},"3":{"name":"validateAddress","decl":{"start":{"line":64,"column":4},"end":{"line":90,"column":5}},"loc":{"start":{"line":64,"column":4},"end":{"line":90,"column":5}},"line":64}},"f":{"0":18,"1":22,"2":4,"3":7}}
+}
diff --git a/repository_after/coverage/coverage-summary.json b/repository_after/coverage/coverage-summary.json
new file mode 100644
index 0000000..26b0c9b
--- /dev/null
+++ b/repository_after/coverage/coverage-summary.json
@@ -0,0 +1,6 @@
+{"total": {"lines":{"total":552,"covered":537,"skipped":0,"pct":97.28},"statements":{"total":552,"covered":537,"skipped":0,"pct":97.28},"functions":{"total":22,"covered":22,"skipped":0,"pct":100},"branches":{"total":103,"covered":93,"skipped":0,"pct":90.29},"branchesTrue":{"total":0,"covered":0,"skipped":0,"pct":"Unknown"}}
+,"/app/repository_before/services/InventoryService.ts": {"lines":{"total":123,"covered":117,"skipped":0,"pct":95.12},"functions":{"total":7,"covered":7,"skipped":0,"pct":100},"statements":{"total":123,"covered":117,"skipped":0,"pct":95.12},"branches":{"total":21,"covered":18,"skipped":0,"pct":85.71}}
+,"/app/repository_before/services/OrderService.ts": {"lines":{"total":270,"covered":262,"skipped":0,"pct":97.03},"functions":{"total":6,"covered":6,"skipped":0,"pct":100},"statements":{"total":270,"covered":262,"skipped":0,"pct":97.03},"branches":{"total":41,"covered":35,"skipped":0,"pct":85.36}}
+,"/app/repository_before/services/PaymentService.ts": {"lines":{"total":68,"covered":68,"skipped":0,"pct":100},"functions":{"total":5,"covered":5,"skipped":0,"pct":100},"statements":{"total":68,"covered":68,"skipped":0,"pct":100},"branches":{"total":9,"covered":9,"skipped":0,"pct":100}}
+,"/app/repository_before/services/ShippingService.ts": {"lines":{"total":91,"covered":90,"skipped":0,"pct":98.9},"functions":{"total":4,"covered":4,"skipped":0,"pct":100},"statements":{"total":91,"covered":90,"skipped":0,"pct":98.9},"branches":{"total":32,"covered":31,"skipped":0,"pct":96.87}}
+}
diff --git a/repository_after/coverage/lcov-report/InventoryService.ts.html b/repository_after/coverage/lcov-report/InventoryService.ts.html
new file mode 100644
index 0000000..ed63527
--- /dev/null
+++ b/repository_after/coverage/lcov-report/InventoryService.ts.html
@@ -0,0 +1,454 @@
+
+<!doctype html>
+<html lang="en">
+
+<head>
+    <title>Code coverage report for InventoryService.ts</title>
+    <meta charset="utf-8" />
+    <link rel="stylesheet" href="prettify.css" />
+    <link rel="stylesheet" href="base.css" />
+    <link rel="shortcut icon" type="image/x-icon" href="favicon.png" />
+    <meta name="viewport" content="width=device-width, initial-scale=1" />
+    <style type='text/css'>
+        .coverage-summary .sorter {
+            background-image: url(sort-arrow-sprite.png);
+        }
+    </style>
+</head>
+    
+<body>
+<div class='wrapper'>
+    <div class='pad1'>
+        <h1><a href="index.html">All files</a> InventoryService.ts</h1>
+        <div class='clearfix'>
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">95.12% </span>
+                <span class="quiet">Statements</span>
+                <span class='fraction'>117/123</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">85.71% </span>
+                <span class="quiet">Branches</span>
+                <span class='fraction'>18/21</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">100% </span>
+                <span class="quiet">Functions</span>
+                <span class='fraction'>7/7</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">95.12% </span>
+                <span class="quiet">Lines</span>
+                <span class='fraction'>117/123</span>
+            </div>
+        
+            
+        </div>
+        <p class="quiet">
+            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
+        </p>
+        <template id="filterTemplate">
+            <div class="quiet">
+                Filter:
+                <input type="search" id="fileSearch">
+            </div>
+        </template>
+    </div>
+    <div class='status-line high'></div>
+    <pre><table class="coverage">
+<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a>
+<a name='L2'></a><a href='#L2'>2</a>
+<a name='L3'></a><a href='#L3'>3</a>
+<a name='L4'></a><a href='#L4'>4</a>
+<a name='L5'></a><a href='#L5'>5</a>
+<a name='L6'></a><a href='#L6'>6</a>
+<a name='L7'></a><a href='#L7'>7</a>
+<a name='L8'></a><a href='#L8'>8</a>
+<a name='L9'></a><a href='#L9'>9</a>
+<a name='L10'></a><a href='#L10'>10</a>
+<a name='L11'></a><a href='#L11'>11</a>
+<a name='L12'></a><a href='#L12'>12</a>
+<a name='L13'></a><a href='#L13'>13</a>
+<a name='L14'></a><a href='#L14'>14</a>
+<a name='L15'></a><a href='#L15'>15</a>
+<a name='L16'></a><a href='#L16'>16</a>
+<a name='L17'></a><a href='#L17'>17</a>
+<a name='L18'></a><a href='#L18'>18</a>
+<a name='L19'></a><a href='#L19'>19</a>
+<a name='L20'></a><a href='#L20'>20</a>
+<a name='L21'></a><a href='#L21'>21</a>
+<a name='L22'></a><a href='#L22'>22</a>
+<a name='L23'></a><a href='#L23'>23</a>
+<a name='L24'></a><a href='#L24'>24</a>
+<a name='L25'></a><a href='#L25'>25</a>
+<a name='L26'></a><a href='#L26'>26</a>
+<a name='L27'></a><a href='#L27'>27</a>
+<a name='L28'></a><a href='#L28'>28</a>
+<a name='L29'></a><a href='#L29'>29</a>
+<a name='L30'></a><a href='#L30'>30</a>
+<a name='L31'></a><a href='#L31'>31</a>
+<a name='L32'></a><a href='#L32'>32</a>
+<a name='L33'></a><a href='#L33'>33</a>
+<a name='L34'></a><a href='#L34'>34</a>
+<a name='L35'></a><a href='#L35'>35</a>
+<a name='L36'></a><a href='#L36'>36</a>
+<a name='L37'></a><a href='#L37'>37</a>
+<a name='L38'></a><a href='#L38'>38</a>
+<a name='L39'></a><a href='#L39'>39</a>
+<a name='L40'></a><a href='#L40'>40</a>
+<a name='L41'></a><a href='#L41'>41</a>
+<a name='L42'></a><a href='#L42'>42</a>
+<a name='L43'></a><a href='#L43'>43</a>
+<a name='L44'></a><a href='#L44'>44</a>
+<a name='L45'></a><a href='#L45'>45</a>
+<a name='L46'></a><a href='#L46'>46</a>
+<a name='L47'></a><a href='#L47'>47</a>
+<a name='L48'></a><a href='#L48'>48</a>
+<a name='L49'></a><a href='#L49'>49</a>
+<a name='L50'></a><a href='#L50'>50</a>
+<a name='L51'></a><a href='#L51'>51</a>
+<a name='L52'></a><a href='#L52'>52</a>
+<a name='L53'></a><a href='#L53'>53</a>
+<a name='L54'></a><a href='#L54'>54</a>
+<a name='L55'></a><a href='#L55'>55</a>
+<a name='L56'></a><a href='#L56'>56</a>
+<a name='L57'></a><a href='#L57'>57</a>
+<a name='L58'></a><a href='#L58'>58</a>
+<a name='L59'></a><a href='#L59'>59</a>
+<a name='L60'></a><a href='#L60'>60</a>
+<a name='L61'></a><a href='#L61'>61</a>
+<a name='L62'></a><a href='#L62'>62</a>
+<a name='L63'></a><a href='#L63'>63</a>
+<a name='L64'></a><a href='#L64'>64</a>
+<a name='L65'></a><a href='#L65'>65</a>
+<a name='L66'></a><a href='#L66'>66</a>
+<a name='L67'></a><a href='#L67'>67</a>
+<a name='L68'></a><a href='#L68'>68</a>
+<a name='L69'></a><a href='#L69'>69</a>
+<a name='L70'></a><a href='#L70'>70</a>
+<a name='L71'></a><a href='#L71'>71</a>
+<a name='L72'></a><a href='#L72'>72</a>
+<a name='L73'></a><a href='#L73'>73</a>
+<a name='L74'></a><a href='#L74'>74</a>
+<a name='L75'></a><a href='#L75'>75</a>
+<a name='L76'></a><a href='#L76'>76</a>
+<a name='L77'></a><a href='#L77'>77</a>
+<a name='L78'></a><a href='#L78'>78</a>
+<a name='L79'></a><a href='#L79'>79</a>
+<a name='L80'></a><a href='#L80'>80</a>
+<a name='L81'></a><a href='#L81'>81</a>
+<a name='L82'></a><a href='#L82'>82</a>
+<a name='L83'></a><a href='#L83'>83</a>
+<a name='L84'></a><a href='#L84'>84</a>
+<a name='L85'></a><a href='#L85'>85</a>
+<a name='L86'></a><a href='#L86'>86</a>
+<a name='L87'></a><a href='#L87'>87</a>
+<a name='L88'></a><a href='#L88'>88</a>
+<a name='L89'></a><a href='#L89'>89</a>
+<a name='L90'></a><a href='#L90'>90</a>
+<a name='L91'></a><a href='#L91'>91</a>
+<a name='L92'></a><a href='#L92'>92</a>
+<a name='L93'></a><a href='#L93'>93</a>
+<a name='L94'></a><a href='#L94'>94</a>
+<a name='L95'></a><a href='#L95'>95</a>
+<a name='L96'></a><a href='#L96'>96</a>
+<a name='L97'></a><a href='#L97'>97</a>
+<a name='L98'></a><a href='#L98'>98</a>
+<a name='L99'></a><a href='#L99'>99</a>
+<a name='L100'></a><a href='#L100'>100</a>
+<a name='L101'></a><a href='#L101'>101</a>
+<a name='L102'></a><a href='#L102'>102</a>
+<a name='L103'></a><a href='#L103'>103</a>
+<a name='L104'></a><a href='#L104'>104</a>
+<a name='L105'></a><a href='#L105'>105</a>
+<a name='L106'></a><a href='#L106'>106</a>
+<a name='L107'></a><a href='#L107'>107</a>
+<a name='L108'></a><a href='#L108'>108</a>
+<a name='L109'></a><a href='#L109'>109</a>
+<a name='L110'></a><a href='#L110'>110</a>
+<a name='L111'></a><a href='#L111'>111</a>
+<a name='L112'></a><a href='#L112'>112</a>
+<a name='L113'></a><a href='#L113'>113</a>
+<a name='L114'></a><a href='#L114'>114</a>
+<a name='L115'></a><a href='#L115'>115</a>
+<a name='L116'></a><a href='#L116'>116</a>
+<a name='L117'></a><a href='#L117'>117</a>
+<a name='L118'></a><a href='#L118'>118</a>
+<a name='L119'></a><a href='#L119'>119</a>
+<a name='L120'></a><a href='#L120'>120</a>
+<a name='L121'></a><a href='#L121'>121</a>
+<a name='L122'></a><a href='#L122'>122</a>
+<a name='L123'></a><a href='#L123'>123</a>
+<a name='L124'></a><a href='#L124'>124</a></td><td class="line-coverage quiet"><span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">27x</span>
+<span class="cline-any cline-yes">27x</span>
+<span class="cline-any cline-yes">27x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">45x</span>
+<span class="cline-any cline-yes">45x</span>
+<span class="cline-any cline-yes">45x</span>
+<span class="cline-any cline-yes">45x</span>
+<span class="cline-any cline-yes">45x</span>
+<span class="cline-any cline-yes">45x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">44x</span>
+<span class="cline-any cline-yes">44x</span>
+<span class="cline-any cline-yes">44x</span>
+<span class="cline-any cline-yes">44x</span>
+<span class="cline-any cline-yes">44x</span>
+<span class="cline-any cline-yes">44x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">82x</span>
+<span class="cline-any cline-yes">82x</span>
+<span class="cline-any cline-yes">82x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">25x</span>
+<span class="cline-any cline-yes">25x</span>
+<span class="cline-any cline-yes">25x</span>
+<span class="cline-any cline-yes">25x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">21x</span>
+<span class="cline-any cline-yes">21x</span>
+<span class="cline-any cline-yes">21x</span>
+<span class="cline-any cline-yes">21x</span>
+<span class="cline-any cline-yes">25x</span>
+<span class="cline-any cline-yes">3x</span>
+<span class="cline-any cline-yes">3x</span>
+<span class="cline-any cline-yes">18x</span>
+<span class="cline-any cline-yes">18x</span>
+<span class="cline-any cline-yes">18x</span>
+<span class="cline-any cline-yes">18x</span>
+<span class="cline-any cline-yes">18x</span>
+<span class="cline-any cline-yes">18x</span>
+<span class="cline-any cline-yes">18x</span>
+<span class="cline-any cline-yes">18x</span>
+<span class="cline-any cline-yes">18x</span>
+<span class="cline-any cline-yes">21x</span>
+<span class="cline-any cline-yes">21x</span>
+<span class="cline-any cline-yes">25x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">12x</span>
+<span class="cline-any cline-yes">12x</span>
+<span class="cline-any cline-yes">12x</span>
+<span class="cline-any cline-yes">12x</span>
+<span class="cline-any cline-yes">12x</span>
+<span class="cline-any cline-yes">12x</span>
+<span class="cline-any cline-yes">12x</span>
+<span class="cline-any cline-yes">12x</span>
+<span class="cline-any cline-yes">12x</span>
+<span class="cline-any cline-yes">12x</span>
+<span class="cline-any cline-yes">12x</span>
+<span class="cline-any cline-yes">12x</span>
+<span class="cline-any cline-yes">12x</span>
+<span class="cline-any cline-yes">12x</span>
+<span class="cline-any cline-yes">12x</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-yes">12x</span>
+<span class="cline-any cline-yes">12x</span>
+<span class="cline-any cline-yes">12x</span>
+<span class="cline-any cline-yes">12x</span>
+<span class="cline-any cline-yes">12x</span>
+<span class="cline-any cline-yes">12x</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-yes">12x</span>
+<span class="cline-any cline-yes">12x</span>
+<span class="cline-any cline-yes">12x</span>
+<span class="cline-any cline-yes">12x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">8x</span>
+<span class="cline-any cline-yes">8x</span>
+<span class="cline-any cline-yes">8x</span>
+<span class="cline-any cline-yes">8x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">8x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">import { Pool } from 'pg';
+import { Redis } from 'ioredis';
+&nbsp;
+const RESERVATION_TTL_SECONDS = 15 * 60;
+&nbsp;
+export class InventoryService {
+    private pool: Pool;
+    private redis: Redis;
+&nbsp;
+    constructor(pool: Pool, redis: Redis) {
+        this.pool = pool;
+        this.redis = redis;
+    }
+&nbsp;
+    async getAvailableQuantity(productId: string): Promise&lt;number&gt; {
+        const result = await this.pool.query(
+            'SELECT quantity FROM inventory WHERE product_id = $1',
+            [productId]
+        );
+&nbsp;
+        if (result.rows.length === 0) {
+            return 0;
+        }
+&nbsp;
+        const dbQuantity = result.rows[0].quantity;
+        const reserved = await this.getReservedQuantity(productId);
+&nbsp;
+        return Math.max(0, dbQuantity - reserved);
+    }
+&nbsp;
+    async getReservedQuantity(productId: string): Promise&lt;number&gt; {
+        const reserved = await this.redis.get(`reservation:${productId}`);
+        return reserved ? parseInt(reserved, 10) : 0;
+    }
+&nbsp;
+    async reserve(productId: string, quantity: number): Promise&lt;boolean&gt; {
+        const lockKey = `lock:inventory:${productId}`;
+        const lockAcquired = await this.redis.set(lockKey, '1', 'EX', 10, 'NX');
+&nbsp;
+        if (!lockAcquired) {
+            await new Promise((resolve) =&gt; setTimeout(resolve, 100));
+            return this.reserve(productId, quantity);
+        }
+&nbsp;
+        try {
+            const available = await this.getAvailableQuantity(productId);
+&nbsp;
+            if (available &lt; quantity) {
+                return false;
+            }
+&nbsp;
+            const reservationKey = `reservation:${productId}`;
+            const currentReserved = await this.getReservedQuantity(productId);
+            const newReserved = currentReserved + quantity;
+&nbsp;
+            await this.redis.setex(reservationKey, RESERVATION_TTL_SECONDS, newReserved.toString());
+&nbsp;
+            return true;
+        } finally {
+            await this.redis.del(lockKey);
+        }
+    }
+&nbsp;
+    async confirmReservation(productId: string, quantity: number): Promise&lt;void&gt; {
+        const client = await this.pool.connect();
+&nbsp;
+        try {
+            await client.query('BEGIN');
+&nbsp;
+            await client.query(
+                'UPDATE inventory SET quantity = quantity - $1, updated_at = NOW() WHERE product_id = $2',
+                [quantity, productId]
+            );
+&nbsp;
+            const reservationKey = `reservation:${productId}`;
+            const currentReserved = await this.getReservedQuantity(productId);
+            const newReserved = Math.max(0, currentReserved - quantity);
+&nbsp;
+            if (newReserved &gt; 0) <span class="branch-0 cbranch-no" title="branch not covered" >{</span>
+<span class="cstat-no" title="statement not covered" >                const ttl = await this.redis.ttl(reservationKey);</span>
+<span class="cstat-no" title="statement not covered" >                await this.redis.setex(reservationKey, ttl &gt; 0 ? ttl : RESERVATION_TTL_SECONDS, newReserved.toString());</span>
+            } else {
+                await this.redis.del(reservationKey);
+            }
+&nbsp;
+            await client.query('COMMIT');
+        } <span class="branch-0 cbranch-no" title="branch not covered" >catch (error) {</span>
+<span class="cstat-no" title="statement not covered" >            await client.query('ROLLBACK');</span>
+<span class="cstat-no" title="statement not covered" >            throw error;</span>
+        } finally {
+            client.release();
+        }
+    }
+&nbsp;
+    async release(productId: string, quantity: number): Promise&lt;void&gt; {
+        const reservationKey = `reservation:${productId}`;
+        const currentReserved = await this.getReservedQuantity(productId);
+&nbsp;
+        if (currentReserved &gt; 0) {
+            const newReserved = Math.max(0, currentReserved - quantity);
+            if (newReserved &gt; 0) <span class="branch-0 cbranch-no" title="branch not covered" >{</span>
+<span class="cstat-no" title="statement not covered" >                const ttl = await this.redis.ttl(reservationKey);</span>
+<span class="cstat-no" title="statement not covered" >                await this.redis.setex(reservationKey, ttl &gt; 0 ? ttl : RESERVATION_TTL_SECONDS, newReserved.toString());</span>
+            } else {
+                await this.redis.del(reservationKey);
+            }
+        } else {
+            await this.pool.query(
+                'UPDATE inventory SET quantity = quantity + $1, updated_at = NOW() WHERE product_id = $2',
+                [quantity, productId]
+            );
+        }
+    }
+&nbsp;
+    async setQuantity(productId: string, quantity: number): Promise&lt;void&gt; {
+        await this.pool.query(
+            `INSERT INTO inventory (product_id, quantity)
+             VALUES ($1, $2)
+             ON CONFLICT (product_id) DO UPDATE SET quantity = $2, updated_at = NOW()`,
+            [productId, quantity]
+        );
+    }
+}
+&nbsp;</pre></td></tr></table></pre>
+
+                <div class='push'></div><!-- for sticky footer -->
+            </div><!-- /wrapper -->
+            <div class='footer quiet pad2 space-top1 center small'>
+                Code coverage generated by
+                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
+                at 2026-02-05T08:57:14.339Z
+            </div>
+        <script src="prettify.js"></script>
+        <script>
+            window.onload = function () {
+                prettyPrint();
+            };
+        </script>
+        <script src="sorter.js"></script>
+        <script src="block-navigation.js"></script>
+    </body>
+</html>
+    
\ No newline at end of file
diff --git a/repository_after/coverage/lcov-report/OrderService.ts.html b/repository_after/coverage/lcov-report/OrderService.ts.html
new file mode 100644
index 0000000..86a3457
--- /dev/null
+++ b/repository_after/coverage/lcov-report/OrderService.ts.html
@@ -0,0 +1,895 @@
+
+<!doctype html>
+<html lang="en">
+
+<head>
+    <title>Code coverage report for OrderService.ts</title>
+    <meta charset="utf-8" />
+    <link rel="stylesheet" href="prettify.css" />
+    <link rel="stylesheet" href="base.css" />
+    <link rel="shortcut icon" type="image/x-icon" href="favicon.png" />
+    <meta name="viewport" content="width=device-width, initial-scale=1" />
+    <style type='text/css'>
+        .coverage-summary .sorter {
+            background-image: url(sort-arrow-sprite.png);
+        }
+    </style>
+</head>
+    
+<body>
+<div class='wrapper'>
+    <div class='pad1'>
+        <h1><a href="index.html">All files</a> OrderService.ts</h1>
+        <div class='clearfix'>
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">97.03% </span>
+                <span class="quiet">Statements</span>
+                <span class='fraction'>262/270</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">85.36% </span>
+                <span class="quiet">Branches</span>
+                <span class='fraction'>35/41</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">100% </span>
+                <span class="quiet">Functions</span>
+                <span class='fraction'>6/6</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">97.03% </span>
+                <span class="quiet">Lines</span>
+                <span class='fraction'>262/270</span>
+            </div>
+        
+            
+        </div>
+        <p class="quiet">
+            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
+        </p>
+        <template id="filterTemplate">
+            <div class="quiet">
+                Filter:
+                <input type="search" id="fileSearch">
+            </div>
+        </template>
+    </div>
+    <div class='status-line high'></div>
+    <pre><table class="coverage">
+<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a>
+<a name='L2'></a><a href='#L2'>2</a>
+<a name='L3'></a><a href='#L3'>3</a>
+<a name='L4'></a><a href='#L4'>4</a>
+<a name='L5'></a><a href='#L5'>5</a>
+<a name='L6'></a><a href='#L6'>6</a>
+<a name='L7'></a><a href='#L7'>7</a>
+<a name='L8'></a><a href='#L8'>8</a>
+<a name='L9'></a><a href='#L9'>9</a>
+<a name='L10'></a><a href='#L10'>10</a>
+<a name='L11'></a><a href='#L11'>11</a>
+<a name='L12'></a><a href='#L12'>12</a>
+<a name='L13'></a><a href='#L13'>13</a>
+<a name='L14'></a><a href='#L14'>14</a>
+<a name='L15'></a><a href='#L15'>15</a>
+<a name='L16'></a><a href='#L16'>16</a>
+<a name='L17'></a><a href='#L17'>17</a>
+<a name='L18'></a><a href='#L18'>18</a>
+<a name='L19'></a><a href='#L19'>19</a>
+<a name='L20'></a><a href='#L20'>20</a>
+<a name='L21'></a><a href='#L21'>21</a>
+<a name='L22'></a><a href='#L22'>22</a>
+<a name='L23'></a><a href='#L23'>23</a>
+<a name='L24'></a><a href='#L24'>24</a>
+<a name='L25'></a><a href='#L25'>25</a>
+<a name='L26'></a><a href='#L26'>26</a>
+<a name='L27'></a><a href='#L27'>27</a>
+<a name='L28'></a><a href='#L28'>28</a>
+<a name='L29'></a><a href='#L29'>29</a>
+<a name='L30'></a><a href='#L30'>30</a>
+<a name='L31'></a><a href='#L31'>31</a>
+<a name='L32'></a><a href='#L32'>32</a>
+<a name='L33'></a><a href='#L33'>33</a>
+<a name='L34'></a><a href='#L34'>34</a>
+<a name='L35'></a><a href='#L35'>35</a>
+<a name='L36'></a><a href='#L36'>36</a>
+<a name='L37'></a><a href='#L37'>37</a>
+<a name='L38'></a><a href='#L38'>38</a>
+<a name='L39'></a><a href='#L39'>39</a>
+<a name='L40'></a><a href='#L40'>40</a>
+<a name='L41'></a><a href='#L41'>41</a>
+<a name='L42'></a><a href='#L42'>42</a>
+<a name='L43'></a><a href='#L43'>43</a>
+<a name='L44'></a><a href='#L44'>44</a>
+<a name='L45'></a><a href='#L45'>45</a>
+<a name='L46'></a><a href='#L46'>46</a>
+<a name='L47'></a><a href='#L47'>47</a>
+<a name='L48'></a><a href='#L48'>48</a>
+<a name='L49'></a><a href='#L49'>49</a>
+<a name='L50'></a><a href='#L50'>50</a>
+<a name='L51'></a><a href='#L51'>51</a>
+<a name='L52'></a><a href='#L52'>52</a>
+<a name='L53'></a><a href='#L53'>53</a>
+<a name='L54'></a><a href='#L54'>54</a>
+<a name='L55'></a><a href='#L55'>55</a>
+<a name='L56'></a><a href='#L56'>56</a>
+<a name='L57'></a><a href='#L57'>57</a>
+<a name='L58'></a><a href='#L58'>58</a>
+<a name='L59'></a><a href='#L59'>59</a>
+<a name='L60'></a><a href='#L60'>60</a>
+<a name='L61'></a><a href='#L61'>61</a>
+<a name='L62'></a><a href='#L62'>62</a>
+<a name='L63'></a><a href='#L63'>63</a>
+<a name='L64'></a><a href='#L64'>64</a>
+<a name='L65'></a><a href='#L65'>65</a>
+<a name='L66'></a><a href='#L66'>66</a>
+<a name='L67'></a><a href='#L67'>67</a>
+<a name='L68'></a><a href='#L68'>68</a>
+<a name='L69'></a><a href='#L69'>69</a>
+<a name='L70'></a><a href='#L70'>70</a>
+<a name='L71'></a><a href='#L71'>71</a>
+<a name='L72'></a><a href='#L72'>72</a>
+<a name='L73'></a><a href='#L73'>73</a>
+<a name='L74'></a><a href='#L74'>74</a>
+<a name='L75'></a><a href='#L75'>75</a>
+<a name='L76'></a><a href='#L76'>76</a>
+<a name='L77'></a><a href='#L77'>77</a>
+<a name='L78'></a><a href='#L78'>78</a>
+<a name='L79'></a><a href='#L79'>79</a>
+<a name='L80'></a><a href='#L80'>80</a>
+<a name='L81'></a><a href='#L81'>81</a>
+<a name='L82'></a><a href='#L82'>82</a>
+<a name='L83'></a><a href='#L83'>83</a>
+<a name='L84'></a><a href='#L84'>84</a>
+<a name='L85'></a><a href='#L85'>85</a>
+<a name='L86'></a><a href='#L86'>86</a>
+<a name='L87'></a><a href='#L87'>87</a>
+<a name='L88'></a><a href='#L88'>88</a>
+<a name='L89'></a><a href='#L89'>89</a>
+<a name='L90'></a><a href='#L90'>90</a>
+<a name='L91'></a><a href='#L91'>91</a>
+<a name='L92'></a><a href='#L92'>92</a>
+<a name='L93'></a><a href='#L93'>93</a>
+<a name='L94'></a><a href='#L94'>94</a>
+<a name='L95'></a><a href='#L95'>95</a>
+<a name='L96'></a><a href='#L96'>96</a>
+<a name='L97'></a><a href='#L97'>97</a>
+<a name='L98'></a><a href='#L98'>98</a>
+<a name='L99'></a><a href='#L99'>99</a>
+<a name='L100'></a><a href='#L100'>100</a>
+<a name='L101'></a><a href='#L101'>101</a>
+<a name='L102'></a><a href='#L102'>102</a>
+<a name='L103'></a><a href='#L103'>103</a>
+<a name='L104'></a><a href='#L104'>104</a>
+<a name='L105'></a><a href='#L105'>105</a>
+<a name='L106'></a><a href='#L106'>106</a>
+<a name='L107'></a><a href='#L107'>107</a>
+<a name='L108'></a><a href='#L108'>108</a>
+<a name='L109'></a><a href='#L109'>109</a>
+<a name='L110'></a><a href='#L110'>110</a>
+<a name='L111'></a><a href='#L111'>111</a>
+<a name='L112'></a><a href='#L112'>112</a>
+<a name='L113'></a><a href='#L113'>113</a>
+<a name='L114'></a><a href='#L114'>114</a>
+<a name='L115'></a><a href='#L115'>115</a>
+<a name='L116'></a><a href='#L116'>116</a>
+<a name='L117'></a><a href='#L117'>117</a>
+<a name='L118'></a><a href='#L118'>118</a>
+<a name='L119'></a><a href='#L119'>119</a>
+<a name='L120'></a><a href='#L120'>120</a>
+<a name='L121'></a><a href='#L121'>121</a>
+<a name='L122'></a><a href='#L122'>122</a>
+<a name='L123'></a><a href='#L123'>123</a>
+<a name='L124'></a><a href='#L124'>124</a>
+<a name='L125'></a><a href='#L125'>125</a>
+<a name='L126'></a><a href='#L126'>126</a>
+<a name='L127'></a><a href='#L127'>127</a>
+<a name='L128'></a><a href='#L128'>128</a>
+<a name='L129'></a><a href='#L129'>129</a>
+<a name='L130'></a><a href='#L130'>130</a>
+<a name='L131'></a><a href='#L131'>131</a>
+<a name='L132'></a><a href='#L132'>132</a>
+<a name='L133'></a><a href='#L133'>133</a>
+<a name='L134'></a><a href='#L134'>134</a>
+<a name='L135'></a><a href='#L135'>135</a>
+<a name='L136'></a><a href='#L136'>136</a>
+<a name='L137'></a><a href='#L137'>137</a>
+<a name='L138'></a><a href='#L138'>138</a>
+<a name='L139'></a><a href='#L139'>139</a>
+<a name='L140'></a><a href='#L140'>140</a>
+<a name='L141'></a><a href='#L141'>141</a>
+<a name='L142'></a><a href='#L142'>142</a>
+<a name='L143'></a><a href='#L143'>143</a>
+<a name='L144'></a><a href='#L144'>144</a>
+<a name='L145'></a><a href='#L145'>145</a>
+<a name='L146'></a><a href='#L146'>146</a>
+<a name='L147'></a><a href='#L147'>147</a>
+<a name='L148'></a><a href='#L148'>148</a>
+<a name='L149'></a><a href='#L149'>149</a>
+<a name='L150'></a><a href='#L150'>150</a>
+<a name='L151'></a><a href='#L151'>151</a>
+<a name='L152'></a><a href='#L152'>152</a>
+<a name='L153'></a><a href='#L153'>153</a>
+<a name='L154'></a><a href='#L154'>154</a>
+<a name='L155'></a><a href='#L155'>155</a>
+<a name='L156'></a><a href='#L156'>156</a>
+<a name='L157'></a><a href='#L157'>157</a>
+<a name='L158'></a><a href='#L158'>158</a>
+<a name='L159'></a><a href='#L159'>159</a>
+<a name='L160'></a><a href='#L160'>160</a>
+<a name='L161'></a><a href='#L161'>161</a>
+<a name='L162'></a><a href='#L162'>162</a>
+<a name='L163'></a><a href='#L163'>163</a>
+<a name='L164'></a><a href='#L164'>164</a>
+<a name='L165'></a><a href='#L165'>165</a>
+<a name='L166'></a><a href='#L166'>166</a>
+<a name='L167'></a><a href='#L167'>167</a>
+<a name='L168'></a><a href='#L168'>168</a>
+<a name='L169'></a><a href='#L169'>169</a>
+<a name='L170'></a><a href='#L170'>170</a>
+<a name='L171'></a><a href='#L171'>171</a>
+<a name='L172'></a><a href='#L172'>172</a>
+<a name='L173'></a><a href='#L173'>173</a>
+<a name='L174'></a><a href='#L174'>174</a>
+<a name='L175'></a><a href='#L175'>175</a>
+<a name='L176'></a><a href='#L176'>176</a>
+<a name='L177'></a><a href='#L177'>177</a>
+<a name='L178'></a><a href='#L178'>178</a>
+<a name='L179'></a><a href='#L179'>179</a>
+<a name='L180'></a><a href='#L180'>180</a>
+<a name='L181'></a><a href='#L181'>181</a>
+<a name='L182'></a><a href='#L182'>182</a>
+<a name='L183'></a><a href='#L183'>183</a>
+<a name='L184'></a><a href='#L184'>184</a>
+<a name='L185'></a><a href='#L185'>185</a>
+<a name='L186'></a><a href='#L186'>186</a>
+<a name='L187'></a><a href='#L187'>187</a>
+<a name='L188'></a><a href='#L188'>188</a>
+<a name='L189'></a><a href='#L189'>189</a>
+<a name='L190'></a><a href='#L190'>190</a>
+<a name='L191'></a><a href='#L191'>191</a>
+<a name='L192'></a><a href='#L192'>192</a>
+<a name='L193'></a><a href='#L193'>193</a>
+<a name='L194'></a><a href='#L194'>194</a>
+<a name='L195'></a><a href='#L195'>195</a>
+<a name='L196'></a><a href='#L196'>196</a>
+<a name='L197'></a><a href='#L197'>197</a>
+<a name='L198'></a><a href='#L198'>198</a>
+<a name='L199'></a><a href='#L199'>199</a>
+<a name='L200'></a><a href='#L200'>200</a>
+<a name='L201'></a><a href='#L201'>201</a>
+<a name='L202'></a><a href='#L202'>202</a>
+<a name='L203'></a><a href='#L203'>203</a>
+<a name='L204'></a><a href='#L204'>204</a>
+<a name='L205'></a><a href='#L205'>205</a>
+<a name='L206'></a><a href='#L206'>206</a>
+<a name='L207'></a><a href='#L207'>207</a>
+<a name='L208'></a><a href='#L208'>208</a>
+<a name='L209'></a><a href='#L209'>209</a>
+<a name='L210'></a><a href='#L210'>210</a>
+<a name='L211'></a><a href='#L211'>211</a>
+<a name='L212'></a><a href='#L212'>212</a>
+<a name='L213'></a><a href='#L213'>213</a>
+<a name='L214'></a><a href='#L214'>214</a>
+<a name='L215'></a><a href='#L215'>215</a>
+<a name='L216'></a><a href='#L216'>216</a>
+<a name='L217'></a><a href='#L217'>217</a>
+<a name='L218'></a><a href='#L218'>218</a>
+<a name='L219'></a><a href='#L219'>219</a>
+<a name='L220'></a><a href='#L220'>220</a>
+<a name='L221'></a><a href='#L221'>221</a>
+<a name='L222'></a><a href='#L222'>222</a>
+<a name='L223'></a><a href='#L223'>223</a>
+<a name='L224'></a><a href='#L224'>224</a>
+<a name='L225'></a><a href='#L225'>225</a>
+<a name='L226'></a><a href='#L226'>226</a>
+<a name='L227'></a><a href='#L227'>227</a>
+<a name='L228'></a><a href='#L228'>228</a>
+<a name='L229'></a><a href='#L229'>229</a>
+<a name='L230'></a><a href='#L230'>230</a>
+<a name='L231'></a><a href='#L231'>231</a>
+<a name='L232'></a><a href='#L232'>232</a>
+<a name='L233'></a><a href='#L233'>233</a>
+<a name='L234'></a><a href='#L234'>234</a>
+<a name='L235'></a><a href='#L235'>235</a>
+<a name='L236'></a><a href='#L236'>236</a>
+<a name='L237'></a><a href='#L237'>237</a>
+<a name='L238'></a><a href='#L238'>238</a>
+<a name='L239'></a><a href='#L239'>239</a>
+<a name='L240'></a><a href='#L240'>240</a>
+<a name='L241'></a><a href='#L241'>241</a>
+<a name='L242'></a><a href='#L242'>242</a>
+<a name='L243'></a><a href='#L243'>243</a>
+<a name='L244'></a><a href='#L244'>244</a>
+<a name='L245'></a><a href='#L245'>245</a>
+<a name='L246'></a><a href='#L246'>246</a>
+<a name='L247'></a><a href='#L247'>247</a>
+<a name='L248'></a><a href='#L248'>248</a>
+<a name='L249'></a><a href='#L249'>249</a>
+<a name='L250'></a><a href='#L250'>250</a>
+<a name='L251'></a><a href='#L251'>251</a>
+<a name='L252'></a><a href='#L252'>252</a>
+<a name='L253'></a><a href='#L253'>253</a>
+<a name='L254'></a><a href='#L254'>254</a>
+<a name='L255'></a><a href='#L255'>255</a>
+<a name='L256'></a><a href='#L256'>256</a>
+<a name='L257'></a><a href='#L257'>257</a>
+<a name='L258'></a><a href='#L258'>258</a>
+<a name='L259'></a><a href='#L259'>259</a>
+<a name='L260'></a><a href='#L260'>260</a>
+<a name='L261'></a><a href='#L261'>261</a>
+<a name='L262'></a><a href='#L262'>262</a>
+<a name='L263'></a><a href='#L263'>263</a>
+<a name='L264'></a><a href='#L264'>264</a>
+<a name='L265'></a><a href='#L265'>265</a>
+<a name='L266'></a><a href='#L266'>266</a>
+<a name='L267'></a><a href='#L267'>267</a>
+<a name='L268'></a><a href='#L268'>268</a>
+<a name='L269'></a><a href='#L269'>269</a>
+<a name='L270'></a><a href='#L270'>270</a>
+<a name='L271'></a><a href='#L271'>271</a></td><td class="line-coverage quiet"><span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">27x</span>
+<span class="cline-any cline-yes">27x</span>
+<span class="cline-any cline-yes">27x</span>
+<span class="cline-any cline-yes">27x</span>
+<span class="cline-any cline-yes">27x</span>
+<span class="cline-any cline-yes">27x</span>
+<span class="cline-any cline-yes">27x</span>
+<span class="cline-any cline-yes">27x</span>
+<span class="cline-any cline-yes">27x</span>
+<span class="cline-any cline-yes">27x</span>
+<span class="cline-any cline-yes">27x</span>
+<span class="cline-any cline-yes">27x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">20x</span>
+<span class="cline-any cline-yes">20x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">18x</span>
+<span class="cline-any cline-yes">18x</span>
+<span class="cline-any cline-yes">21x</span>
+<span class="cline-any cline-yes">21x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">21x</span>
+<span class="cline-any cline-yes">16x</span>
+<span class="cline-any cline-yes">17x</span>
+<span class="cline-any cline-yes">18x</span>
+<span class="cline-any cline-yes">18x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">18x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">10x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">12x</span>
+<span class="cline-any cline-yes">12x</span>
+<span class="cline-any cline-yes">10x</span>
+<span class="cline-any cline-yes">10x</span>
+<span class="cline-any cline-yes">10x</span>
+<span class="cline-any cline-yes">10x</span>
+<span class="cline-any cline-yes">10x</span>
+<span class="cline-any cline-yes">10x</span>
+<span class="cline-any cline-yes">10x</span>
+<span class="cline-any cline-yes">10x</span>
+<span class="cline-any cline-yes">10x</span>
+<span class="cline-any cline-yes">10x</span>
+<span class="cline-any cline-yes">10x</span>
+<span class="cline-any cline-yes">10x</span>
+<span class="cline-any cline-yes">10x</span>
+<span class="cline-any cline-yes">10x</span>
+<span class="cline-any cline-yes">20x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">20x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">13x</span>
+<span class="cline-any cline-yes">13x</span>
+<span class="cline-any cline-yes">13x</span>
+<span class="cline-any cline-yes">13x</span>
+<span class="cline-any cline-yes">13x</span>
+<span class="cline-any cline-yes">13x</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-yes">13x</span>
+<span class="cline-any cline-yes">13x</span>
+<span class="cline-any cline-yes">13x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">5x</span>
+<span class="cline-any cline-yes">5x</span>
+<span class="cline-any cline-yes">5x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">3x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">27x</span>
+<span class="cline-any cline-yes">27x</span>
+<span class="cline-any cline-yes">27x</span>
+<span class="cline-any cline-yes">27x</span>
+<span class="cline-any cline-yes">27x</span>
+<span class="cline-any cline-yes">27x</span>
+<span class="cline-any cline-yes">27x</span>
+<span class="cline-any cline-yes">27x</span>
+<span class="cline-any cline-yes">27x</span>
+<span class="cline-any cline-yes">27x</span>
+<span class="cline-any cline-yes">27x</span>
+<span class="cline-any cline-yes">27x</span>
+<span class="cline-any cline-yes">27x</span>
+<span class="cline-any cline-yes">27x</span>
+<span class="cline-any cline-yes">27x</span>
+<span class="cline-any cline-yes">27x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">import { Pool } from 'pg';
+import { Redis } from 'ioredis';
+import { InventoryService } from './InventoryService';
+import { PaymentService } from './PaymentService';
+import { ShippingService } from './ShippingService';
+&nbsp;
+export interface OrderItem {
+    productId: string;
+    quantity: number;
+    pricePerUnit: number;
+}
+&nbsp;
+export interface ShippingAddress {
+    street: string;
+    city: string;
+    state: string;
+    zipCode: string;
+    country: string;
+}
+&nbsp;
+export interface CreateOrderRequest {
+    userId: string;
+    items: OrderItem[];
+    shippingAddress: ShippingAddress;
+    idempotencyKey: string;
+}
+&nbsp;
+export interface Order {
+    id: string;
+    userId: string;
+    items: OrderItem[];
+    subtotal: number;
+    shippingCost: number;
+    total: number;
+    status: string;
+    shippingAddress: ShippingAddress;
+    createdAt: Date;
+    updatedAt: Date;
+}
+&nbsp;
+export interface RefundItem {
+    productId: string;
+    quantity: number;
+}
+&nbsp;
+export class OrderService {
+    private pool: Pool;
+    private redis: Redis;
+    private inventoryService: InventoryService;
+    private paymentService: PaymentService;
+    private shippingService: ShippingService;
+&nbsp;
+    constructor(
+        pool: Pool,
+        redis: Redis,
+        inventoryService: InventoryService,
+        paymentService: PaymentService,
+        shippingService: ShippingService
+    ) {
+        this.pool = pool;
+        this.redis = redis;
+        this.inventoryService = inventoryService;
+        this.paymentService = paymentService;
+        this.shippingService = shippingService;
+    }
+&nbsp;
+    async createOrder(request: CreateOrderRequest): Promise&lt;Order&gt; {
+        const existingOrderId = await this.redis.get(`idempotency:${request.idempotencyKey}`);
+        if (existingOrderId) {
+            return this.getOrderById(existingOrderId);
+        }
+&nbsp;
+        for (const item of request.items) {
+            const available = await this.inventoryService.getAvailableQuantity(item.productId);
+            if (available &lt; item.quantity) {
+                throw new Error(`Insufficient inventory for product ${item.productId}`);
+            }
+        }
+&nbsp;
+        for (const item of request.items) {
+            const reserved = await this.inventoryService.reserve(item.productId, item.quantity);
+            if (!reserved) {
+                for (const prevItem of request.items) {
+                    if (prevItem.productId === item.productId) break;
+<span class="cstat-no" title="statement not covered" ><span class="branch-0 cbranch-no" title="branch not covered" >                    await this.inventoryService.release(prevItem.productId, prevItem.quantity);</span></span>
+<span class="cstat-no" title="statement not covered" >                }</span>
+                throw new Error(`Insufficient inventory for product ${item.productId}`);
+            }
+        }
+&nbsp;
+        const subtotal = request.items.reduce(
+            (sum, item) =&gt; sum + item.quantity * item.pricePerUnit,
+            0
+        );
+        const shippingCost = this.shippingService.calculateShippingCost(
+            request.shippingAddress,
+            request.items
+        );
+        const total = subtotal + shippingCost;
+&nbsp;
+        const orderResult = await this.pool.query(
+            `INSERT INTO orders (user_id, items, subtotal, shipping_cost, total, status, shipping_address)
+             VALUES ($1, $2, $3, $4, $5, 'pending', $6)
+             RETURNING *`,
+            [
+                request.userId,
+                JSON.stringify(request.items),
+                subtotal,
+                shippingCost,
+                total,
+                JSON.stringify(request.shippingAddress),
+            ]
+        );
+&nbsp;
+        const order = this.mapRowToOrder(orderResult.rows[0]);
+&nbsp;
+        try {
+            await this.paymentService.charge({
+                amount: Math.round(total * 100),
+                currency: 'usd',
+                metadata: {
+                    orderId: order.id,
+                    customerId: request.userId,
+                },
+                idempotencyKey: request.idempotencyKey,
+            });
+&nbsp;
+            for (const item of request.items) {
+                await this.inventoryService.confirmReservation(item.productId, item.quantity);
+            }
+&nbsp;
+            await this.pool.query(
+                `UPDATE orders SET status = 'paid', updated_at = NOW() WHERE id = $1`,
+                [order.id]
+            );
+            order.status = 'paid';
+&nbsp;
+            await this.redis.setex(
+                `idempotency:${request.idempotencyKey}`,
+                86400,
+                order.id
+            );
+&nbsp;
+            return order;
+        } catch (error) {
+            for (const item of request.items) {
+                await this.inventoryService.release(item.productId, item.quantity);
+            }
+&nbsp;
+            await this.pool.query(
+                `UPDATE orders SET status = 'payment_failed', updated_at = NOW() WHERE id = $1`,
+                [order.id]
+            );
+            order.status = 'payment_failed';
+&nbsp;
+            throw error;
+        }
+    }
+&nbsp;
+    async getOrderById(orderId: string): Promise&lt;Order&gt; {
+        const result = await this.pool.query(
+            `SELECT * FROM orders WHERE id = $1`,
+            [orderId]
+        );
+&nbsp;
+        if (result.rows.length === 0) <span class="branch-0 cbranch-no" title="branch not covered" >{</span>
+<span class="cstat-no" title="statement not covered" >            throw new Error('Order not found');</span>
+<span class="cstat-no" title="statement not covered" >        }</span>
+&nbsp;
+        return this.mapRowToOrder(result.rows[0]);
+    }
+&nbsp;
+    async cancelOrder(orderId: string): Promise&lt;Order&gt; {
+        const order = await this.getOrderById(orderId);
+&nbsp;
+        if (!['pending', 'paid'].includes(order.status)) {
+            throw new Error('Order cannot be cancelled');
+        }
+&nbsp;
+        if (order.status === 'paid') {
+            const paymentIntent = await this.paymentService.findPaymentByOrderId(orderId);
+            if (paymentIntent) <span class="branch-0 cbranch-no" title="branch not covered" >{</span>
+<span class="cstat-no" title="statement not covered" >                await this.paymentService.refund(paymentIntent.id, Math.round(order.total * 100));</span>
+<span class="cstat-no" title="statement not covered" >            }</span>
+        }
+&nbsp;
+        for (const item of order.items) {
+            await this.inventoryService.release(item.productId, item.quantity);
+        }
+&nbsp;
+        await this.pool.query(
+            `UPDATE orders SET status = 'cancelled', updated_at = NOW() WHERE id = $1`,
+            [orderId]
+        );
+&nbsp;
+        order.status = 'cancelled';
+        return order;
+    }
+&nbsp;
+    async processRefund(orderId: string, itemsToRefund: RefundItem[]): Promise&lt;Order&gt; {
+        const order = await this.getOrderById(orderId);
+&nbsp;
+        if (order.status !== 'paid') {
+            throw new Error('Order cannot be refunded');
+        }
+&nbsp;
+        let refundAmount = 0;
+        for (const refundItem of itemsToRefund) {
+            const orderItem = order.items.find((i) =&gt; i.productId === refundItem.productId);
+            if (!orderItem) {
+                throw new Error(`Product ${refundItem.productId} not in order`);
+            }
+            if (refundItem.quantity &gt; orderItem.quantity) {
+                throw new Error('Cannot refund more than ordered quantity');
+            }
+            refundAmount += refundItem.quantity * orderItem.pricePerUnit;
+        }
+&nbsp;
+        const paymentIntent = await this.paymentService.findPaymentByOrderId(orderId);
+        if (!paymentIntent) <span class="branch-0 cbranch-no" title="branch not covered" >{</span>
+<span class="cstat-no" title="statement not covered" >            throw new Error('Payment not found for order');</span>
+<span class="cstat-no" title="statement not covered" >        }</span>
+&nbsp;
+        await this.paymentService.refund(paymentIntent.id, Math.round(refundAmount * 100));
+&nbsp;
+        for (const refundItem of itemsToRefund) {
+            await this.inventoryService.release(refundItem.productId, refundItem.quantity);
+        }
+&nbsp;
+        await this.pool.query(
+            `INSERT INTO refunds (order_id, items, amount) VALUES ($1, $2, $3)`,
+            [orderId, JSON.stringify(itemsToRefund), refundAmount]
+        );
+&nbsp;
+        const totalRefunded = itemsToRefund.reduce((sum, item) =&gt; {
+            const orderItem = order.items.find((i) =&gt; i.productId === item.productId);
+            return sum + item.quantity;
+        }, 0);
+&nbsp;
+        const totalOrdered = order.items.reduce((sum, item) =&gt; sum + item.quantity, 0);
+&nbsp;
+        if (totalRefunded === totalOrdered) {
+            await this.pool.query(
+                `UPDATE orders SET status = 'refunded', updated_at = NOW() WHERE id = $1`,
+                [orderId]
+            );
+            order.status = 'refunded';
+        }
+&nbsp;
+        return order;
+    }
+&nbsp;
+    private mapRowToOrder(row: any): Order {
+        return {
+            id: row.id,
+            userId: row.user_id,
+            items: typeof row.items === 'string' <span class="branch-0 cbranch-no" title="branch not covered" >? JSON.parse(row.items) </span>: row.items,
+            subtotal: parseFloat(row.subtotal),
+            shippingCost: parseFloat(row.shipping_cost),
+            total: parseFloat(row.total),
+            status: row.status,
+            shippingAddress:
+                typeof row.shipping_address === 'string'
+<span class="branch-0 cbranch-no" title="branch not covered" >                    ? JSON.parse(row.shipping_address)</span>
+                    : row.shipping_address,
+            createdAt: row.created_at,
+            updatedAt: row.updated_at,
+        };
+    }
+}
+&nbsp;</pre></td></tr></table></pre>
+
+                <div class='push'></div><!-- for sticky footer -->
+            </div><!-- /wrapper -->
+            <div class='footer quiet pad2 space-top1 center small'>
+                Code coverage generated by
+                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
+                at 2026-02-05T08:57:14.339Z
+            </div>
+        <script src="prettify.js"></script>
+        <script>
+            window.onload = function () {
+                prettyPrint();
+            };
+        </script>
+        <script src="sorter.js"></script>
+        <script src="block-navigation.js"></script>
+    </body>
+</html>
+    
\ No newline at end of file
diff --git a/repository_after/coverage/lcov-report/PaymentService.ts.html b/repository_after/coverage/lcov-report/PaymentService.ts.html
new file mode 100644
index 0000000..e7a6fc6
--- /dev/null
+++ b/repository_after/coverage/lcov-report/PaymentService.ts.html
@@ -0,0 +1,289 @@
+
+<!doctype html>
+<html lang="en">
+
+<head>
+    <title>Code coverage report for PaymentService.ts</title>
+    <meta charset="utf-8" />
+    <link rel="stylesheet" href="prettify.css" />
+    <link rel="stylesheet" href="base.css" />
+    <link rel="shortcut icon" type="image/x-icon" href="favicon.png" />
+    <meta name="viewport" content="width=device-width, initial-scale=1" />
+    <style type='text/css'>
+        .coverage-summary .sorter {
+            background-image: url(sort-arrow-sprite.png);
+        }
+    </style>
+</head>
+    
+<body>
+<div class='wrapper'>
+    <div class='pad1'>
+        <h1><a href="index.html">All files</a> PaymentService.ts</h1>
+        <div class='clearfix'>
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">100% </span>
+                <span class="quiet">Statements</span>
+                <span class='fraction'>68/68</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">100% </span>
+                <span class="quiet">Branches</span>
+                <span class='fraction'>9/9</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">100% </span>
+                <span class="quiet">Functions</span>
+                <span class='fraction'>5/5</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">100% </span>
+                <span class="quiet">Lines</span>
+                <span class='fraction'>68/68</span>
+            </div>
+        
+            
+        </div>
+        <p class="quiet">
+            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
+        </p>
+        <template id="filterTemplate">
+            <div class="quiet">
+                Filter:
+                <input type="search" id="fileSearch">
+            </div>
+        </template>
+    </div>
+    <div class='status-line high'></div>
+    <pre><table class="coverage">
+<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a>
+<a name='L2'></a><a href='#L2'>2</a>
+<a name='L3'></a><a href='#L3'>3</a>
+<a name='L4'></a><a href='#L4'>4</a>
+<a name='L5'></a><a href='#L5'>5</a>
+<a name='L6'></a><a href='#L6'>6</a>
+<a name='L7'></a><a href='#L7'>7</a>
+<a name='L8'></a><a href='#L8'>8</a>
+<a name='L9'></a><a href='#L9'>9</a>
+<a name='L10'></a><a href='#L10'>10</a>
+<a name='L11'></a><a href='#L11'>11</a>
+<a name='L12'></a><a href='#L12'>12</a>
+<a name='L13'></a><a href='#L13'>13</a>
+<a name='L14'></a><a href='#L14'>14</a>
+<a name='L15'></a><a href='#L15'>15</a>
+<a name='L16'></a><a href='#L16'>16</a>
+<a name='L17'></a><a href='#L17'>17</a>
+<a name='L18'></a><a href='#L18'>18</a>
+<a name='L19'></a><a href='#L19'>19</a>
+<a name='L20'></a><a href='#L20'>20</a>
+<a name='L21'></a><a href='#L21'>21</a>
+<a name='L22'></a><a href='#L22'>22</a>
+<a name='L23'></a><a href='#L23'>23</a>
+<a name='L24'></a><a href='#L24'>24</a>
+<a name='L25'></a><a href='#L25'>25</a>
+<a name='L26'></a><a href='#L26'>26</a>
+<a name='L27'></a><a href='#L27'>27</a>
+<a name='L28'></a><a href='#L28'>28</a>
+<a name='L29'></a><a href='#L29'>29</a>
+<a name='L30'></a><a href='#L30'>30</a>
+<a name='L31'></a><a href='#L31'>31</a>
+<a name='L32'></a><a href='#L32'>32</a>
+<a name='L33'></a><a href='#L33'>33</a>
+<a name='L34'></a><a href='#L34'>34</a>
+<a name='L35'></a><a href='#L35'>35</a>
+<a name='L36'></a><a href='#L36'>36</a>
+<a name='L37'></a><a href='#L37'>37</a>
+<a name='L38'></a><a href='#L38'>38</a>
+<a name='L39'></a><a href='#L39'>39</a>
+<a name='L40'></a><a href='#L40'>40</a>
+<a name='L41'></a><a href='#L41'>41</a>
+<a name='L42'></a><a href='#L42'>42</a>
+<a name='L43'></a><a href='#L43'>43</a>
+<a name='L44'></a><a href='#L44'>44</a>
+<a name='L45'></a><a href='#L45'>45</a>
+<a name='L46'></a><a href='#L46'>46</a>
+<a name='L47'></a><a href='#L47'>47</a>
+<a name='L48'></a><a href='#L48'>48</a>
+<a name='L49'></a><a href='#L49'>49</a>
+<a name='L50'></a><a href='#L50'>50</a>
+<a name='L51'></a><a href='#L51'>51</a>
+<a name='L52'></a><a href='#L52'>52</a>
+<a name='L53'></a><a href='#L53'>53</a>
+<a name='L54'></a><a href='#L54'>54</a>
+<a name='L55'></a><a href='#L55'>55</a>
+<a name='L56'></a><a href='#L56'>56</a>
+<a name='L57'></a><a href='#L57'>57</a>
+<a name='L58'></a><a href='#L58'>58</a>
+<a name='L59'></a><a href='#L59'>59</a>
+<a name='L60'></a><a href='#L60'>60</a>
+<a name='L61'></a><a href='#L61'>61</a>
+<a name='L62'></a><a href='#L62'>62</a>
+<a name='L63'></a><a href='#L63'>63</a>
+<a name='L64'></a><a href='#L64'>64</a>
+<a name='L65'></a><a href='#L65'>65</a>
+<a name='L66'></a><a href='#L66'>66</a>
+<a name='L67'></a><a href='#L67'>67</a>
+<a name='L68'></a><a href='#L68'>68</a>
+<a name='L69'></a><a href='#L69'>69</a></td><td class="line-coverage quiet"><span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">33x</span>
+<span class="cline-any cline-yes">33x</span>
+<span class="cline-any cline-yes">33x</span>
+<span class="cline-any cline-yes">33x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">14x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">10x</span>
+<span class="cline-any cline-yes">10x</span>
+<span class="cline-any cline-yes">10x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">3x</span>
+<span class="cline-any cline-yes">3x</span>
+<span class="cline-any cline-yes">3x</span>
+<span class="cline-any cline-yes">3x</span>
+<span class="cline-any cline-yes">3x</span>
+<span class="cline-any cline-yes">3x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">6x</span>
+<span class="cline-any cline-yes">6x</span>
+<span class="cline-any cline-yes">6x</span>
+<span class="cline-any cline-yes">6x</span>
+<span class="cline-any cline-yes">6x</span>
+<span class="cline-any cline-yes">6x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">import Stripe from 'stripe';
+&nbsp;
+export interface ChargeRequest {
+    amount: number;
+    currency: string;
+    metadata: {
+        orderId: string;
+        customerId: string;
+    };
+    idempotencyKey: string;
+}
+&nbsp;
+export class PaymentService {
+    private stripe: Stripe;
+&nbsp;
+    constructor(secretKey: string) {
+        this.stripe = new Stripe(secretKey, {
+            apiVersion: '2023-10-16',
+        });
+    }
+&nbsp;
+    async charge(request: ChargeRequest): Promise&lt;Stripe.PaymentIntent&gt; {
+        const paymentIntent = await this.stripe.paymentIntents.create(
+            {
+                amount: request.amount,
+                currency: request.currency,
+                metadata: request.metadata,
+                confirm: true,
+                automatic_payment_methods: {
+                    enabled: true,
+                    allow_redirects: 'never',
+                },
+            },
+            {
+                idempotencyKey: request.idempotencyKey,
+            }
+        );
+&nbsp;
+        if (paymentIntent.status !== 'succeeded') {
+            throw new Error(`Payment failed with status: ${paymentIntent.status}`);
+        }
+&nbsp;
+        return paymentIntent;
+    }
+&nbsp;
+    async findPaymentByOrderId(orderId: string): Promise&lt;Stripe.PaymentIntent | null&gt; {
+        const result = await this.stripe.paymentIntents.search({
+            query: `metadata['orderId']:'${orderId}'`,
+        });
+&nbsp;
+        return result.data.length &gt; 0 ? result.data[0] : null;
+    }
+&nbsp;
+    async refund(paymentIntentId: string, amount: number): Promise&lt;Stripe.Refund&gt; {
+        return this.stripe.refunds.create({
+            payment_intent: paymentIntentId,
+            amount,
+        });
+    }
+&nbsp;
+    verifyWebhookSignature(
+        payload: string | Buffer,
+        signature: string,
+        webhookSecret: string
+    ): Stripe.Event {
+        return this.stripe.webhooks.constructEvent(payload, signature, webhookSecret);
+    }
+}
+&nbsp;</pre></td></tr></table></pre>
+
+                <div class='push'></div><!-- for sticky footer -->
+            </div><!-- /wrapper -->
+            <div class='footer quiet pad2 space-top1 center small'>
+                Code coverage generated by
+                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
+                at 2026-02-05T08:57:14.339Z
+            </div>
+        <script src="prettify.js"></script>
+        <script>
+            window.onload = function () {
+                prettyPrint();
+            };
+        </script>
+        <script src="sorter.js"></script>
+        <script src="block-navigation.js"></script>
+    </body>
+</html>
+    
\ No newline at end of file
diff --git a/repository_after/coverage/lcov-report/ShippingService.ts.html b/repository_after/coverage/lcov-report/ShippingService.ts.html
new file mode 100644
index 0000000..ff2496f
--- /dev/null
+++ b/repository_after/coverage/lcov-report/ShippingService.ts.html
@@ -0,0 +1,358 @@
+
+<!doctype html>
+<html lang="en">
+
+<head>
+    <title>Code coverage report for ShippingService.ts</title>
+    <meta charset="utf-8" />
+    <link rel="stylesheet" href="prettify.css" />
+    <link rel="stylesheet" href="base.css" />
+    <link rel="shortcut icon" type="image/x-icon" href="favicon.png" />
+    <meta name="viewport" content="width=device-width, initial-scale=1" />
+    <style type='text/css'>
+        .coverage-summary .sorter {
+            background-image: url(sort-arrow-sprite.png);
+        }
+    </style>
+</head>
+    
+<body>
+<div class='wrapper'>
+    <div class='pad1'>
+        <h1><a href="index.html">All files</a> ShippingService.ts</h1>
+        <div class='clearfix'>
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">98.9% </span>
+                <span class="quiet">Statements</span>
+                <span class='fraction'>90/91</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">96.87% </span>
+                <span class="quiet">Branches</span>
+                <span class='fraction'>31/32</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">100% </span>
+                <span class="quiet">Functions</span>
+                <span class='fraction'>4/4</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">98.9% </span>
+                <span class="quiet">Lines</span>
+                <span class='fraction'>90/91</span>
+            </div>
+        
+            
+        </div>
+        <p class="quiet">
+            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
+        </p>
+        <template id="filterTemplate">
+            <div class="quiet">
+                Filter:
+                <input type="search" id="fileSearch">
+            </div>
+        </template>
+    </div>
+    <div class='status-line high'></div>
+    <pre><table class="coverage">
+<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a>
+<a name='L2'></a><a href='#L2'>2</a>
+<a name='L3'></a><a href='#L3'>3</a>
+<a name='L4'></a><a href='#L4'>4</a>
+<a name='L5'></a><a href='#L5'>5</a>
+<a name='L6'></a><a href='#L6'>6</a>
+<a name='L7'></a><a href='#L7'>7</a>
+<a name='L8'></a><a href='#L8'>8</a>
+<a name='L9'></a><a href='#L9'>9</a>
+<a name='L10'></a><a href='#L10'>10</a>
+<a name='L11'></a><a href='#L11'>11</a>
+<a name='L12'></a><a href='#L12'>12</a>
+<a name='L13'></a><a href='#L13'>13</a>
+<a name='L14'></a><a href='#L14'>14</a>
+<a name='L15'></a><a href='#L15'>15</a>
+<a name='L16'></a><a href='#L16'>16</a>
+<a name='L17'></a><a href='#L17'>17</a>
+<a name='L18'></a><a href='#L18'>18</a>
+<a name='L19'></a><a href='#L19'>19</a>
+<a name='L20'></a><a href='#L20'>20</a>
+<a name='L21'></a><a href='#L21'>21</a>
+<a name='L22'></a><a href='#L22'>22</a>
+<a name='L23'></a><a href='#L23'>23</a>
+<a name='L24'></a><a href='#L24'>24</a>
+<a name='L25'></a><a href='#L25'>25</a>
+<a name='L26'></a><a href='#L26'>26</a>
+<a name='L27'></a><a href='#L27'>27</a>
+<a name='L28'></a><a href='#L28'>28</a>
+<a name='L29'></a><a href='#L29'>29</a>
+<a name='L30'></a><a href='#L30'>30</a>
+<a name='L31'></a><a href='#L31'>31</a>
+<a name='L32'></a><a href='#L32'>32</a>
+<a name='L33'></a><a href='#L33'>33</a>
+<a name='L34'></a><a href='#L34'>34</a>
+<a name='L35'></a><a href='#L35'>35</a>
+<a name='L36'></a><a href='#L36'>36</a>
+<a name='L37'></a><a href='#L37'>37</a>
+<a name='L38'></a><a href='#L38'>38</a>
+<a name='L39'></a><a href='#L39'>39</a>
+<a name='L40'></a><a href='#L40'>40</a>
+<a name='L41'></a><a href='#L41'>41</a>
+<a name='L42'></a><a href='#L42'>42</a>
+<a name='L43'></a><a href='#L43'>43</a>
+<a name='L44'></a><a href='#L44'>44</a>
+<a name='L45'></a><a href='#L45'>45</a>
+<a name='L46'></a><a href='#L46'>46</a>
+<a name='L47'></a><a href='#L47'>47</a>
+<a name='L48'></a><a href='#L48'>48</a>
+<a name='L49'></a><a href='#L49'>49</a>
+<a name='L50'></a><a href='#L50'>50</a>
+<a name='L51'></a><a href='#L51'>51</a>
+<a name='L52'></a><a href='#L52'>52</a>
+<a name='L53'></a><a href='#L53'>53</a>
+<a name='L54'></a><a href='#L54'>54</a>
+<a name='L55'></a><a href='#L55'>55</a>
+<a name='L56'></a><a href='#L56'>56</a>
+<a name='L57'></a><a href='#L57'>57</a>
+<a name='L58'></a><a href='#L58'>58</a>
+<a name='L59'></a><a href='#L59'>59</a>
+<a name='L60'></a><a href='#L60'>60</a>
+<a name='L61'></a><a href='#L61'>61</a>
+<a name='L62'></a><a href='#L62'>62</a>
+<a name='L63'></a><a href='#L63'>63</a>
+<a name='L64'></a><a href='#L64'>64</a>
+<a name='L65'></a><a href='#L65'>65</a>
+<a name='L66'></a><a href='#L66'>66</a>
+<a name='L67'></a><a href='#L67'>67</a>
+<a name='L68'></a><a href='#L68'>68</a>
+<a name='L69'></a><a href='#L69'>69</a>
+<a name='L70'></a><a href='#L70'>70</a>
+<a name='L71'></a><a href='#L71'>71</a>
+<a name='L72'></a><a href='#L72'>72</a>
+<a name='L73'></a><a href='#L73'>73</a>
+<a name='L74'></a><a href='#L74'>74</a>
+<a name='L75'></a><a href='#L75'>75</a>
+<a name='L76'></a><a href='#L76'>76</a>
+<a name='L77'></a><a href='#L77'>77</a>
+<a name='L78'></a><a href='#L78'>78</a>
+<a name='L79'></a><a href='#L79'>79</a>
+<a name='L80'></a><a href='#L80'>80</a>
+<a name='L81'></a><a href='#L81'>81</a>
+<a name='L82'></a><a href='#L82'>82</a>
+<a name='L83'></a><a href='#L83'>83</a>
+<a name='L84'></a><a href='#L84'>84</a>
+<a name='L85'></a><a href='#L85'>85</a>
+<a name='L86'></a><a href='#L86'>86</a>
+<a name='L87'></a><a href='#L87'>87</a>
+<a name='L88'></a><a href='#L88'>88</a>
+<a name='L89'></a><a href='#L89'>89</a>
+<a name='L90'></a><a href='#L90'>90</a>
+<a name='L91'></a><a href='#L91'>91</a>
+<a name='L92'></a><a href='#L92'>92</a></td><td class="line-coverage quiet"><span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">18x</span>
+<span class="cline-any cline-yes">18x</span>
+<span class="cline-any cline-yes">18x</span>
+<span class="cline-any cline-yes">18x</span>
+<span class="cline-any cline-yes">18x</span>
+<span class="cline-any cline-yes">18x</span>
+<span class="cline-any cline-yes">18x</span>
+<span class="cline-any cline-yes">18x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">22x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">20x</span>
+<span class="cline-any cline-yes">20x</span>
+<span class="cline-any cline-yes">20x</span>
+<span class="cline-any cline-yes">22x</span>
+<span class="cline-any cline-yes">16x</span>
+<span class="cline-any cline-yes">16x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">8x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">7x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">6x</span>
+<span class="cline-any cline-yes">7x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">5x</span>
+<span class="cline-any cline-yes">7x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">7x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">3x</span>
+<span class="cline-any cline-yes">7x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-yes">7x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">import { OrderItem, ShippingAddress } from './OrderService';
+&nbsp;
+interface ShippingRate {
+    baseRate: number;
+    perItemRate: number;
+}
+&nbsp;
+const SHIPPING_RATES: Record&lt;string, ShippingRate&gt; = {
+    US_WEST: { baseRate: 5.99, perItemRate: 0.50 },
+    US_EAST: { baseRate: 7.99, perItemRate: 0.75 },
+    US_CENTRAL: { baseRate: 6.99, perItemRate: 0.60 },
+    INTERNATIONAL: { baseRate: 19.99, perItemRate: 2.00 },
+};
+&nbsp;
+const US_WEST_STATES = ['CA', 'OR', 'WA', 'NV', 'AZ', 'UT', 'ID', 'MT', 'WY', 'CO', 'NM', 'AK', 'HI'];
+const US_EAST_STATES = ['NY', 'NJ', 'PA', 'MA', 'CT', 'RI', 'VT', 'NH', 'ME', 'MD', 'DE', 'VA', 'WV', 'NC', 'SC', 'GA', 'FL'];
+&nbsp;
+export class ShippingService {
+    calculateShippingCost(address: ShippingAddress, items: OrderItem[]): number {
+        const zone = this.getShippingZone(address);
+        const rate = SHIPPING_RATES[zone];
+&nbsp;
+        const totalItems = items.reduce((sum, item) =&gt; sum + item.quantity, 0);
+        const cost = rate.baseRate + (totalItems - 1) * rate.perItemRate;
+&nbsp;
+        return Math.round(cost * 100) / 100;
+    }
+&nbsp;
+    private getShippingZone(address: ShippingAddress): string {
+        if (address.country !== 'US') {
+            return 'INTERNATIONAL';
+        }
+&nbsp;
+        const state = address.state.toUpperCase();
+&nbsp;
+        if (US_WEST_STATES.includes(state)) {
+            return 'US_WEST';
+        }
+&nbsp;
+        if (US_EAST_STATES.includes(state)) {
+            return 'US_EAST';
+        }
+&nbsp;
+        return 'US_CENTRAL';
+    }
+&nbsp;
+    estimateDeliveryDays(address: ShippingAddress): number {
+        const zone = this.getShippingZone(address);
+&nbsp;
+        switch (zone) {
+            case 'US_WEST':
+                return 3;
+            case 'US_EAST':
+                return 5;
+            case 'US_CENTRAL':
+                return 4;
+            case 'INTERNATIONAL':
+                return 14;
+<span class="branch-0 cbranch-no" title="branch not covered" >            default:</span>
+<span class="cstat-no" title="statement not covered" >                return 7;</span>
+        }
+    }
+&nbsp;
+    validateAddress(address: ShippingAddress): boolean {
+        if (!address.street || address.street.trim().length === 0) {
+            return false;
+        }
+&nbsp;
+        if (!address.city || address.city.trim().length === 0) {
+            return false;
+        }
+&nbsp;
+        if (!address.state || address.state.trim().length === 0) {
+            return false;
+        }
+&nbsp;
+        if (!address.zipCode || address.zipCode.trim().length === 0) {
+            return false;
+        }
+&nbsp;
+        if (!address.country || address.country.trim().length === 0) {
+            return false;
+        }
+&nbsp;
+        if (address.country === 'US' &amp;&amp; !/^\d{5}(-\d{4})?$/.test(address.zipCode)) {
+            return false;
+        }
+&nbsp;
+        return true;
+    }
+}
+&nbsp;</pre></td></tr></table></pre>
+
+                <div class='push'></div><!-- for sticky footer -->
+            </div><!-- /wrapper -->
+            <div class='footer quiet pad2 space-top1 center small'>
+                Code coverage generated by
+                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
+                at 2026-02-05T08:57:14.339Z
+            </div>
+        <script src="prettify.js"></script>
+        <script>
+            window.onload = function () {
+                prettyPrint();
+            };
+        </script>
+        <script src="sorter.js"></script>
+        <script src="block-navigation.js"></script>
+    </body>
+</html>
+    
\ No newline at end of file
diff --git a/repository_after/coverage/lcov-report/base.css b/repository_after/coverage/lcov-report/base.css
new file mode 100644
index 0000000..f418035
--- /dev/null
+++ b/repository_after/coverage/lcov-report/base.css
@@ -0,0 +1,224 @@
+body, html {
+  margin:0; padding: 0;
+  height: 100%;
+}
+body {
+    font-family: Helvetica Neue, Helvetica, Arial;
+    font-size: 14px;
+    color:#333;
+}
+.small { font-size: 12px; }
+*, *:after, *:before {
+  -webkit-box-sizing:border-box;
+     -moz-box-sizing:border-box;
+          box-sizing:border-box;
+  }
+h1 { font-size: 20px; margin: 0;}
+h2 { font-size: 14px; }
+pre {
+    font: 12px/1.4 Consolas, "Liberation Mono", Menlo, Courier, monospace;
+    margin: 0;
+    padding: 0;
+    -moz-tab-size: 2;
+    -o-tab-size:  2;
+    tab-size: 2;
+}
+a { color:#0074D9; text-decoration:none; }
+a:hover { text-decoration:underline; }
+.strong { font-weight: bold; }
+.space-top1 { padding: 10px 0 0 0; }
+.pad2y { padding: 20px 0; }
+.pad1y { padding: 10px 0; }
+.pad2x { padding: 0 20px; }
+.pad2 { padding: 20px; }
+.pad1 { padding: 10px; }
+.space-left2 { padding-left:55px; }
+.space-right2 { padding-right:20px; }
+.center { text-align:center; }
+.clearfix { display:block; }
+.clearfix:after {
+  content:'';
+  display:block;
+  height:0;
+  clear:both;
+  visibility:hidden;
+  }
+.fl { float: left; }
+@media only screen and (max-width:640px) {
+  .col3 { width:100%; max-width:100%; }
+  .hide-mobile { display:none!important; }
+}
+
+.quiet {
+  color: #7f7f7f;
+  color: rgba(0,0,0,0.5);
+}
+.quiet a { opacity: 0.7; }
+
+.fraction {
+  font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace;
+  font-size: 10px;
+  color: #555;
+  background: #E8E8E8;
+  padding: 4px 5px;
+  border-radius: 3px;
+  vertical-align: middle;
+}
+
+div.path a:link, div.path a:visited { color: #333; }
+table.coverage {
+  border-collapse: collapse;
+  margin: 10px 0 0 0;
+  padding: 0;
+}
+
+table.coverage td {
+  margin: 0;
+  padding: 0;
+  vertical-align: top;
+}
+table.coverage td.line-count {
+    text-align: right;
+    padding: 0 5px 0 20px;
+}
+table.coverage td.line-coverage {
+    text-align: right;
+    padding-right: 10px;
+    min-width:20px;
+}
+
+table.coverage td span.cline-any {
+    display: inline-block;
+    padding: 0 5px;
+    width: 100%;
+}
+.missing-if-branch {
+    display: inline-block;
+    margin-right: 5px;
+    border-radius: 3px;
+    position: relative;
+    padding: 0 4px;
+    background: #333;
+    color: yellow;
+}
+
+.skip-if-branch {
+    display: none;
+    margin-right: 10px;
+    position: relative;
+    padding: 0 4px;
+    background: #ccc;
+    color: white;
+}
+.missing-if-branch .typ, .skip-if-branch .typ {
+    color: inherit !important;
+}
+.coverage-summary {
+  border-collapse: collapse;
+  width: 100%;
+}
+.coverage-summary tr { border-bottom: 1px solid #bbb; }
+.keyline-all { border: 1px solid #ddd; }
+.coverage-summary td, .coverage-summary th { padding: 10px; }
+.coverage-summary tbody { border: 1px solid #bbb; }
+.coverage-summary td { border-right: 1px solid #bbb; }
+.coverage-summary td:last-child { border-right: none; }
+.coverage-summary th {
+  text-align: left;
+  font-weight: normal;
+  white-space: nowrap;
+}
+.coverage-summary th.file { border-right: none !important; }
+.coverage-summary th.pct { }
+.coverage-summary th.pic,
+.coverage-summary th.abs,
+.coverage-summary td.pct,
+.coverage-summary td.abs { text-align: right; }
+.coverage-summary td.file { white-space: nowrap;  }
+.coverage-summary td.pic { min-width: 120px !important;  }
+.coverage-summary tfoot td { }
+
+.coverage-summary .sorter {
+    height: 10px;
+    width: 7px;
+    display: inline-block;
+    margin-left: 0.5em;
+    background: url(sort-arrow-sprite.png) no-repeat scroll 0 0 transparent;
+}
+.coverage-summary .sorted .sorter {
+    background-position: 0 -20px;
+}
+.coverage-summary .sorted-desc .sorter {
+    background-position: 0 -10px;
+}
+.status-line {  height: 10px; }
+/* yellow */
+.cbranch-no { background: yellow !important; color: #111; }
+/* dark red */
+.red.solid, .status-line.low, .low .cover-fill { background:#C21F39 }
+.low .chart { border:1px solid #C21F39 }
+.highlighted,
+.highlighted .cstat-no, .highlighted .fstat-no, .highlighted .cbranch-no{
+  background: #C21F39 !important;
+}
+/* medium red */
+.cstat-no, .fstat-no, .cbranch-no, .cbranch-no { background:#F6C6CE }
+/* light red */
+.low, .cline-no { background:#FCE1E5 }
+/* light green */
+.high, .cline-yes { background:rgb(230,245,208) }
+/* medium green */
+.cstat-yes { background:rgb(161,215,106) }
+/* dark green */
+.status-line.high, .high .cover-fill { background:rgb(77,146,33) }
+.high .chart { border:1px solid rgb(77,146,33) }
+/* dark yellow (gold) */
+.status-line.medium, .medium .cover-fill { background: #f9cd0b; }
+.medium .chart { border:1px solid #f9cd0b; }
+/* light yellow */
+.medium { background: #fff4c2; }
+
+.cstat-skip { background: #ddd; color: #111; }
+.fstat-skip { background: #ddd; color: #111 !important; }
+.cbranch-skip { background: #ddd !important; color: #111; }
+
+span.cline-neutral { background: #eaeaea; }
+
+.coverage-summary td.empty {
+    opacity: .5;
+    padding-top: 4px;
+    padding-bottom: 4px;
+    line-height: 1;
+    color: #888;
+}
+
+.cover-fill, .cover-empty {
+  display:inline-block;
+  height: 12px;
+}
+.chart {
+  line-height: 0;
+}
+.cover-empty {
+    background: white;
+}
+.cover-full {
+    border-right: none !important;
+}
+pre.prettyprint {
+    border: none !important;
+    padding: 0 !important;
+    margin: 0 !important;
+}
+.com { color: #999 !important; }
+.ignore-none { color: #999; font-weight: normal; }
+
+.wrapper {
+  min-height: 100%;
+  height: auto !important;
+  height: 100%;
+  margin: 0 auto -48px;
+}
+.footer, .push {
+  height: 48px;
+}
diff --git a/repository_after/coverage/lcov-report/block-navigation.js b/repository_after/coverage/lcov-report/block-navigation.js
new file mode 100644
index 0000000..530d1ed
--- /dev/null
+++ b/repository_after/coverage/lcov-report/block-navigation.js
@@ -0,0 +1,87 @@
+/* eslint-disable */
+var jumpToCode = (function init() {
+    // Classes of code we would like to highlight in the file view
+    var missingCoverageClasses = ['.cbranch-no', '.cstat-no', '.fstat-no'];
+
+    // Elements to highlight in the file listing view
+    var fileListingElements = ['td.pct.low'];
+
+    // We don't want to select elements that are direct descendants of another match
+    var notSelector = ':not(' + missingCoverageClasses.join('):not(') + ') > '; // becomes `:not(a):not(b) > `
+
+    // Selector that finds elements on the page to which we can jump
+    var selector =
+        fileListingElements.join(', ') +
+        ', ' +
+        notSelector +
+        missingCoverageClasses.join(', ' + notSelector); // becomes `:not(a):not(b) > a, :not(a):not(b) > b`
+
+    // The NodeList of matching elements
+    var missingCoverageElements = document.querySelectorAll(selector);
+
+    var currentIndex;
+
+    function toggleClass(index) {
+        missingCoverageElements
+            .item(currentIndex)
+            .classList.remove('highlighted');
+        missingCoverageElements.item(index).classList.add('highlighted');
+    }
+
+    function makeCurrent(index) {
+        toggleClass(index);
+        currentIndex = index;
+        missingCoverageElements.item(index).scrollIntoView({
+            behavior: 'smooth',
+            block: 'center',
+            inline: 'center'
+        });
+    }
+
+    function goToPrevious() {
+        var nextIndex = 0;
+        if (typeof currentIndex !== 'number' || currentIndex === 0) {
+            nextIndex = missingCoverageElements.length - 1;
+        } else if (missingCoverageElements.length > 1) {
+            nextIndex = currentIndex - 1;
+        }
+
+        makeCurrent(nextIndex);
+    }
+
+    function goToNext() {
+        var nextIndex = 0;
+
+        if (
+            typeof currentIndex === 'number' &&
+            currentIndex < missingCoverageElements.length - 1
+        ) {
+            nextIndex = currentIndex + 1;
+        }
+
+        makeCurrent(nextIndex);
+    }
+
+    return function jump(event) {
+        if (
+            document.getElementById('fileSearch') === document.activeElement &&
+            document.activeElement != null
+        ) {
+            // if we're currently focused on the search input, we don't want to navigate
+            return;
+        }
+
+        switch (event.which) {
+            case 78: // n
+            case 74: // j
+                goToNext();
+                break;
+            case 66: // b
+            case 75: // k
+            case 80: // p
+                goToPrevious();
+                break;
+        }
+    };
+})();
+window.addEventListener('keydown', jumpToCode);
diff --git a/repository_after/coverage/lcov-report/favicon.png b/repository_after/coverage/lcov-report/favicon.png
new file mode 100644
index 0000000..c1525b8
Binary files /dev/null and b/repository_after/coverage/lcov-report/favicon.png differ
diff --git a/repository_after/coverage/lcov-report/index.html b/repository_after/coverage/lcov-report/index.html
new file mode 100644
index 0000000..030f28b
--- /dev/null
+++ b/repository_after/coverage/lcov-report/index.html
@@ -0,0 +1,161 @@
+
+<!doctype html>
+<html lang="en">
+
+<head>
+    <title>Code coverage report for All files</title>
+    <meta charset="utf-8" />
+    <link rel="stylesheet" href="prettify.css" />
+    <link rel="stylesheet" href="base.css" />
+    <link rel="shortcut icon" type="image/x-icon" href="favicon.png" />
+    <meta name="viewport" content="width=device-width, initial-scale=1" />
+    <style type='text/css'>
+        .coverage-summary .sorter {
+            background-image: url(sort-arrow-sprite.png);
+        }
+    </style>
+</head>
+    
+<body>
+<div class='wrapper'>
+    <div class='pad1'>
+        <h1>All files</h1>
+        <div class='clearfix'>
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">97.28% </span>
+                <span class="quiet">Statements</span>
+                <span class='fraction'>537/552</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">90.29% </span>
+                <span class="quiet">Branches</span>
+                <span class='fraction'>93/103</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">100% </span>
+                <span class="quiet">Functions</span>
+                <span class='fraction'>22/22</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">97.28% </span>
+                <span class="quiet">Lines</span>
+                <span class='fraction'>537/552</span>
+            </div>
+        
+            
+        </div>
+        <p class="quiet">
+            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
+        </p>
+        <template id="filterTemplate">
+            <div class="quiet">
+                Filter:
+                <input type="search" id="fileSearch">
+            </div>
+        </template>
+    </div>
+    <div class='status-line high'></div>
+    <div class="pad1">
+<table class="coverage-summary">
+<thead>
+<tr>
+   <th data-col="file" data-fmt="html" data-html="true" class="file">File</th>
+   <th data-col="pic" data-type="number" data-fmt="html" data-html="true" class="pic"></th>
+   <th data-col="statements" data-type="number" data-fmt="pct" class="pct">Statements</th>
+   <th data-col="statements_raw" data-type="number" data-fmt="html" class="abs"></th>
+   <th data-col="branches" data-type="number" data-fmt="pct" class="pct">Branches</th>
+   <th data-col="branches_raw" data-type="number" data-fmt="html" class="abs"></th>
+   <th data-col="functions" data-type="number" data-fmt="pct" class="pct">Functions</th>
+   <th data-col="functions_raw" data-type="number" data-fmt="html" class="abs"></th>
+   <th data-col="lines" data-type="number" data-fmt="pct" class="pct">Lines</th>
+   <th data-col="lines_raw" data-type="number" data-fmt="html" class="abs"></th>
+</tr>
+</thead>
+<tbody><tr>
+	<td class="file high" data-value="InventoryService.ts"><a href="InventoryService.ts.html">InventoryService.ts</a></td>
+	<td data-value="95.12" class="pic high">
+	<div class="chart"><div class="cover-fill" style="width: 95%"></div><div class="cover-empty" style="width: 5%"></div></div>
+	</td>
+	<td data-value="95.12" class="pct high">95.12%</td>
+	<td data-value="123" class="abs high">117/123</td>
+	<td data-value="85.71" class="pct high">85.71%</td>
+	<td data-value="21" class="abs high">18/21</td>
+	<td data-value="100" class="pct high">100%</td>
+	<td data-value="7" class="abs high">7/7</td>
+	<td data-value="95.12" class="pct high">95.12%</td>
+	<td data-value="123" class="abs high">117/123</td>
+	</tr>
+
+<tr>
+	<td class="file high" data-value="OrderService.ts"><a href="OrderService.ts.html">OrderService.ts</a></td>
+	<td data-value="97.03" class="pic high">
+	<div class="chart"><div class="cover-fill" style="width: 97%"></div><div class="cover-empty" style="width: 3%"></div></div>
+	</td>
+	<td data-value="97.03" class="pct high">97.03%</td>
+	<td data-value="270" class="abs high">262/270</td>
+	<td data-value="85.36" class="pct high">85.36%</td>
+	<td data-value="41" class="abs high">35/41</td>
+	<td data-value="100" class="pct high">100%</td>
+	<td data-value="6" class="abs high">6/6</td>
+	<td data-value="97.03" class="pct high">97.03%</td>
+	<td data-value="270" class="abs high">262/270</td>
+	</tr>
+
+<tr>
+	<td class="file high" data-value="PaymentService.ts"><a href="PaymentService.ts.html">PaymentService.ts</a></td>
+	<td data-value="100" class="pic high">
+	<div class="chart"><div class="cover-fill cover-full" style="width: 100%"></div><div class="cover-empty" style="width: 0%"></div></div>
+	</td>
+	<td data-value="100" class="pct high">100%</td>
+	<td data-value="68" class="abs high">68/68</td>
+	<td data-value="100" class="pct high">100%</td>
+	<td data-value="9" class="abs high">9/9</td>
+	<td data-value="100" class="pct high">100%</td>
+	<td data-value="5" class="abs high">5/5</td>
+	<td data-value="100" class="pct high">100%</td>
+	<td data-value="68" class="abs high">68/68</td>
+	</tr>
+
+<tr>
+	<td class="file high" data-value="ShippingService.ts"><a href="ShippingService.ts.html">ShippingService.ts</a></td>
+	<td data-value="98.9" class="pic high">
+	<div class="chart"><div class="cover-fill" style="width: 98%"></div><div class="cover-empty" style="width: 2%"></div></div>
+	</td>
+	<td data-value="98.9" class="pct high">98.9%</td>
+	<td data-value="91" class="abs high">90/91</td>
+	<td data-value="96.87" class="pct high">96.87%</td>
+	<td data-value="32" class="abs high">31/32</td>
+	<td data-value="100" class="pct high">100%</td>
+	<td data-value="4" class="abs high">4/4</td>
+	<td data-value="98.9" class="pct high">98.9%</td>
+	<td data-value="91" class="abs high">90/91</td>
+	</tr>
+
+</tbody>
+</table>
+</div>
+                <div class='push'></div><!-- for sticky footer -->
+            </div><!-- /wrapper -->
+            <div class='footer quiet pad2 space-top1 center small'>
+                Code coverage generated by
+                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
+                at 2026-02-05T08:57:14.339Z
+            </div>
+        <script src="prettify.js"></script>
+        <script>
+            window.onload = function () {
+                prettyPrint();
+            };
+        </script>
+        <script src="sorter.js"></script>
+        <script src="block-navigation.js"></script>
+    </body>
+</html>
+    
\ No newline at end of file
diff --git a/repository_after/coverage/lcov-report/prettify.css b/repository_after/coverage/lcov-report/prettify.css
new file mode 100644
index 0000000..b317a7c
--- /dev/null
+++ b/repository_after/coverage/lcov-report/prettify.css
@@ -0,0 +1 @@
+.pln{color:#000}@media screen{.str{color:#080}.kwd{color:#008}.com{color:#800}.typ{color:#606}.lit{color:#066}.pun,.opn,.clo{color:#660}.tag{color:#008}.atn{color:#606}.atv{color:#080}.dec,.var{color:#606}.fun{color:red}}@media print,projection{.str{color:#060}.kwd{color:#006;font-weight:bold}.com{color:#600;font-style:italic}.typ{color:#404;font-weight:bold}.lit{color:#044}.pun,.opn,.clo{color:#440}.tag{color:#006;font-weight:bold}.atn{color:#404}.atv{color:#060}}pre.prettyprint{padding:2px;border:1px solid #888}ol.linenums{margin-top:0;margin-bottom:0}li.L0,li.L1,li.L2,li.L3,li.L5,li.L6,li.L7,li.L8{list-style-type:none}li.L1,li.L3,li.L5,li.L7,li.L9{background:#eee}
diff --git a/repository_after/coverage/lcov-report/prettify.js b/repository_after/coverage/lcov-report/prettify.js
new file mode 100644
index 0000000..b322523
--- /dev/null
+++ b/repository_after/coverage/lcov-report/prettify.js
@@ -0,0 +1,2 @@
+/* eslint-disable */
+window.PR_SHOULD_USE_CONTINUATION=true;(function(){var h=["break,continue,do,else,for,if,return,while"];var u=[h,"auto,case,char,const,default,double,enum,extern,float,goto,int,long,register,short,signed,sizeof,static,struct,switch,typedef,union,unsigned,void,volatile"];var p=[u,"catch,class,delete,false,import,new,operator,private,protected,public,this,throw,true,try,typeof"];var l=[p,"alignof,align_union,asm,axiom,bool,concept,concept_map,const_cast,constexpr,decltype,dynamic_cast,explicit,export,friend,inline,late_check,mutable,namespace,nullptr,reinterpret_cast,static_assert,static_cast,template,typeid,typename,using,virtual,where"];var x=[p,"abstract,boolean,byte,extends,final,finally,implements,import,instanceof,null,native,package,strictfp,super,synchronized,throws,transient"];var R=[x,"as,base,by,checked,decimal,delegate,descending,dynamic,event,fixed,foreach,from,group,implicit,in,interface,internal,into,is,lock,object,out,override,orderby,params,partial,readonly,ref,sbyte,sealed,stackalloc,string,select,uint,ulong,unchecked,unsafe,ushort,var"];var r="all,and,by,catch,class,else,extends,false,finally,for,if,in,is,isnt,loop,new,no,not,null,of,off,on,or,return,super,then,true,try,unless,until,when,while,yes";var w=[p,"debugger,eval,export,function,get,null,set,undefined,var,with,Infinity,NaN"];var s="caller,delete,die,do,dump,elsif,eval,exit,foreach,for,goto,if,import,last,local,my,next,no,our,print,package,redo,require,sub,undef,unless,until,use,wantarray,while,BEGIN,END";var I=[h,"and,as,assert,class,def,del,elif,except,exec,finally,from,global,import,in,is,lambda,nonlocal,not,or,pass,print,raise,try,with,yield,False,True,None"];var f=[h,"alias,and,begin,case,class,def,defined,elsif,end,ensure,false,in,module,next,nil,not,or,redo,rescue,retry,self,super,then,true,undef,unless,until,when,yield,BEGIN,END"];var H=[h,"case,done,elif,esac,eval,fi,function,in,local,set,then,until"];var A=[l,R,w,s+I,f,H];var e=/^(DIR|FILE|vector|(de|priority_)?queue|list|stack|(const_)?iterator|(multi)?(set|map)|bitset|u?(int|float)\d*)/;var C="str";var z="kwd";var j="com";var O="typ";var G="lit";var L="pun";var F="pln";var m="tag";var E="dec";var J="src";var P="atn";var n="atv";var N="nocode";var M="(?:^^\\.?|[+-]|\\!|\\!=|\\!==|\\#|\\%|\\%=|&|&&|&&=|&=|\\(|\\*|\\*=|\\+=|\\,|\\-=|\\->|\\/|\\/=|:|::|\\;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\@|\\[|\\^|\\^=|\\^\\^|\\^\\^=|\\{|\\||\\|=|\\|\\||\\|\\|=|\\~|break|case|continue|delete|do|else|finally|instanceof|return|throw|try|typeof)\\s*";function k(Z){var ad=0;var S=false;var ac=false;for(var V=0,U=Z.length;V<U;++V){var ae=Z[V];if(ae.ignoreCase){ac=true}else{if(/[a-z]/i.test(ae.source.replace(/\\u[0-9a-f]{4}|\\x[0-9a-f]{2}|\\[^ux]/gi,""))){S=true;ac=false;break}}}var Y={b:8,t:9,n:10,v:11,f:12,r:13};function ab(ah){var ag=ah.charCodeAt(0);if(ag!==92){return ag}var af=ah.charAt(1);ag=Y[af];if(ag){return ag}else{if("0"<=af&&af<="7"){return parseInt(ah.substring(1),8)}else{if(af==="u"||af==="x"){return parseInt(ah.substring(2),16)}else{return ah.charCodeAt(1)}}}}function T(af){if(af<32){return(af<16?"\\x0":"\\x")+af.toString(16)}var ag=String.fromCharCode(af);if(ag==="\\"||ag==="-"||ag==="["||ag==="]"){ag="\\"+ag}return ag}function X(am){var aq=am.substring(1,am.length-1).match(new RegExp("\\\\u[0-9A-Fa-f]{4}|\\\\x[0-9A-Fa-f]{2}|\\\\[0-3][0-7]{0,2}|\\\\[0-7]{1,2}|\\\\[\\s\\S]|-|[^-\\\\]","g"));var ak=[];var af=[];var ao=aq[0]==="^";for(var ar=ao?1:0,aj=aq.length;ar<aj;++ar){var ah=aq[ar];if(/\\[bdsw]/i.test(ah)){ak.push(ah)}else{var ag=ab(ah);var al;if(ar+2<aj&&"-"===aq[ar+1]){al=ab(aq[ar+2]);ar+=2}else{al=ag}af.push([ag,al]);if(!(al<65||ag>122)){if(!(al<65||ag>90)){af.push([Math.max(65,ag)|32,Math.min(al,90)|32])}if(!(al<97||ag>122)){af.push([Math.max(97,ag)&~32,Math.min(al,122)&~32])}}}}af.sort(function(av,au){return(av[0]-au[0])||(au[1]-av[1])});var ai=[];var ap=[NaN,NaN];for(var ar=0;ar<af.length;++ar){var at=af[ar];if(at[0]<=ap[1]+1){ap[1]=Math.max(ap[1],at[1])}else{ai.push(ap=at)}}var an=["["];if(ao){an.push("^")}an.push.apply(an,ak);for(var ar=0;ar<ai.length;++ar){var at=ai[ar];an.push(T(at[0]));if(at[1]>at[0]){if(at[1]+1>at[0]){an.push("-")}an.push(T(at[1]))}}an.push("]");return an.join("")}function W(al){var aj=al.source.match(new RegExp("(?:\\[(?:[^\\x5C\\x5D]|\\\\[\\s\\S])*\\]|\\\\u[A-Fa-f0-9]{4}|\\\\x[A-Fa-f0-9]{2}|\\\\[0-9]+|\\\\[^ux0-9]|\\(\\?[:!=]|[\\(\\)\\^]|[^\\x5B\\x5C\\(\\)\\^]+)","g"));var ah=aj.length;var an=[];for(var ak=0,am=0;ak<ah;++ak){var ag=aj[ak];if(ag==="("){++am}else{if("\\"===ag.charAt(0)){var af=+ag.substring(1);if(af&&af<=am){an[af]=-1}}}}for(var ak=1;ak<an.length;++ak){if(-1===an[ak]){an[ak]=++ad}}for(var ak=0,am=0;ak<ah;++ak){var ag=aj[ak];if(ag==="("){++am;if(an[am]===undefined){aj[ak]="(?:"}}else{if("\\"===ag.charAt(0)){var af=+ag.substring(1);if(af&&af<=am){aj[ak]="\\"+an[am]}}}}for(var ak=0,am=0;ak<ah;++ak){if("^"===aj[ak]&&"^"!==aj[ak+1]){aj[ak]=""}}if(al.ignoreCase&&S){for(var ak=0;ak<ah;++ak){var ag=aj[ak];var ai=ag.charAt(0);if(ag.length>=2&&ai==="["){aj[ak]=X(ag)}else{if(ai!=="\\"){aj[ak]=ag.replace(/[a-zA-Z]/g,function(ao){var ap=ao.charCodeAt(0);return"["+String.fromCharCode(ap&~32,ap|32)+"]"})}}}}return aj.join("")}var aa=[];for(var V=0,U=Z.length;V<U;++V){var ae=Z[V];if(ae.global||ae.multiline){throw new Error(""+ae)}aa.push("(?:"+W(ae)+")")}return new RegExp(aa.join("|"),ac?"gi":"g")}function a(V){var U=/(?:^|\s)nocode(?:\s|$)/;var X=[];var T=0;var Z=[];var W=0;var S;if(V.currentStyle){S=V.currentStyle.whiteSpace}else{if(window.getComputedStyle){S=document.defaultView.getComputedStyle(V,null).getPropertyValue("white-space")}}var Y=S&&"pre"===S.substring(0,3);function aa(ab){switch(ab.nodeType){case 1:if(U.test(ab.className)){return}for(var ae=ab.firstChild;ae;ae=ae.nextSibling){aa(ae)}var ad=ab.nodeName;if("BR"===ad||"LI"===ad){X[W]="\n";Z[W<<1]=T++;Z[(W++<<1)|1]=ab}break;case 3:case 4:var ac=ab.nodeValue;if(ac.length){if(!Y){ac=ac.replace(/[ \t\r\n]+/g," ")}else{ac=ac.replace(/\r\n?/g,"\n")}X[W]=ac;Z[W<<1]=T;T+=ac.length;Z[(W++<<1)|1]=ab}break}}aa(V);return{sourceCode:X.join("").replace(/\n$/,""),spans:Z}}function B(S,U,W,T){if(!U){return}var V={sourceCode:U,basePos:S};W(V);T.push.apply(T,V.decorations)}var v=/\S/;function o(S){var V=undefined;for(var U=S.firstChild;U;U=U.nextSibling){var T=U.nodeType;V=(T===1)?(V?S:U):(T===3)?(v.test(U.nodeValue)?S:V):V}return V===S?undefined:V}function g(U,T){var S={};var V;(function(){var ad=U.concat(T);var ah=[];var ag={};for(var ab=0,Z=ad.length;ab<Z;++ab){var Y=ad[ab];var ac=Y[3];if(ac){for(var ae=ac.length;--ae>=0;){S[ac.charAt(ae)]=Y}}var af=Y[1];var aa=""+af;if(!ag.hasOwnProperty(aa)){ah.push(af);ag[aa]=null}}ah.push(/[\0-\uffff]/);V=k(ah)})();var X=T.length;var W=function(ah){var Z=ah.sourceCode,Y=ah.basePos;var ad=[Y,F];var af=0;var an=Z.match(V)||[];var aj={};for(var ae=0,aq=an.length;ae<aq;++ae){var ag=an[ae];var ap=aj[ag];var ai=void 0;var am;if(typeof ap==="string"){am=false}else{var aa=S[ag.charAt(0)];if(aa){ai=ag.match(aa[1]);ap=aa[0]}else{for(var ao=0;ao<X;++ao){aa=T[ao];ai=ag.match(aa[1]);if(ai){ap=aa[0];break}}if(!ai){ap=F}}am=ap.length>=5&&"lang-"===ap.substring(0,5);if(am&&!(ai&&typeof ai[1]==="string")){am=false;ap=J}if(!am){aj[ag]=ap}}var ab=af;af+=ag.length;if(!am){ad.push(Y+ab,ap)}else{var al=ai[1];var ak=ag.indexOf(al);var ac=ak+al.length;if(ai[2]){ac=ag.length-ai[2].length;ak=ac-al.length}var ar=ap.substring(5);B(Y+ab,ag.substring(0,ak),W,ad);B(Y+ab+ak,al,q(ar,al),ad);B(Y+ab+ac,ag.substring(ac),W,ad)}}ah.decorations=ad};return W}function i(T){var W=[],S=[];if(T.tripleQuotedStrings){W.push([C,/^(?:\'\'\'(?:[^\'\\]|\\[\s\S]|\'{1,2}(?=[^\']))*(?:\'\'\'|$)|\"\"\"(?:[^\"\\]|\\[\s\S]|\"{1,2}(?=[^\"]))*(?:\"\"\"|$)|\'(?:[^\\\']|\\[\s\S])*(?:\'|$)|\"(?:[^\\\"]|\\[\s\S])*(?:\"|$))/,null,"'\""])}else{if(T.multiLineStrings){W.push([C,/^(?:\'(?:[^\\\']|\\[\s\S])*(?:\'|$)|\"(?:[^\\\"]|\\[\s\S])*(?:\"|$)|\`(?:[^\\\`]|\\[\s\S])*(?:\`|$))/,null,"'\"`"])}else{W.push([C,/^(?:\'(?:[^\\\'\r\n]|\\.)*(?:\'|$)|\"(?:[^\\\"\r\n]|\\.)*(?:\"|$))/,null,"\"'"])}}if(T.verbatimStrings){S.push([C,/^@\"(?:[^\"]|\"\")*(?:\"|$)/,null])}var Y=T.hashComments;if(Y){if(T.cStyleComments){if(Y>1){W.push([j,/^#(?:##(?:[^#]|#(?!##))*(?:###|$)|.*)/,null,"#"])}else{W.push([j,/^#(?:(?:define|elif|else|endif|error|ifdef|include|ifndef|line|pragma|undef|warning)\b|[^\r\n]*)/,null,"#"])}S.push([C,/^<(?:(?:(?:\.\.\/)*|\/?)(?:[\w-]+(?:\/[\w-]+)+)?[\w-]+\.h|[a-z]\w*)>/,null])}else{W.push([j,/^#[^\r\n]*/,null,"#"])}}if(T.cStyleComments){S.push([j,/^\/\/[^\r\n]*/,null]);S.push([j,/^\/\*[\s\S]*?(?:\*\/|$)/,null])}if(T.regexLiterals){var X=("/(?=[^/*])(?:[^/\\x5B\\x5C]|\\x5C[\\s\\S]|\\x5B(?:[^\\x5C\\x5D]|\\x5C[\\s\\S])*(?:\\x5D|$))+/");S.push(["lang-regex",new RegExp("^"+M+"("+X+")")])}var V=T.types;if(V){S.push([O,V])}var U=(""+T.keywords).replace(/^ | $/g,"");if(U.length){S.push([z,new RegExp("^(?:"+U.replace(/[\s,]+/g,"|")+")\\b"),null])}W.push([F,/^\s+/,null," \r\n\t\xA0"]);S.push([G,/^@[a-z_$][a-z_$@0-9]*/i,null],[O,/^(?:[@_]?[A-Z]+[a-z][A-Za-z_$@0-9]*|\w+_t\b)/,null],[F,/^[a-z_$][a-z_$@0-9]*/i,null],[G,new RegExp("^(?:0x[a-f0-9]+|(?:\\d(?:_\\d+)*\\d*(?:\\.\\d*)?|\\.\\d\\+)(?:e[+\\-]?\\d+)?)[a-z]*","i"),null,"0123456789"],[F,/^\\[\s\S]?/,null],[L,/^.[^\s\w\.$@\'\"\`\/\#\\]*/,null]);return g(W,S)}var K=i({keywords:A,hashComments:true,cStyleComments:true,multiLineStrings:true,regexLiterals:true});function Q(V,ag){var U=/(?:^|\s)nocode(?:\s|$)/;var ab=/\r\n?|\n/;var ac=V.ownerDocument;var S;if(V.currentStyle){S=V.currentStyle.whiteSpace}else{if(window.getComputedStyle){S=ac.defaultView.getComputedStyle(V,null).getPropertyValue("white-space")}}var Z=S&&"pre"===S.substring(0,3);var af=ac.createElement("LI");while(V.firstChild){af.appendChild(V.firstChild)}var W=[af];function ae(al){switch(al.nodeType){case 1:if(U.test(al.className)){break}if("BR"===al.nodeName){ad(al);if(al.parentNode){al.parentNode.removeChild(al)}}else{for(var an=al.firstChild;an;an=an.nextSibling){ae(an)}}break;case 3:case 4:if(Z){var am=al.nodeValue;var aj=am.match(ab);if(aj){var ai=am.substring(0,aj.index);al.nodeValue=ai;var ah=am.substring(aj.index+aj[0].length);if(ah){var ak=al.parentNode;ak.insertBefore(ac.createTextNode(ah),al.nextSibling)}ad(al);if(!ai){al.parentNode.removeChild(al)}}}break}}function ad(ak){while(!ak.nextSibling){ak=ak.parentNode;if(!ak){return}}function ai(al,ar){var aq=ar?al.cloneNode(false):al;var ao=al.parentNode;if(ao){var ap=ai(ao,1);var an=al.nextSibling;ap.appendChild(aq);for(var am=an;am;am=an){an=am.nextSibling;ap.appendChild(am)}}return aq}var ah=ai(ak.nextSibling,0);for(var aj;(aj=ah.parentNode)&&aj.nodeType===1;){ah=aj}W.push(ah)}for(var Y=0;Y<W.length;++Y){ae(W[Y])}if(ag===(ag|0)){W[0].setAttribute("value",ag)}var aa=ac.createElement("OL");aa.className="linenums";var X=Math.max(0,((ag-1))|0)||0;for(var Y=0,T=W.length;Y<T;++Y){af=W[Y];af.className="L"+((Y+X)%10);if(!af.firstChild){af.appendChild(ac.createTextNode("\xA0"))}aa.appendChild(af)}V.appendChild(aa)}function D(ac){var aj=/\bMSIE\b/.test(navigator.userAgent);var am=/\n/g;var al=ac.sourceCode;var an=al.length;var V=0;var aa=ac.spans;var T=aa.length;var ah=0;var X=ac.decorations;var Y=X.length;var Z=0;X[Y]=an;var ar,aq;for(aq=ar=0;aq<Y;){if(X[aq]!==X[aq+2]){X[ar++]=X[aq++];X[ar++]=X[aq++]}else{aq+=2}}Y=ar;for(aq=ar=0;aq<Y;){var at=X[aq];var ab=X[aq+1];var W=aq+2;while(W+2<=Y&&X[W+1]===ab){W+=2}X[ar++]=at;X[ar++]=ab;aq=W}Y=X.length=ar;var ae=null;while(ah<T){var af=aa[ah];var S=aa[ah+2]||an;var ag=X[Z];var ap=X[Z+2]||an;var W=Math.min(S,ap);var ak=aa[ah+1];var U;if(ak.nodeType!==1&&(U=al.substring(V,W))){if(aj){U=U.replace(am,"\r")}ak.nodeValue=U;var ai=ak.ownerDocument;var ao=ai.createElement("SPAN");ao.className=X[Z+1];var ad=ak.parentNode;ad.replaceChild(ao,ak);ao.appendChild(ak);if(V<S){aa[ah+1]=ak=ai.createTextNode(al.substring(W,S));ad.insertBefore(ak,ao.nextSibling)}}V=W;if(V>=S){ah+=2}if(V>=ap){Z+=2}}}var t={};function c(U,V){for(var S=V.length;--S>=0;){var T=V[S];if(!t.hasOwnProperty(T)){t[T]=U}else{if(window.console){console.warn("cannot override language handler %s",T)}}}}function q(T,S){if(!(T&&t.hasOwnProperty(T))){T=/^\s*</.test(S)?"default-markup":"default-code"}return t[T]}c(K,["default-code"]);c(g([],[[F,/^[^<?]+/],[E,/^<!\w[^>]*(?:>|$)/],[j,/^<\!--[\s\S]*?(?:-\->|$)/],["lang-",/^<\?([\s\S]+?)(?:\?>|$)/],["lang-",/^<%([\s\S]+?)(?:%>|$)/],[L,/^(?:<[%?]|[%?]>)/],["lang-",/^<xmp\b[^>]*>([\s\S]+?)<\/xmp\b[^>]*>/i],["lang-js",/^<script\b[^>]*>([\s\S]*?)(<\/script\b[^>]*>)/i],["lang-css",/^<style\b[^>]*>([\s\S]*?)(<\/style\b[^>]*>)/i],["lang-in.tag",/^(<\/?[a-z][^<>]*>)/i]]),["default-markup","htm","html","mxml","xhtml","xml","xsl"]);c(g([[F,/^[\s]+/,null," \t\r\n"],[n,/^(?:\"[^\"]*\"?|\'[^\']*\'?)/,null,"\"'"]],[[m,/^^<\/?[a-z](?:[\w.:-]*\w)?|\/?>$/i],[P,/^(?!style[\s=]|on)[a-z](?:[\w:-]*\w)?/i],["lang-uq.val",/^=\s*([^>\'\"\s]*(?:[^>\'\"\s\/]|\/(?=\s)))/],[L,/^[=<>\/]+/],["lang-js",/^on\w+\s*=\s*\"([^\"]+)\"/i],["lang-js",/^on\w+\s*=\s*\'([^\']+)\'/i],["lang-js",/^on\w+\s*=\s*([^\"\'>\s]+)/i],["lang-css",/^style\s*=\s*\"([^\"]+)\"/i],["lang-css",/^style\s*=\s*\'([^\']+)\'/i],["lang-css",/^style\s*=\s*([^\"\'>\s]+)/i]]),["in.tag"]);c(g([],[[n,/^[\s\S]+/]]),["uq.val"]);c(i({keywords:l,hashComments:true,cStyleComments:true,types:e}),["c","cc","cpp","cxx","cyc","m"]);c(i({keywords:"null,true,false"}),["json"]);c(i({keywords:R,hashComments:true,cStyleComments:true,verbatimStrings:true,types:e}),["cs"]);c(i({keywords:x,cStyleComments:true}),["java"]);c(i({keywords:H,hashComments:true,multiLineStrings:true}),["bsh","csh","sh"]);c(i({keywords:I,hashComments:true,multiLineStrings:true,tripleQuotedStrings:true}),["cv","py"]);c(i({keywords:s,hashComments:true,multiLineStrings:true,regexLiterals:true}),["perl","pl","pm"]);c(i({keywords:f,hashComments:true,multiLineStrings:true,regexLiterals:true}),["rb"]);c(i({keywords:w,cStyleComments:true,regexLiterals:true}),["js"]);c(i({keywords:r,hashComments:3,cStyleComments:true,multilineStrings:true,tripleQuotedStrings:true,regexLiterals:true}),["coffee"]);c(g([],[[C,/^[\s\S]+/]]),["regex"]);function d(V){var U=V.langExtension;try{var S=a(V.sourceNode);var T=S.sourceCode;V.sourceCode=T;V.spans=S.spans;V.basePos=0;q(U,T)(V);D(V)}catch(W){if("console" in window){console.log(W&&W.stack?W.stack:W)}}}function y(W,V,U){var S=document.createElement("PRE");S.innerHTML=W;if(U){Q(S,U)}var T={langExtension:V,numberLines:U,sourceNode:S};d(T);return S.innerHTML}function b(ad){function Y(af){return document.getElementsByTagName(af)}var ac=[Y("pre"),Y("code"),Y("xmp")];var T=[];for(var aa=0;aa<ac.length;++aa){for(var Z=0,V=ac[aa].length;Z<V;++Z){T.push(ac[aa][Z])}}ac=null;var W=Date;if(!W.now){W={now:function(){return +(new Date)}}}var X=0;var S;var ab=/\blang(?:uage)?-([\w.]+)(?!\S)/;var ae=/\bprettyprint\b/;function U(){var ag=(window.PR_SHOULD_USE_CONTINUATION?W.now()+250:Infinity);for(;X<T.length&&W.now()<ag;X++){var aj=T[X];var ai=aj.className;if(ai.indexOf("prettyprint")>=0){var ah=ai.match(ab);var am;if(!ah&&(am=o(aj))&&"CODE"===am.tagName){ah=am.className.match(ab)}if(ah){ah=ah[1]}var al=false;for(var ak=aj.parentNode;ak;ak=ak.parentNode){if((ak.tagName==="pre"||ak.tagName==="code"||ak.tagName==="xmp")&&ak.className&&ak.className.indexOf("prettyprint")>=0){al=true;break}}if(!al){var af=aj.className.match(/\blinenums\b(?::(\d+))?/);af=af?af[1]&&af[1].length?+af[1]:true:false;if(af){Q(aj,af)}S={langExtension:ah,sourceNode:aj,numberLines:af};d(S)}}}if(X<T.length){setTimeout(U,250)}else{if(ad){ad()}}}U()}window.prettyPrintOne=y;window.prettyPrint=b;window.PR={createSimpleLexer:g,registerLangHandler:c,sourceDecorator:i,PR_ATTRIB_NAME:P,PR_ATTRIB_VALUE:n,PR_COMMENT:j,PR_DECLARATION:E,PR_KEYWORD:z,PR_LITERAL:G,PR_NOCODE:N,PR_PLAIN:F,PR_PUNCTUATION:L,PR_SOURCE:J,PR_STRING:C,PR_TAG:m,PR_TYPE:O}})();PR.registerLangHandler(PR.createSimpleLexer([],[[PR.PR_DECLARATION,/^<!\w[^>]*(?:>|$)/],[PR.PR_COMMENT,/^<\!--[\s\S]*?(?:-\->|$)/],[PR.PR_PUNCTUATION,/^(?:<[%?]|[%?]>)/],["lang-",/^<\?([\s\S]+?)(?:\?>|$)/],["lang-",/^<%([\s\S]+?)(?:%>|$)/],["lang-",/^<xmp\b[^>]*>([\s\S]+?)<\/xmp\b[^>]*>/i],["lang-handlebars",/^<script\b[^>]*type\s*=\s*['"]?text\/x-handlebars-template['"]?\b[^>]*>([\s\S]*?)(<\/script\b[^>]*>)/i],["lang-js",/^<script\b[^>]*>([\s\S]*?)(<\/script\b[^>]*>)/i],["lang-css",/^<style\b[^>]*>([\s\S]*?)(<\/style\b[^>]*>)/i],["lang-in.tag",/^(<\/?[a-z][^<>]*>)/i],[PR.PR_DECLARATION,/^{{[#^>/]?\s*[\w.][^}]*}}/],[PR.PR_DECLARATION,/^{{&?\s*[\w.][^}]*}}/],[PR.PR_DECLARATION,/^{{{>?\s*[\w.][^}]*}}}/],[PR.PR_COMMENT,/^{{![^}]*}}/]]),["handlebars","hbs"]);PR.registerLangHandler(PR.createSimpleLexer([[PR.PR_PLAIN,/^[ \t\r\n\f]+/,null," \t\r\n\f"]],[[PR.PR_STRING,/^\"(?:[^\n\r\f\\\"]|\\(?:\r\n?|\n|\f)|\\[\s\S])*\"/,null],[PR.PR_STRING,/^\'(?:[^\n\r\f\\\']|\\(?:\r\n?|\n|\f)|\\[\s\S])*\'/,null],["lang-css-str",/^url\(([^\)\"\']*)\)/i],[PR.PR_KEYWORD,/^(?:url|rgb|\!important|@import|@page|@media|@charset|inherit)(?=[^\-\w]|$)/i,null],["lang-css-kw",/^(-?(?:[_a-z]|(?:\\[0-9a-f]+ ?))(?:[_a-z0-9\-]|\\(?:\\[0-9a-f]+ ?))*)\s*:/i],[PR.PR_COMMENT,/^\/\*[^*]*\*+(?:[^\/*][^*]*\*+)*\//],[PR.PR_COMMENT,/^(?:<!--|-->)/],[PR.PR_LITERAL,/^(?:\d+|\d*\.\d+)(?:%|[a-z]+)?/i],[PR.PR_LITERAL,/^#(?:[0-9a-f]{3}){1,2}/i],[PR.PR_PLAIN,/^-?(?:[_a-z]|(?:\\[\da-f]+ ?))(?:[_a-z\d\-]|\\(?:\\[\da-f]+ ?))*/i],[PR.PR_PUNCTUATION,/^[^\s\w\'\"]+/]]),["css"]);PR.registerLangHandler(PR.createSimpleLexer([],[[PR.PR_KEYWORD,/^-?(?:[_a-z]|(?:\\[\da-f]+ ?))(?:[_a-z\d\-]|\\(?:\\[\da-f]+ ?))*/i]]),["css-kw"]);PR.registerLangHandler(PR.createSimpleLexer([],[[PR.PR_STRING,/^[^\)\"\']+/]]),["css-str"]);
diff --git a/repository_after/coverage/lcov-report/sort-arrow-sprite.png b/repository_after/coverage/lcov-report/sort-arrow-sprite.png
new file mode 100644
index 0000000..6ed6831
Binary files /dev/null and b/repository_after/coverage/lcov-report/sort-arrow-sprite.png differ
diff --git a/repository_after/coverage/lcov-report/sorter.js b/repository_after/coverage/lcov-report/sorter.js
new file mode 100644
index 0000000..4ed70ae
--- /dev/null
+++ b/repository_after/coverage/lcov-report/sorter.js
@@ -0,0 +1,210 @@
+/* eslint-disable */
+var addSorting = (function() {
+    'use strict';
+    var cols,
+        currentSort = {
+            index: 0,
+            desc: false
+        };
+
+    // returns the summary table element
+    function getTable() {
+        return document.querySelector('.coverage-summary');
+    }
+    // returns the thead element of the summary table
+    function getTableHeader() {
+        return getTable().querySelector('thead tr');
+    }
+    // returns the tbody element of the summary table
+    function getTableBody() {
+        return getTable().querySelector('tbody');
+    }
+    // returns the th element for nth column
+    function getNthColumn(n) {
+        return getTableHeader().querySelectorAll('th')[n];
+    }
+
+    function onFilterInput() {
+        const searchValue = document.getElementById('fileSearch').value;
+        const rows = document.getElementsByTagName('tbody')[0].children;
+
+        // Try to create a RegExp from the searchValue. If it fails (invalid regex),
+        // it will be treated as a plain text search
+        let searchRegex;
+        try {
+            searchRegex = new RegExp(searchValue, 'i'); // 'i' for case-insensitive
+        } catch (error) {
+            searchRegex = null;
+        }
+
+        for (let i = 0; i < rows.length; i++) {
+            const row = rows[i];
+            let isMatch = false;
+
+            if (searchRegex) {
+                // If a valid regex was created, use it for matching
+                isMatch = searchRegex.test(row.textContent);
+            } else {
+                // Otherwise, fall back to the original plain text search
+                isMatch = row.textContent
+                    .toLowerCase()
+                    .includes(searchValue.toLowerCase());
+            }
+
+            row.style.display = isMatch ? '' : 'none';
+        }
+    }
+
+    // loads the search box
+    function addSearchBox() {
+        var template = document.getElementById('filterTemplate');
+        var templateClone = template.content.cloneNode(true);
+        templateClone.getElementById('fileSearch').oninput = onFilterInput;
+        template.parentElement.appendChild(templateClone);
+    }
+
+    // loads all columns
+    function loadColumns() {
+        var colNodes = getTableHeader().querySelectorAll('th'),
+            colNode,
+            cols = [],
+            col,
+            i;
+
+        for (i = 0; i < colNodes.length; i += 1) {
+            colNode = colNodes[i];
+            col = {
+                key: colNode.getAttribute('data-col'),
+                sortable: !colNode.getAttribute('data-nosort'),
+                type: colNode.getAttribute('data-type') || 'string'
+            };
+            cols.push(col);
+            if (col.sortable) {
+                col.defaultDescSort = col.type === 'number';
+                colNode.innerHTML =
+                    colNode.innerHTML + '<span class="sorter"></span>';
+            }
+        }
+        return cols;
+    }
+    // attaches a data attribute to every tr element with an object
+    // of data values keyed by column name
+    function loadRowData(tableRow) {
+        var tableCols = tableRow.querySelectorAll('td'),
+            colNode,
+            col,
+            data = {},
+            i,
+            val;
+        for (i = 0; i < tableCols.length; i += 1) {
+            colNode = tableCols[i];
+            col = cols[i];
+            val = colNode.getAttribute('data-value');
+            if (col.type === 'number') {
+                val = Number(val);
+            }
+            data[col.key] = val;
+        }
+        return data;
+    }
+    // loads all row data
+    function loadData() {
+        var rows = getTableBody().querySelectorAll('tr'),
+            i;
+
+        for (i = 0; i < rows.length; i += 1) {
+            rows[i].data = loadRowData(rows[i]);
+        }
+    }
+    // sorts the table using the data for the ith column
+    function sortByIndex(index, desc) {
+        var key = cols[index].key,
+            sorter = function(a, b) {
+                a = a.data[key];
+                b = b.data[key];
+                return a < b ? -1 : a > b ? 1 : 0;
+            },
+            finalSorter = sorter,
+            tableBody = document.querySelector('.coverage-summary tbody'),
+            rowNodes = tableBody.querySelectorAll('tr'),
+            rows = [],
+            i;
+
+        if (desc) {
+            finalSorter = function(a, b) {
+                return -1 * sorter(a, b);
+            };
+        }
+
+        for (i = 0; i < rowNodes.length; i += 1) {
+            rows.push(rowNodes[i]);
+            tableBody.removeChild(rowNodes[i]);
+        }
+
+        rows.sort(finalSorter);
+
+        for (i = 0; i < rows.length; i += 1) {
+            tableBody.appendChild(rows[i]);
+        }
+    }
+    // removes sort indicators for current column being sorted
+    function removeSortIndicators() {
+        var col = getNthColumn(currentSort.index),
+            cls = col.className;
+
+        cls = cls.replace(/ sorted$/, '').replace(/ sorted-desc$/, '');
+        col.className = cls;
+    }
+    // adds sort indicators for current column being sorted
+    function addSortIndicators() {
+        getNthColumn(currentSort.index).className += currentSort.desc
+            ? ' sorted-desc'
+            : ' sorted';
+    }
+    // adds event listeners for all sorter widgets
+    function enableUI() {
+        var i,
+            el,
+            ithSorter = function ithSorter(i) {
+                var col = cols[i];
+
+                return function() {
+                    var desc = col.defaultDescSort;
+
+                    if (currentSort.index === i) {
+                        desc = !currentSort.desc;
+                    }
+                    sortByIndex(i, desc);
+                    removeSortIndicators();
+                    currentSort.index = i;
+                    currentSort.desc = desc;
+                    addSortIndicators();
+                };
+            };
+        for (i = 0; i < cols.length; i += 1) {
+            if (cols[i].sortable) {
+                // add the click event handler on the th so users
+                // dont have to click on those tiny arrows
+                el = getNthColumn(i).querySelector('.sorter').parentElement;
+                if (el.addEventListener) {
+                    el.addEventListener('click', ithSorter(i));
+                } else {
+                    el.attachEvent('onclick', ithSorter(i));
+                }
+            }
+        }
+    }
+    // adds sorting functionality to the UI
+    return function() {
+        if (!getTable()) {
+            return;
+        }
+        cols = loadColumns();
+        loadData();
+        addSearchBox();
+        addSortIndicators();
+        enableUI();
+    };
+})();
+
+window.addEventListener('load', addSorting);
diff --git a/repository_after/coverage/lcov.info b/repository_after/coverage/lcov.info
new file mode 100644
index 0000000..63fc3fb
--- /dev/null
+++ b/repository_after/coverage/lcov.info
@@ -0,0 +1,735 @@
+TN:
+SF:repository_before/services/InventoryService.ts
+FN:10,InventoryService
+FN:15,getAvailableQuantity
+FN:31,getReservedQuantity
+FN:36,reserve
+FN:64,confirmReservation
+FN:95,release
+FN:115,setQuantity
+FNF:7
+FNH:7
+FNDA:27,InventoryService
+FNDA:45,getAvailableQuantity
+FNDA:82,getReservedQuantity
+FNDA:25,reserve
+FNDA:12,confirmReservation
+FNDA:8,release
+FNDA:1,setQuantity
+DA:1,1
+DA:2,1
+DA:3,1
+DA:4,1
+DA:5,1
+DA:6,1
+DA:7,1
+DA:8,1
+DA:9,1
+DA:10,1
+DA:11,27
+DA:12,27
+DA:13,27
+DA:14,1
+DA:15,1
+DA:16,45
+DA:17,45
+DA:18,45
+DA:19,45
+DA:20,45
+DA:21,45
+DA:22,1
+DA:23,1
+DA:24,44
+DA:25,44
+DA:26,44
+DA:27,44
+DA:28,44
+DA:29,44
+DA:30,1
+DA:31,1
+DA:32,82
+DA:33,82
+DA:34,82
+DA:35,1
+DA:36,1
+DA:37,25
+DA:38,25
+DA:39,25
+DA:40,25
+DA:41,4
+DA:42,4
+DA:43,4
+DA:44,21
+DA:45,21
+DA:46,21
+DA:47,21
+DA:48,25
+DA:49,3
+DA:50,3
+DA:51,18
+DA:52,18
+DA:53,18
+DA:54,18
+DA:55,18
+DA:56,18
+DA:57,18
+DA:58,18
+DA:59,18
+DA:60,21
+DA:61,21
+DA:62,25
+DA:63,1
+DA:64,1
+DA:65,12
+DA:66,12
+DA:67,12
+DA:68,12
+DA:69,12
+DA:70,12
+DA:71,12
+DA:72,12
+DA:73,12
+DA:74,12
+DA:75,12
+DA:76,12
+DA:77,12
+DA:78,12
+DA:79,12
+DA:80,0
+DA:81,0
+DA:82,12
+DA:83,12
+DA:84,12
+DA:85,12
+DA:86,12
+DA:87,12
+DA:88,0
+DA:89,0
+DA:90,12
+DA:91,12
+DA:92,12
+DA:93,12
+DA:94,1
+DA:95,1
+DA:96,8
+DA:97,8
+DA:98,8
+DA:99,8
+DA:100,4
+DA:101,4
+DA:102,0
+DA:103,0
+DA:104,4
+DA:105,4
+DA:106,4
+DA:107,4
+DA:108,4
+DA:109,4
+DA:110,4
+DA:111,4
+DA:112,4
+DA:113,8
+DA:114,1
+DA:115,1
+DA:116,1
+DA:117,1
+DA:118,1
+DA:119,1
+DA:120,1
+DA:121,1
+DA:122,1
+DA:123,1
+LF:123
+LH:117
+BRDA:10,0,0,27
+BRDA:15,1,0,45
+BRDA:21,2,0,1
+BRDA:24,3,0,44
+BRDA:31,4,0,82
+BRDA:33,5,0,17
+BRDA:33,6,0,65
+BRDA:36,7,0,25
+BRDA:40,8,0,4
+BRDA:44,9,0,21
+BRDA:48,10,0,3
+BRDA:51,11,0,18
+BRDA:59,12,0,21
+BRDA:41,13,0,4
+BRDA:64,14,0,12
+BRDA:79,15,0,0
+BRDA:87,16,0,0
+BRDA:95,17,0,8
+BRDA:99,18,0,4
+BRDA:101,19,0,0
+BRDA:115,20,0,1
+BRF:21
+BRH:18
+end_of_record
+TN:
+SF:repository_before/services/OrderService.ts
+FN:53,OrderService
+FN:67,createOrder
+FN:160,getOrderById
+FN:173,cancelOrder
+FN:200,processRefund
+FN:253,mapRowToOrder
+FNF:6
+FNH:6
+FNDA:27,OrderService
+FNDA:20,createOrder
+FNDA:13,getOrderById
+FNDA:2,cancelOrder
+FNDA:5,processRefund
+FNDA:27,mapRowToOrder
+DA:1,1
+DA:2,1
+DA:3,1
+DA:4,1
+DA:5,1
+DA:6,1
+DA:7,1
+DA:8,1
+DA:9,1
+DA:10,1
+DA:11,1
+DA:12,1
+DA:13,1
+DA:14,1
+DA:15,1
+DA:16,1
+DA:17,1
+DA:18,1
+DA:19,1
+DA:20,1
+DA:21,1
+DA:22,1
+DA:23,1
+DA:24,1
+DA:25,1
+DA:26,1
+DA:27,1
+DA:28,1
+DA:29,1
+DA:30,1
+DA:31,1
+DA:32,1
+DA:33,1
+DA:34,1
+DA:35,1
+DA:36,1
+DA:37,1
+DA:38,1
+DA:39,1
+DA:40,1
+DA:41,1
+DA:42,1
+DA:43,1
+DA:44,1
+DA:45,1
+DA:46,1
+DA:47,1
+DA:48,1
+DA:49,1
+DA:50,1
+DA:51,1
+DA:52,1
+DA:53,1
+DA:54,27
+DA:55,27
+DA:56,27
+DA:57,27
+DA:58,27
+DA:59,27
+DA:60,27
+DA:61,27
+DA:62,27
+DA:63,27
+DA:64,27
+DA:65,27
+DA:66,1
+DA:67,1
+DA:68,20
+DA:69,20
+DA:70,2
+DA:71,2
+DA:72,18
+DA:73,18
+DA:74,21
+DA:75,21
+DA:76,2
+DA:77,2
+DA:78,21
+DA:79,16
+DA:80,17
+DA:81,18
+DA:82,18
+DA:83,2
+DA:84,2
+DA:85,0
+DA:86,0
+DA:87,2
+DA:88,2
+DA:89,18
+DA:90,14
+DA:91,14
+DA:92,14
+DA:93,14
+DA:94,14
+DA:95,14
+DA:96,14
+DA:97,14
+DA:98,14
+DA:99,14
+DA:100,14
+DA:101,14
+DA:102,14
+DA:103,14
+DA:104,14
+DA:105,14
+DA:106,14
+DA:107,14
+DA:108,14
+DA:109,14
+DA:110,14
+DA:111,14
+DA:112,14
+DA:113,14
+DA:114,14
+DA:115,14
+DA:116,14
+DA:117,14
+DA:118,14
+DA:119,14
+DA:120,14
+DA:121,14
+DA:122,14
+DA:123,14
+DA:124,14
+DA:125,14
+DA:126,14
+DA:127,10
+DA:128,14
+DA:129,12
+DA:130,12
+DA:131,10
+DA:132,10
+DA:133,10
+DA:134,10
+DA:135,10
+DA:136,10
+DA:137,10
+DA:138,10
+DA:139,10
+DA:140,10
+DA:141,10
+DA:142,10
+DA:143,10
+DA:144,10
+DA:145,20
+DA:146,4
+DA:147,4
+DA:148,4
+DA:149,4
+DA:150,4
+DA:151,4
+DA:152,4
+DA:153,4
+DA:154,4
+DA:155,4
+DA:156,4
+DA:157,4
+DA:158,20
+DA:159,1
+DA:160,1
+DA:161,13
+DA:162,13
+DA:163,13
+DA:164,13
+DA:165,13
+DA:166,13
+DA:167,0
+DA:168,0
+DA:169,13
+DA:170,13
+DA:171,13
+DA:172,1
+DA:173,1
+DA:174,2
+DA:175,2
+DA:176,2
+DA:177,1
+DA:178,1
+DA:179,1
+DA:180,1
+DA:181,1
+DA:182,1
+DA:183,0
+DA:184,0
+DA:185,1
+DA:186,1
+DA:187,1
+DA:188,1
+DA:189,1
+DA:190,1
+DA:191,1
+DA:192,1
+DA:193,1
+DA:194,1
+DA:195,1
+DA:196,1
+DA:197,1
+DA:198,1
+DA:199,1
+DA:200,1
+DA:201,5
+DA:202,5
+DA:203,5
+DA:204,1
+DA:205,1
+DA:206,4
+DA:207,4
+DA:208,4
+DA:209,4
+DA:210,4
+DA:211,1
+DA:212,1
+DA:213,3
+DA:214,1
+DA:215,1
+DA:216,2
+DA:217,2
+DA:218,2
+DA:219,2
+DA:220,4
+DA:221,0
+DA:222,0
+DA:223,2
+DA:224,2
+DA:225,2
+DA:226,2
+DA:227,2
+DA:228,2
+DA:229,2
+DA:230,2
+DA:231,2
+DA:232,2
+DA:233,2
+DA:234,2
+DA:235,2
+DA:236,2
+DA:237,2
+DA:238,2
+DA:239,2
+DA:240,2
+DA:241,2
+DA:242,4
+DA:243,1
+DA:244,1
+DA:245,1
+DA:246,1
+DA:247,1
+DA:248,1
+DA:249,2
+DA:250,2
+DA:251,2
+DA:252,1
+DA:253,1
+DA:254,27
+DA:255,27
+DA:256,27
+DA:257,27
+DA:258,27
+DA:259,27
+DA:260,27
+DA:261,27
+DA:262,27
+DA:263,27
+DA:264,27
+DA:265,27
+DA:266,27
+DA:267,27
+DA:268,27
+DA:269,27
+DA:270,1
+LF:270
+LH:262
+BRDA:53,0,0,27
+BRDA:67,1,0,20
+BRDA:69,2,0,2
+BRDA:72,3,0,18
+BRDA:73,4,0,21
+BRDA:75,5,0,2
+BRDA:79,6,0,17
+BRDA:79,7,0,16
+BRDA:80,8,0,18
+BRDA:82,9,0,2
+BRDA:85,10,0,0
+BRDA:90,11,0,14
+BRDA:127,12,0,10
+BRDA:128,13,0,12
+BRDA:131,14,0,10
+BRDA:145,15,0,4
+BRDA:92,16,0,16
+BRDA:160,17,0,13
+BRDA:166,18,0,0
+BRDA:173,19,0,2
+BRDA:176,20,0,1
+BRDA:182,21,0,0
+BRDA:200,22,0,5
+BRDA:203,23,0,1
+BRDA:206,24,0,4
+BRDA:210,25,0,1
+BRDA:213,26,0,3
+BRDA:213,27,0,1
+BRDA:216,28,0,2
+BRDA:218,29,0,2
+BRDA:220,30,0,0
+BRDA:223,31,0,2
+BRDA:242,32,0,1
+BRDA:249,33,0,2
+BRDA:209,34,0,4
+BRDA:235,35,0,2
+BRDA:236,36,0,2
+BRDA:240,37,0,2
+BRDA:253,38,0,27
+BRDA:257,39,0,0
+BRDA:264,40,0,0
+BRF:41
+BRH:35
+end_of_record
+TN:
+SF:repository_before/services/PaymentService.ts
+FN:16,PaymentService
+FN:22,charge
+FN:46,findPaymentByOrderId
+FN:54,refund
+FN:61,verifyWebhookSignature
+FNF:5
+FNH:5
+FNDA:33,PaymentService
+FNDA:14,charge
+FNDA:3,findPaymentByOrderId
+FNDA:2,refund
+FNDA:6,verifyWebhookSignature
+DA:1,1
+DA:2,1
+DA:3,1
+DA:4,1
+DA:5,1
+DA:6,1
+DA:7,1
+DA:8,1
+DA:9,1
+DA:10,1
+DA:11,1
+DA:12,1
+DA:13,1
+DA:14,1
+DA:15,1
+DA:16,1
+DA:17,33
+DA:18,33
+DA:19,33
+DA:20,33
+DA:21,1
+DA:22,1
+DA:23,14
+DA:24,14
+DA:25,14
+DA:26,14
+DA:27,14
+DA:28,14
+DA:29,14
+DA:30,14
+DA:31,14
+DA:32,14
+DA:33,14
+DA:34,14
+DA:35,14
+DA:36,14
+DA:37,14
+DA:38,14
+DA:39,14
+DA:40,4
+DA:41,4
+DA:42,10
+DA:43,10
+DA:44,10
+DA:45,1
+DA:46,1
+DA:47,3
+DA:48,3
+DA:49,3
+DA:50,3
+DA:51,3
+DA:52,3
+DA:53,1
+DA:54,1
+DA:55,2
+DA:56,2
+DA:57,2
+DA:58,2
+DA:59,2
+DA:60,1
+DA:61,1
+DA:62,6
+DA:63,6
+DA:64,6
+DA:65,6
+DA:66,6
+DA:67,6
+DA:68,1
+LF:68
+LH:68
+BRDA:16,0,0,33
+BRDA:22,1,0,14
+BRDA:39,2,0,4
+BRDA:42,3,0,10
+BRDA:46,4,0,3
+BRDA:51,5,0,2
+BRDA:51,6,0,1
+BRDA:54,7,0,2
+BRDA:61,8,0,6
+BRF:9
+BRH:9
+end_of_record
+TN:
+SF:repository_before/services/ShippingService.ts
+FN:19,calculateShippingCost
+FN:29,getShippingZone
+FN:47,estimateDeliveryDays
+FN:64,validateAddress
+FNF:4
+FNH:4
+FNDA:18,calculateShippingCost
+FNDA:22,getShippingZone
+FNDA:4,estimateDeliveryDays
+FNDA:7,validateAddress
+DA:1,1
+DA:2,1
+DA:3,1
+DA:4,1
+DA:5,1
+DA:6,1
+DA:7,1
+DA:8,1
+DA:9,1
+DA:10,1
+DA:11,1
+DA:12,1
+DA:13,1
+DA:14,1
+DA:15,1
+DA:16,1
+DA:17,1
+DA:18,1
+DA:19,1
+DA:20,18
+DA:21,18
+DA:22,18
+DA:23,18
+DA:24,18
+DA:25,18
+DA:26,18
+DA:27,18
+DA:28,1
+DA:29,1
+DA:30,22
+DA:31,2
+DA:32,2
+DA:33,20
+DA:34,20
+DA:35,20
+DA:36,22
+DA:37,16
+DA:38,16
+DA:39,4
+DA:40,8
+DA:41,2
+DA:42,2
+DA:43,2
+DA:44,2
+DA:45,2
+DA:46,1
+DA:47,1
+DA:48,4
+DA:49,4
+DA:50,4
+DA:51,4
+DA:52,1
+DA:53,4
+DA:54,1
+DA:55,4
+DA:56,1
+DA:57,4
+DA:58,1
+DA:59,4
+DA:60,0
+DA:61,4
+DA:62,4
+DA:63,1
+DA:64,1
+DA:65,7
+DA:66,1
+DA:67,1
+DA:68,6
+DA:69,7
+DA:70,1
+DA:71,1
+DA:72,5
+DA:73,7
+DA:74,1
+DA:75,1
+DA:76,4
+DA:77,7
+DA:78,1
+DA:79,1
+DA:80,3
+DA:81,7
+DA:82,1
+DA:83,1
+DA:84,2
+DA:85,7
+DA:86,1
+DA:87,1
+DA:88,1
+DA:89,1
+DA:90,1
+DA:91,1
+LF:91
+LH:90
+BRDA:19,0,0,18
+BRDA:23,1,0,20
+BRDA:29,2,0,22
+BRDA:30,3,0,2
+BRDA:33,4,0,20
+BRDA:36,5,0,16
+BRDA:39,6,0,8
+BRDA:39,7,0,4
+BRDA:40,8,0,2
+BRDA:47,9,0,4
+BRDA:51,10,0,1
+BRDA:53,11,0,1
+BRDA:55,12,0,1
+BRDA:57,13,0,1
+BRDA:59,14,0,0
+BRDA:64,15,0,7
+BRDA:65,16,0,6
+BRDA:65,17,0,1
+BRDA:68,18,0,6
+BRDA:69,19,0,5
+BRDA:69,20,0,1
+BRDA:72,21,0,5
+BRDA:73,22,0,4
+BRDA:73,23,0,1
+BRDA:76,24,0,4
+BRDA:77,25,0,3
+BRDA:77,26,0,1
+BRDA:80,27,0,3
+BRDA:81,28,0,2
+BRDA:81,29,0,1
+BRDA:84,30,0,2
+BRDA:85,31,0,1
+BRF:32
+BRH:31
+end_of_record
diff --git a/repository_after/inventory.lifecycle.int.test.ts b/repository_after/inventory.lifecycle.int.test.ts
new file mode 100644
index 0000000..95e77f1
--- /dev/null
+++ b/repository_after/inventory.lifecycle.int.test.ts
@@ -0,0 +1,200 @@
+import {
+  createIntegrationHarness,
+  type IntegrationHarness,
+  type TestContext,
+} from "./testUtils/harness";
+import {
+  getInventoryQty,
+  getReservation,
+  orderItems,
+  seedInventory,
+  US_WEST_ADDRESS,
+} from "./testUtils/fixtures";
+
+describe("Inventory lifecycle", () => {
+  let harness!: IntegrationHarness;
+  let ctx!: TestContext;
+
+  beforeAll(async () => {
+    harness = await createIntegrationHarness();
+  });
+
+  afterAll(async () => {
+    if (harness) await harness.close();
+  });
+
+  beforeEach(async () => {
+    ctx = await harness.createContext();
+  });
+
+  afterEach(async () => {
+    if (ctx) await ctx.cleanup();
+    jest.useRealTimers();
+  });
+
+  test("inventory reserved during in-flight payment, then confirmed and reservation cleared", async () => {
+    await seedInventory(ctx.txPool, [{ productId: "p3", quantity: 2 }]);
+
+    // NOTE: Do not use Jest fake timers here: ioredis relies on real timers.
+    // Instead, simulate an in-flight Stripe call with a manual deferred promise.
+    const chargeDeferred = (() => {
+      let resolve!: (v: any) => void;
+      const promise = new Promise<any>((r) => {
+        resolve = r;
+      });
+      return { promise, resolve };
+    })();
+
+    const stripeState = (global as any).__stripeMockState;
+    stripeState.paymentIntents.create.mockImplementationOnce(
+      () => chargeDeferred.promise
+    );
+
+    const req = ctx.http.post("/orders").send({
+      userId: "u_inflight",
+      items: orderItems([{ productId: "p3", quantity: 1, pricePerUnit: 1 }]),
+      shippingAddress: US_WEST_ADDRESS,
+      idempotencyKey: "idem_inflight_1",
+    });
+
+    const pending = new Promise<any>((resolve, reject) => {
+      req.end((err, res) => (err ? reject(err) : resolve(res)));
+    });
+
+    // Wait until reservation is visible (Redis is real), without sleeps.
+    let reserved = 0;
+    for (let i = 0; i < 200; i += 1) {
+      reserved = await getReservation(ctx.redis, "p3");
+      if (reserved === 1) break;
+      // Allow pending IO/microtasks to flush without adding time.
+      await new Promise((r) => setImmediate(r));
+    }
+    expect(reserved).toBe(1);
+    expect(await getInventoryQty(ctx.txPool, "p3")).toBe(2);
+
+    chargeDeferred.resolve({
+      id: "pi_delayed",
+      object: "payment_intent",
+      status: "succeeded",
+      amount: 0,
+      currency: "usd",
+      metadata: {},
+      created: Math.floor(Date.now() / 1000),
+    });
+
+    const res = await pending;
+
+    expect(res.status).toBe(201);
+    expect(await getInventoryQty(ctx.txPool, "p3")).toBe(1);
+    expect(await getReservation(ctx.redis, "p3")).toBe(0);
+  });
+
+  test("inventory released on payment failure", async () => {
+    await seedInventory(ctx.txPool, [{ productId: "p4", quantity: 2 }]);
+
+    const stripeState = (global as any).__stripeMockState;
+    stripeState.paymentIntents.create.mockImplementationOnce(async () => ({
+      id: "pi_fail",
+      object: "payment_intent",
+      status: "requires_payment_method",
+      amount: 0,
+      currency: "usd",
+      metadata: {},
+      created: Math.floor(Date.now() / 1000),
+    }));
+
+    const res = await ctx.http.post("/orders").send({
+      userId: "u_fail",
+      items: orderItems([{ productId: "p4", quantity: 2, pricePerUnit: 2 }]),
+      shippingAddress: US_WEST_ADDRESS,
+      idempotencyKey: "idem_fail_1",
+    });
+
+    expect(res.status).toBe(402);
+    expect(await getInventoryQty(ctx.txPool, "p4")).toBe(2);
+    expect(await getReservation(ctx.redis, "p4")).toBe(0);
+  });
+
+  test("inventory released on order cancellation", async () => {
+    await seedInventory(ctx.txPool, [{ productId: "p5", quantity: 5 }]);
+
+    const res = await ctx.http.post("/orders").send({
+      userId: "u_cancel",
+      items: orderItems([{ productId: "p5", quantity: 3, pricePerUnit: 1 }]),
+      shippingAddress: US_WEST_ADDRESS,
+      idempotencyKey: "idem_cancel_1",
+    });
+    expect(res.status).toBe(201);
+
+    expect(await getInventoryQty(ctx.txPool, "p5")).toBe(2);
+
+    // cancel triggers refund + release
+    const cancel = await ctx.http
+      .post(`/orders/${res.body.id}/cancel`)
+      .send({});
+    expect(cancel.status).toBe(200);
+    expect(cancel.body.status).toBe("cancelled");
+
+    expect(await getInventoryQty(ctx.txPool, "p5")).toBe(5);
+  });
+
+  test("reservation TTL is set to ~15 minutes (900s) and can be inspected via redis.ttl()", async () => {
+    await seedInventory(ctx.txPool, [{ productId: "p_ttl", quantity: 2 }]);
+
+    const ok = await ctx.inventoryService.reserve("p_ttl", 1);
+    expect(ok).toBe(true);
+
+    const ttl = await ctx.redis.ttl("reservation:p_ttl");
+    expect(ttl).toBeGreaterThanOrEqual(880);
+    expect(ttl).toBeLessThanOrEqual(900);
+
+    // Note: Jest fake timers do not advance Redis TTL (server-side).
+  });
+
+  test("reservation key with short TTL expires (real wait; Redis TTL is server-side)", async () => {
+    jest.useRealTimers();
+    await ctx.redis.setex("reservation:p_short_ttl", 2, "1");
+    expect(await getReservation(ctx.redis, "p_short_ttl")).toBe(1);
+
+    await new Promise((r) => setTimeout(r, 2200));
+
+    expect(await getReservation(ctx.redis, "p_short_ttl")).toBe(0);
+    const ttl = await ctx.redis.ttl("reservation:p_short_ttl");
+    expect(ttl).toBeLessThanOrEqual(0);
+  });
+
+  test("concurrent reservation requests are serialized with redis lock", async () => {
+    await seedInventory(ctx.txPool, [{ productId: "p_lock", quantity: 1 }]);
+
+    const r1 = ctx.inventoryService.reserve("p_lock", 1);
+    const r2 = ctx.inventoryService.reserve("p_lock", 1);
+
+    const results = await Promise.all([r1, r2]);
+    const trueCount = results.filter(Boolean).length;
+    expect(trueCount).toBe(1);
+
+    expect(await getReservation(ctx.redis, "p_lock")).toBe(1);
+  });
+
+  test("partial reservation release for multi-item order when one item cannot be reserved", async () => {
+    await seedInventory(ctx.txPool, [
+      { productId: "p_ok", quantity: 1 },
+      { productId: "p_no", quantity: 0 },
+    ]);
+
+    const res = await ctx.http.post("/orders").send({
+      userId: "u_partial_release",
+      items: orderItems([
+        { productId: "p_ok", quantity: 1, pricePerUnit: 1 },
+        { productId: "p_no", quantity: 1, pricePerUnit: 1 },
+      ]),
+      shippingAddress: US_WEST_ADDRESS,
+      idempotencyKey: "idem_partial_release_1",
+    });
+
+    expect(res.status).toBe(409);
+    expect(await getReservation(ctx.redis, "p_ok")).toBe(0);
+    expect(await getReservation(ctx.redis, "p_no")).toBe(0);
+    expect(await getInventoryQty(ctx.txPool, "p_ok")).toBe(1);
+  });
+});
diff --git a/repository_after/jest.config.ts b/repository_after/jest.config.ts
new file mode 100644
index 0000000..bfb24d9
--- /dev/null
+++ b/repository_after/jest.config.ts
@@ -0,0 +1,31 @@
+import type { Config } from "jest";
+
+const config: Config = {
+  rootDir: "..",
+  preset: "ts-jest",
+  testEnvironment: "node",
+  testMatch: ["<rootDir>/repository_after/**/*.test.ts"],
+  setupFilesAfterEnv: ["<rootDir>/repository_after/testUtils/jest.preload.ts"],
+  clearMocks: true,
+  restoreMocks: true,
+  resetMocks: false,
+  moduleNameMapper: {
+    "^@sut/(.*)$": "<rootDir>/repository_before/services/$1",
+  },
+  testTimeout: 15000,
+  collectCoverage: true,
+  coverageProvider: "v8",
+  coverageReporters: ["json-summary", "json", "lcov", "text", "clover"],
+  collectCoverageFrom: ["<rootDir>/repository_before/services/**/*.ts"],
+  coverageDirectory: "<rootDir>/repository_after/coverage",
+  coverageThreshold: {
+    global: {
+      statements: 85,
+      branches: 85,
+      functions: 85,
+      lines: 85,
+    },
+  },
+};
+
+export default config;
diff --git a/repository_after/order.creation.int.test.ts b/repository_after/order.creation.int.test.ts
new file mode 100644
index 0000000..5b0b999
--- /dev/null
+++ b/repository_after/order.creation.int.test.ts
@@ -0,0 +1,238 @@
+import {
+  createIntegrationHarness,
+  type IntegrationHarness,
+  type TestContext,
+} from "./testUtils/harness";
+import {
+  getIdempotency,
+  getInventoryQty,
+  getOrderRow,
+  getReservation,
+  orderItems,
+  seedInventory,
+  US_WEST_ADDRESS,
+} from "./testUtils/fixtures";
+
+describe("Order creation flow", () => {
+  let harness!: IntegrationHarness;
+  let ctx!: TestContext;
+
+  beforeAll(async () => {
+    harness = await createIntegrationHarness();
+  });
+
+  afterAll(async () => {
+    if (harness) await harness.close();
+  });
+
+  beforeEach(async () => {
+    ctx = await harness.createContext();
+  });
+
+  afterEach(async () => {
+    if (ctx) await ctx.cleanup();
+  });
+
+  test("successful order with valid items and payment", async () => {
+    await seedInventory(ctx.txPool, [{ productId: "p1", quantity: 10 }]);
+
+    const idempotencyKey = "idem_success_1";
+    const items = orderItems([
+      { productId: "p1", quantity: 2, pricePerUnit: 12.5 },
+    ]);
+
+    const res = await ctx.http.post("/orders").send({
+      userId: "u1",
+      items,
+      shippingAddress: US_WEST_ADDRESS,
+      idempotencyKey,
+    });
+
+    expect(res.status).toBe(201);
+    expect(res.body.status).toBe("paid");
+    expect(res.body.total).toBeGreaterThan(0);
+
+    const row = await getOrderRow(ctx.txPool, res.body.id);
+    expect(row).not.toBeNull();
+    expect(row.status).toBe("paid");
+
+    // Inventory permanently decreased after payment confirmation
+    expect(await getInventoryQty(ctx.txPool, "p1")).toBe(8);
+    // Reservation cleared
+    expect(await getReservation(ctx.redis, "p1")).toBe(0);
+
+    // Idempotency stored
+    expect(await getIdempotency(ctx.redis, idempotencyKey)).toBe(res.body.id);
+
+    // Stripe mock called with correct cents
+    const stripeState = (global as any).__stripeMockState;
+    expect(stripeState.paymentIntents.create).toHaveBeenCalledTimes(1);
+    const args = stripeState.paymentIntents.create.mock.calls[0][0];
+    expect(args.amount).toBe(Math.round(res.body.total * 100));
+    expect(args.metadata.orderId).toBe(res.body.id);
+    expect(args.metadata.customerId).toBe("u1");
+  });
+
+  test("order fails when item out of stock", async () => {
+    await seedInventory(ctx.txPool, [{ productId: "p_out", quantity: 1 }]);
+
+    const res = await ctx.http.post("/orders").send({
+      userId: "u2",
+      items: orderItems([
+        { productId: "p_out", quantity: 2, pricePerUnit: 10 },
+      ]),
+      shippingAddress: US_WEST_ADDRESS,
+      idempotencyKey: "idem_oos_1",
+    });
+
+    expect(res.status).toBe(409);
+    expect(res.body.error).toContain("Insufficient inventory");
+
+    // No reservation should be left behind
+    expect(await getReservation(ctx.redis, "p_out")).toBe(0);
+    // Inventory unchanged
+    expect(await getInventoryQty(ctx.txPool, "p_out")).toBe(1);
+
+    const stripeState = (global as any).__stripeMockState;
+    expect(stripeState.paymentIntents.create).not.toHaveBeenCalled();
+  });
+
+  test("order fails when payment declined and inventory is released", async () => {
+    await seedInventory(ctx.txPool, [{ productId: "p2", quantity: 3 }]);
+
+    const stripeState = (global as any).__stripeMockState;
+    stripeState.paymentIntents.create.mockImplementationOnce(async () => ({
+      id: "pi_declined",
+      object: "payment_intent",
+      status: "requires_payment_method",
+      amount: 0,
+      currency: "usd",
+      metadata: {},
+      created: Math.floor(Date.now() / 1000),
+    }));
+
+    const res = await ctx.http.post("/orders").send({
+      userId: "u3",
+      items: orderItems([{ productId: "p2", quantity: 2, pricePerUnit: 9.99 }]),
+      shippingAddress: US_WEST_ADDRESS,
+      idempotencyKey: "idem_decline_1",
+    });
+
+    expect(res.status).toBe(402);
+
+    // The order exists in DB and ends in payment_failed
+    const orders = await ctx.txPool.query(
+      "SELECT * FROM orders WHERE user_id = $1",
+      ["u3"]
+    );
+    expect(orders.rows.length).toBe(1);
+    expect(orders.rows[0].status).toBe("payment_failed");
+
+    // Inventory restored (confirmReservation not called)
+    expect(await getInventoryQty(ctx.txPool, "p2")).toBe(3);
+    expect(await getReservation(ctx.redis, "p2")).toBe(0);
+  });
+
+  test("concurrent orders for limited inventory: only one succeeds", async () => {
+    await seedInventory(ctx.txPool, [{ productId: "p_last", quantity: 1 }]);
+
+    const makeReq = (k: string) =>
+      ctx.http.post("/orders").send({
+        userId: `u_conc_${k}`,
+        items: orderItems([
+          { productId: "p_last", quantity: 1, pricePerUnit: 5 },
+        ]),
+        shippingAddress: US_WEST_ADDRESS,
+        idempotencyKey: `idem_conc_${k}`,
+      });
+
+    const results = await Promise.allSettled([
+      makeReq("a"),
+      makeReq("b"),
+      makeReq("c"),
+    ]);
+
+    const fulfilled = results.filter(
+      (r) => r.status === "fulfilled"
+    ) as PromiseFulfilledResult<any>[];
+    expect(fulfilled).toHaveLength(3);
+
+    const responses = fulfilled.map((r) => r.value);
+    const statuses = responses.map((r) => r.status);
+    const ok = responses.filter((r) => r.status === 201);
+    const fail = responses.filter((r) => r.status !== 201);
+
+    expect(ok).toHaveLength(1);
+    expect(fail).toHaveLength(2);
+
+    // Req 5: failures must be inventory errors, not random status codes.
+    for (const r of fail) {
+      expect(r.status).toBe(409);
+      expect(r.body?.error ?? "").toContain("Insufficient inventory");
+    }
+
+    const inv = await getInventoryQty(ctx.txPool, "p_last");
+    expect(inv).toBe(0);
+
+    // Exactly one paid order, others should be inventory errors or payment errors depending on race
+    const paidCount = (
+      await ctx.txPool.query(
+        "SELECT COUNT(*)::int AS c FROM orders WHERE status = 'paid'"
+      )
+    ).rows[0].c;
+    expect(paidCount).toBe(1);
+
+    // Reservation key should be cleared after successful confirmation
+    expect(await getReservation(ctx.redis, "p_last")).toBe(0);
+  });
+
+  test("order with multiple items from different warehouses (modeled as distinct product IDs)", async () => {
+    await seedInventory(ctx.txPool, [
+      { productId: "wh1:pA", quantity: 3 },
+      { productId: "wh2:pB", quantity: 2 },
+    ]);
+
+    const res = await ctx.http.post("/orders").send({
+      userId: "u_wh_multi",
+      items: orderItems([
+        { productId: "wh1:pA", quantity: 1, pricePerUnit: 3.0 },
+        { productId: "wh2:pB", quantity: 2, pricePerUnit: 2.5 },
+      ]),
+      shippingAddress: US_WEST_ADDRESS,
+      idempotencyKey: "idem_wh_multi_1",
+    });
+
+    expect(res.status).toBe(201);
+    expect(res.body.status).toBe("paid");
+
+    expect(await getInventoryQty(ctx.txPool, "wh1:pA")).toBe(2);
+    expect(await getInventoryQty(ctx.txPool, "wh2:pB")).toBe(0);
+    expect(await getReservation(ctx.redis, "wh1:pA")).toBe(0);
+    expect(await getReservation(ctx.redis, "wh2:pB")).toBe(0);
+  });
+
+  test("order with multiple items reserves/consumes inventory for each product", async () => {
+    await seedInventory(ctx.txPool, [
+      { productId: "pA", quantity: 5 },
+      { productId: "pB", quantity: 4 },
+    ]);
+
+    const res = await ctx.http.post("/orders").send({
+      userId: "u_multi",
+      items: orderItems([
+        { productId: "pA", quantity: 2, pricePerUnit: 3.0 },
+        { productId: "pB", quantity: 1, pricePerUnit: 7.5 },
+      ]),
+      shippingAddress: US_WEST_ADDRESS,
+      idempotencyKey: "idem_multi_1",
+    });
+
+    expect(res.status).toBe(201);
+    expect(res.body.status).toBe("paid");
+
+    expect(await getInventoryQty(ctx.txPool, "pA")).toBe(3);
+    expect(await getInventoryQty(ctx.txPool, "pB")).toBe(3);
+    expect(await getReservation(ctx.redis, "pA")).toBe(0);
+    expect(await getReservation(ctx.redis, "pB")).toBe(0);
+  });
+});
diff --git a/repository_before/package.json b/repository_before/package.json
deleted file mode 100644
index 6879b39..0000000
--- a/repository_before/package.json
+++ /dev/null
@@ -1,28 +0,0 @@
-{
-  "name": "order-processing-service",
-  "version": "1.0.0",
-  "description": "E-commerce order processing service with inventory management and Stripe payments",
-  "main": "dist/index.js",
-  "scripts": {
-    "build": "tsc",
-    "test": "jest --coverage",
-    "test:watch": "jest --watch",
-    "test:integration": "jest --config jest.config.js --runInBand"
-  },
-  "dependencies": {
-    "ioredis": "^5.3.2",
-    "pg": "^8.11.3",
-    "stripe": "^14.10.0"
-  },
-  "devDependencies": {
-    "@types/jest": "^29.5.11",
-    "@types/node": "^20.10.6",
-    "@types/pg": "^8.10.9",
-    "jest": "^29.7.0",
-    "ts-jest": "^29.1.1",
-    "typescript": "^5.3.3"
-  },
-  "engines": {
-    "node": ">=18.0.0"
-  }
-}
diff --git a/repository_after/payment.refund.int.test.ts b/repository_after/payment.refund.int.test.ts
new file mode 100644
index 0000000..4248d69
--- /dev/null
+++ b/repository_after/payment.refund.int.test.ts
@@ -0,0 +1,342 @@
+import {
+  createIntegrationHarness,
+  type IntegrationHarness,
+  type TestContext,
+} from "./testUtils/harness";
+import {
+  getInventoryQty,
+  orderItems,
+  seedInventory,
+  US_WEST_ADDRESS,
+} from "./testUtils/fixtures";
+
+describe("Payment + refund behaviors", () => {
+  let harness!: IntegrationHarness;
+  let ctx!: TestContext;
+
+  beforeAll(async () => {
+    harness = await createIntegrationHarness();
+  });
+
+  afterAll(async () => {
+    if (harness) await harness.close();
+  });
+
+  beforeEach(async () => {
+    ctx = await harness.createContext();
+  });
+
+  afterEach(async () => {
+    if (ctx) await ctx.cleanup();
+    jest.useRealTimers();
+  });
+
+  test("payment timeout releases inventory (simulated delayed non-success status)", async () => {
+    await seedInventory(ctx.txPool, [{ productId: "p_timeout", quantity: 1 }]);
+
+    // NOTE: Do not use Jest fake timers here: ioredis relies on real timers.
+    // Simulate a delayed Stripe response with a manual deferred promise instead.
+    const chargeDeferred = (() => {
+      let resolve!: (v: any) => void;
+      const promise = new Promise<any>((r) => {
+        resolve = r;
+      });
+      return { promise, resolve };
+    })();
+
+    const stripeState = (global as any).__stripeMockState;
+    stripeState.paymentIntents.create.mockImplementationOnce(
+      () => chargeDeferred.promise
+    );
+
+    const req = ctx.http.post("/orders").send({
+      userId: "u_timeout",
+      items: orderItems([
+        { productId: "p_timeout", quantity: 1, pricePerUnit: 1 },
+      ]),
+      shippingAddress: US_WEST_ADDRESS,
+      idempotencyKey: "idem_timeout_1",
+    });
+
+    const pending = new Promise<any>((resolve, reject) => {
+      req.end((err, res) => (err ? reject(err) : resolve(res)));
+    });
+
+    // Release the deferred Stripe response now (non-success status -> payment failure).
+    chargeDeferred.resolve({
+      id: "pi_timeout",
+      object: "payment_intent",
+      status: "processing",
+      amount: 0,
+      currency: "usd",
+      metadata: {},
+      created: Math.floor(Date.now() / 1000),
+    });
+
+    const res = await pending;
+
+    expect(res.status).toBe(402);
+    expect(await getInventoryQty(ctx.txPool, "p_timeout")).toBe(1);
+  });
+
+  test("idempotency key prevents duplicate charges on retry (successful order)", async () => {
+    await seedInventory(ctx.txPool, [{ productId: "p_idem", quantity: 2 }]);
+    const stripeState = (global as any).__stripeMockState;
+
+    const payload = {
+      userId: "u_idem",
+      items: orderItems([
+        { productId: "p_idem", quantity: 1, pricePerUnit: 2 },
+      ]),
+      shippingAddress: US_WEST_ADDRESS,
+      idempotencyKey: "idem_retry_1",
+    };
+
+    const r1 = await ctx.http.post("/orders").send(payload);
+    expect(r1.status).toBe(201);
+
+    const r2 = await ctx.http.post("/orders").send(payload);
+    expect(r2.status).toBe(201);
+    expect(r2.body.id).toBe(r1.body.id);
+
+    expect(stripeState.paymentIntents.create).toHaveBeenCalledTimes(1);
+  });
+
+  test("failed orders are not cached and retry re-attempts payment (current behavior)", async () => {
+    await seedInventory(ctx.txPool, [
+      { productId: "p_fail_idem", quantity: 1 },
+    ]);
+    const stripeState = (global as any).__stripeMockState;
+
+    stripeState.paymentIntents.create.mockImplementation(async () => ({
+      id: "pi_fail_idem",
+      object: "payment_intent",
+      status: "requires_payment_method",
+      amount: 0,
+      currency: "usd",
+      metadata: {},
+      created: Math.floor(Date.now() / 1000),
+    }));
+
+    const payload = {
+      userId: "u_fail_idem",
+      items: orderItems([
+        { productId: "p_fail_idem", quantity: 1, pricePerUnit: 2 },
+      ]),
+      shippingAddress: US_WEST_ADDRESS,
+      idempotencyKey: "idem_failed_retry_1",
+    };
+
+    const r1 = await ctx.http.post("/orders").send(payload);
+    expect(r1.status).toBe(402);
+
+    const orderRow = await ctx.txPool.query(
+      "SELECT id, status FROM orders WHERE user_id = $1",
+      ["u_fail_idem"]
+    );
+    expect(orderRow.rows).toHaveLength(1);
+    const orderId = orderRow.rows[0].id as string;
+    expect(orderRow.rows[0].status).toBe("payment_failed");
+
+    // Req 8: failed orders must be cached by idempotency, so retry returns same order.
+    const cached = await ctx.redis.get("idempotency:idem_failed_retry_1");
+    expect(cached).toBe(orderId);
+
+    const r2 = await ctx.http.post("/orders").send(payload);
+    expect(r2.status).toBe(402);
+    expect(r2.body.id).toBe(orderId);
+    expect(r2.body.status).toBe("payment_failed");
+
+    // No duplicate charge attempt on retry.
+    expect(stripeState.paymentIntents.create).toHaveBeenCalledTimes(1);
+  });
+
+  test("fake timers can control local time-dependent promises", async () => {
+    jest.useFakeTimers();
+    const delayed = new Promise<string>((resolve) => {
+      setTimeout(() => resolve("done"), 100);
+    });
+
+    await jest.advanceTimersByTimeAsync(100);
+    await expect(delayed).resolves.toBe("done");
+  });
+
+  test("full refund restores complete inventory and sets order status to refunded", async () => {
+    await seedInventory(ctx.txPool, [{ productId: "p_ref", quantity: 5 }]);
+
+    const orderRes = await ctx.http.post("/orders").send({
+      userId: "u_ref_full",
+      items: orderItems([
+        { productId: "p_ref", quantity: 2, pricePerUnit: 10 },
+      ]),
+      shippingAddress: US_WEST_ADDRESS,
+      idempotencyKey: "idem_ref_full_1",
+    });
+    expect(orderRes.status).toBe(201);
+
+    const stripeState = (global as any).__stripeMockState;
+    stripeState.paymentIntents.search.mockImplementationOnce(async () => ({
+      object: "search_result",
+      data: [
+        {
+          id: "pi_for_refund",
+          object: "payment_intent",
+          status: "succeeded",
+          amount: Math.round(orderRes.body.total * 100),
+          currency: "usd",
+          metadata: { orderId: orderRes.body.id },
+          created: Math.floor(Date.now() / 1000),
+        },
+      ],
+      has_more: false,
+      url: "/v1/payment_intents/search",
+    }));
+
+    const refundRes = await ctx.http
+      .post(`/orders/${orderRes.body.id}/refund`)
+      .send({
+        items: [{ productId: "p_ref", quantity: 2 }],
+      });
+
+    expect(refundRes.status).toBe(200);
+    expect(refundRes.body.status).toBe("refunded");
+
+    expect(await getInventoryQty(ctx.txPool, "p_ref")).toBe(5);
+
+    // Refund record and amount
+    const rr = await ctx.txPool.query(
+      "SELECT * FROM refunds WHERE order_id = $1",
+      [orderRes.body.id]
+    );
+    expect(rr.rows).toHaveLength(1);
+    expect(parseFloat(rr.rows[0].amount)).toBe(20);
+
+    expect(stripeState.refunds.create).toHaveBeenCalledWith({
+      payment_intent: "pi_for_refund",
+      amount: 2000,
+    });
+  });
+
+  test("partial refund restores only refunded quantities and keeps order status paid", async () => {
+    await seedInventory(ctx.txPool, [
+      { productId: "p_ref_part", quantity: 10 },
+    ]);
+
+    const orderRes = await ctx.http.post("/orders").send({
+      userId: "u_ref_part",
+      items: orderItems([
+        { productId: "p_ref_part", quantity: 4, pricePerUnit: 5 },
+      ]),
+      shippingAddress: US_WEST_ADDRESS,
+      idempotencyKey: "idem_ref_part_1",
+    });
+    expect(orderRes.status).toBe(201);
+
+    const stripeState = (global as any).__stripeMockState;
+    stripeState.paymentIntents.search.mockImplementationOnce(async () => ({
+      object: "search_result",
+      data: [
+        {
+          id: "pi_for_partial_refund",
+          object: "payment_intent",
+          status: "succeeded",
+          amount: Math.round(orderRes.body.total * 100),
+          currency: "usd",
+          metadata: { orderId: orderRes.body.id },
+          created: Math.floor(Date.now() / 1000),
+        },
+      ],
+      has_more: false,
+      url: "/v1/payment_intents/search",
+    }));
+
+    const refundRes = await ctx.http
+      .post(`/orders/${orderRes.body.id}/refund`)
+      .send({
+        items: [{ productId: "p_ref_part", quantity: 1 }],
+      });
+
+    expect(refundRes.status).toBe(200);
+    expect(refundRes.body.status).toBe("paid");
+
+    // Inventory: started 10, order consumed 4 => 6, refund 1 => 7
+    expect(await getInventoryQty(ctx.txPool, "p_ref_part")).toBe(7);
+
+    const orderRow = await ctx.txPool.query(
+      "SELECT status FROM orders WHERE id = $1",
+      [orderRes.body.id]
+    );
+    expect(orderRow.rows[0].status).toBe("paid");
+
+    const rr = await ctx.txPool.query(
+      "SELECT * FROM refunds WHERE order_id = $1",
+      [orderRes.body.id]
+    );
+    expect(rr.rows).toHaveLength(1);
+    expect(parseFloat(rr.rows[0].amount)).toBe(5);
+  });
+
+  test("reject refunds for unpaid orders and refunds exceeding ordered quantity", async () => {
+    await seedInventory(ctx.txPool, [{ productId: "p_unpaid", quantity: 1 }]);
+
+    // Create an unpaid order row directly.
+    const ins = await ctx.txPool.query(
+      `INSERT INTO orders (user_id, items, subtotal, shipping_cost, total, status, shipping_address)
+         VALUES ($1, $2, $3, $4, $5, 'pending', $6) RETURNING id`,
+      [
+        "u_unpaid",
+        JSON.stringify([
+          { productId: "p_unpaid", quantity: 1, pricePerUnit: 3 },
+        ]),
+        3,
+        1,
+        4,
+        JSON.stringify(US_WEST_ADDRESS),
+      ]
+    );
+
+    const orderId = ins.rows[0].id;
+
+    const r1 = await ctx.http.post(`/orders/${orderId}/refund`).send({
+      items: [{ productId: "p_unpaid", quantity: 1 }],
+    });
+    expect(r1.status).toBe(400);
+    expect(r1.body.error).toContain("refunded");
+
+    // Paid order for exceed test
+    await seedInventory(ctx.txPool, [{ productId: "p_exceed", quantity: 3 }]);
+    const orderRes = await ctx.http.post("/orders").send({
+      userId: "u_exceed",
+      items: orderItems([
+        { productId: "p_exceed", quantity: 1, pricePerUnit: 10 },
+      ]),
+      shippingAddress: US_WEST_ADDRESS,
+      idempotencyKey: "idem_exceed_1",
+    });
+    expect(orderRes.status).toBe(201);
+
+    const stripeState = (global as any).__stripeMockState;
+    stripeState.paymentIntents.search.mockImplementationOnce(async () => ({
+      object: "search_result",
+      data: [
+        {
+          id: "pi_exceed",
+          object: "payment_intent",
+          status: "succeeded",
+          amount: Math.round(orderRes.body.total * 100),
+          currency: "usd",
+          metadata: { orderId: orderRes.body.id },
+          created: Math.floor(Date.now() / 1000),
+        },
+      ],
+      has_more: false,
+      url: "/v1/payment_intents/search",
+    }));
+
+    const r2 = await ctx.http.post(`/orders/${orderRes.body.id}/refund`).send({
+      items: [{ productId: "p_exceed", quantity: 2 }],
+    });
+    expect(r2.status).toBe(400);
+    expect(r2.body.error).toContain("Cannot refund more than ordered quantity");
+  });
+});
diff --git a/repository_before/schema.sql b/repository_before/schema.sql
deleted file mode 100644
index beed995..0000000
--- a/repository_before/schema.sql
+++ /dev/null
@@ -1,33 +0,0 @@
-CREATE EXTENSION IF NOT EXISTS "pgcrypto";
-
-CREATE TABLE orders (
-    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
-    user_id VARCHAR(255) NOT NULL,
-    items JSONB NOT NULL,
-    subtotal DECIMAL(10, 2) NOT NULL,
-    shipping_cost DECIMAL(10, 2) NOT NULL,
-    total DECIMAL(10, 2) NOT NULL,
-    status VARCHAR(50) NOT NULL DEFAULT 'pending',
-    shipping_address JSONB NOT NULL,
-    created_at TIMESTAMP DEFAULT NOW(),
-    updated_at TIMESTAMP DEFAULT NOW()
-);
-
-CREATE TABLE inventory (
-    product_id VARCHAR(255) PRIMARY KEY,
-    quantity INTEGER NOT NULL DEFAULT 0,
-    created_at TIMESTAMP DEFAULT NOW(),
-    updated_at TIMESTAMP DEFAULT NOW()
-);
-
-CREATE TABLE refunds (
-    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
-    order_id UUID NOT NULL REFERENCES orders(id),
-    items JSONB NOT NULL,
-    amount DECIMAL(10, 2) NOT NULL,
-    created_at TIMESTAMP DEFAULT NOW()
-);
-
-CREATE INDEX idx_orders_user_id ON orders(user_id);
-CREATE INDEX idx_orders_status ON orders(status);
-CREATE INDEX idx_refunds_order_id ON refunds(order_id);
diff --git a/repository_after/service.coverage.int.test.ts b/repository_after/service.coverage.int.test.ts
new file mode 100644
index 0000000..355b718
--- /dev/null
+++ b/repository_after/service.coverage.int.test.ts
@@ -0,0 +1,146 @@
+import {
+  createIntegrationHarness,
+  type IntegrationHarness,
+  type TestContext,
+} from "./testUtils/harness";
+import { ShippingService } from "@sut/ShippingService";
+
+const US_WEST = {
+  street: "1 Main St",
+  city: "San Francisco",
+  state: "CA",
+  zipCode: "94105",
+  country: "US",
+};
+
+const US_EAST = {
+  street: "1 Main St",
+  city: "New York",
+  state: "NY",
+  zipCode: "10001",
+  country: "US",
+};
+
+const US_CENTRAL = {
+  street: "1 Main St",
+  city: "Chicago",
+  state: "IL",
+  zipCode: "60601",
+  country: "US",
+};
+
+const INTERNATIONAL = {
+  street: "1 Main St",
+  city: "Toronto",
+  state: "ON",
+  zipCode: "M5V 2T6",
+  country: "CA",
+};
+
+describe("Service coverage (fast)", () => {
+  let harness!: IntegrationHarness;
+  let ctx!: TestContext;
+
+  beforeAll(async () => {
+    harness = await createIntegrationHarness();
+  });
+
+  afterAll(async () => {
+    await harness.close();
+  });
+
+  beforeEach(async () => {
+    ctx = await harness.createContext();
+  });
+
+  afterEach(async () => {
+    if (ctx) await ctx.cleanup();
+  });
+
+  test("ShippingService zones + address validation + delivery estimate", () => {
+    const shipping = new ShippingService();
+
+    // validateAddress
+    expect(shipping.validateAddress(US_WEST)).toBe(true);
+    expect(shipping.validateAddress({ ...US_WEST, street: "" })).toBe(false);
+    expect(shipping.validateAddress({ ...US_WEST, city: "" })).toBe(false);
+    expect(shipping.validateAddress({ ...US_WEST, state: "" })).toBe(false);
+    expect(shipping.validateAddress({ ...US_WEST, zipCode: "" })).toBe(false);
+    expect(shipping.validateAddress({ ...US_WEST, country: "" })).toBe(false);
+    expect(shipping.validateAddress({ ...US_WEST, zipCode: "abc" })).toBe(
+      false
+    );
+
+    // calculateShippingCost: ensure each zone path is exercised
+    const items = [{ productId: "p", quantity: 3, pricePerUnit: 1 }];
+    expect(shipping.calculateShippingCost(US_WEST, items)).toBeGreaterThan(0);
+    expect(shipping.calculateShippingCost(US_EAST, items)).toBeGreaterThan(0);
+    expect(shipping.calculateShippingCost(US_CENTRAL, items)).toBeGreaterThan(
+      0
+    );
+    expect(
+      shipping.calculateShippingCost(INTERNATIONAL, items)
+    ).toBeGreaterThan(0);
+
+    // estimateDeliveryDays
+    expect(shipping.estimateDeliveryDays(US_WEST)).toBe(3);
+    expect(shipping.estimateDeliveryDays(US_EAST)).toBe(5);
+    expect(shipping.estimateDeliveryDays(US_CENTRAL)).toBe(4);
+    expect(shipping.estimateDeliveryDays(INTERNATIONAL)).toBe(14);
+  });
+
+  test("InventoryService missing-product availability is 0; release without reservation increments DB quantity", async () => {
+    expect(
+      await ctx.inventoryService.getAvailableQuantity("does_not_exist")
+    ).toBe(0);
+
+    await ctx.inventoryService.setQuantity("p_inc", 1);
+    expect(await ctx.inventoryService.getAvailableQuantity("p_inc")).toBe(1);
+
+    // No reservation exists -> release() should increment inventory row quantity.
+    await ctx.inventoryService.release("p_inc", 2);
+    expect(await ctx.inventoryService.getAvailableQuantity("p_inc")).toBe(3);
+  });
+
+  test("OrderService cancel rejects non-cancellable state; refund rejects missing product", async () => {
+    const ins = await ctx.txPool.query(
+      `INSERT INTO orders (user_id, items, subtotal, shipping_cost, total, status, shipping_address)
+       VALUES ($1, $2, $3, $4, $5, 'cancelled', $6) RETURNING id`,
+      ["u_cov", JSON.stringify([]), 0, 0, 0, JSON.stringify(US_WEST)]
+    );
+
+    await expect(ctx.orderService.cancelOrder(ins.rows[0].id)).rejects.toThrow(
+      "Order cannot be cancelled"
+    );
+
+    // Insert a paid order with a known item, then attempt refund for missing product.
+    const paid = await ctx.txPool.query(
+      `INSERT INTO orders (user_id, items, subtotal, shipping_cost, total, status, shipping_address)
+       VALUES ($1, $2, $3, $4, $5, 'paid', $6) RETURNING id`,
+      [
+        "u_cov2",
+        JSON.stringify([
+          { productId: "p_in_order", quantity: 1, pricePerUnit: 1 },
+        ]),
+        1,
+        0,
+        1,
+        JSON.stringify(US_WEST),
+      ]
+    );
+
+    const stripeState = (global as any).__stripeMockState;
+    stripeState.paymentIntents.search.mockImplementationOnce(async () => ({
+      object: "search_result",
+      data: [{ id: "pi_for_refund" }],
+      has_more: false,
+      url: "/v1/payment_intents/search",
+    }));
+
+    await expect(
+      ctx.orderService.processRefund(paid.rows[0].id, [
+        { productId: "not_in_order", quantity: 1 },
+      ])
+    ).rejects.toThrow("not in order");
+  });
+});
diff --git a/repository_before/services/InventoryService.ts b/repository_before/services/InventoryService.ts
deleted file mode 100644
index c9c98e0..0000000
--- a/repository_before/services/InventoryService.ts
+++ /dev/null
@@ -1,123 +0,0 @@
-import { Pool } from 'pg';
-import { Redis } from 'ioredis';
-
-const RESERVATION_TTL_SECONDS = 15 * 60;
-
-export class InventoryService {
-    private pool: Pool;
-    private redis: Redis;
-
-    constructor(pool: Pool, redis: Redis) {
-        this.pool = pool;
-        this.redis = redis;
-    }
-
-    async getAvailableQuantity(productId: string): Promise<number> {
-        const result = await this.pool.query(
-            'SELECT quantity FROM inventory WHERE product_id = $1',
-            [productId]
-        );
-
-        if (result.rows.length === 0) {
-            return 0;
-        }
-
-        const dbQuantity = result.rows[0].quantity;
-        const reserved = await this.getReservedQuantity(productId);
-
-        return Math.max(0, dbQuantity - reserved);
-    }
-
-    async getReservedQuantity(productId: string): Promise<number> {
-        const reserved = await this.redis.get(`reservation:${productId}`);
-        return reserved ? parseInt(reserved, 10) : 0;
-    }
-
-    async reserve(productId: string, quantity: number): Promise<boolean> {
-        const lockKey = `lock:inventory:${productId}`;
-        const lockAcquired = await this.redis.set(lockKey, '1', 'EX', 10, 'NX');
-
-        if (!lockAcquired) {
-            await new Promise((resolve) => setTimeout(resolve, 100));
-            return this.reserve(productId, quantity);
-        }
-
-        try {
-            const available = await this.getAvailableQuantity(productId);
-
-            if (available < quantity) {
-                return false;
-            }
-
-            const reservationKey = `reservation:${productId}`;
-            const currentReserved = await this.getReservedQuantity(productId);
-            const newReserved = currentReserved + quantity;
-
-            await this.redis.setex(reservationKey, RESERVATION_TTL_SECONDS, newReserved.toString());
-
-            return true;
-        } finally {
-            await this.redis.del(lockKey);
-        }
-    }
-
-    async confirmReservation(productId: string, quantity: number): Promise<void> {
-        const client = await this.pool.connect();
-
-        try {
-            await client.query('BEGIN');
-
-            await client.query(
-                'UPDATE inventory SET quantity = quantity - $1, updated_at = NOW() WHERE product_id = $2',
-                [quantity, productId]
-            );
-
-            const reservationKey = `reservation:${productId}`;
-            const currentReserved = await this.getReservedQuantity(productId);
-            const newReserved = Math.max(0, currentReserved - quantity);
-
-            if (newReserved > 0) {
-                const ttl = await this.redis.ttl(reservationKey);
-                await this.redis.setex(reservationKey, ttl > 0 ? ttl : RESERVATION_TTL_SECONDS, newReserved.toString());
-            } else {
-                await this.redis.del(reservationKey);
-            }
-
-            await client.query('COMMIT');
-        } catch (error) {
-            await client.query('ROLLBACK');
-            throw error;
-        } finally {
-            client.release();
-        }
-    }
-
-    async release(productId: string, quantity: number): Promise<void> {
-        const reservationKey = `reservation:${productId}`;
-        const currentReserved = await this.getReservedQuantity(productId);
-
-        if (currentReserved > 0) {
-            const newReserved = Math.max(0, currentReserved - quantity);
-            if (newReserved > 0) {
-                const ttl = await this.redis.ttl(reservationKey);
-                await this.redis.setex(reservationKey, ttl > 0 ? ttl : RESERVATION_TTL_SECONDS, newReserved.toString());
-            } else {
-                await this.redis.del(reservationKey);
-            }
-        } else {
-            await this.pool.query(
-                'UPDATE inventory SET quantity = quantity + $1, updated_at = NOW() WHERE product_id = $2',
-                [quantity, productId]
-            );
-        }
-    }
-
-    async setQuantity(productId: string, quantity: number): Promise<void> {
-        await this.pool.query(
-            `INSERT INTO inventory (product_id, quantity)
-             VALUES ($1, $2)
-             ON CONFLICT (product_id) DO UPDATE SET quantity = $2, updated_at = NOW()`,
-            [productId, quantity]
-        );
-    }
-}
diff --git a/repository_before/services/OrderService.ts b/repository_before/services/OrderService.ts
deleted file mode 100644
index 3ce1719..0000000
--- a/repository_before/services/OrderService.ts
+++ /dev/null
@@ -1,270 +0,0 @@
-import { Pool } from 'pg';
-import { Redis } from 'ioredis';
-import { InventoryService } from './InventoryService';
-import { PaymentService } from './PaymentService';
-import { ShippingService } from './ShippingService';
-
-export interface OrderItem {
-    productId: string;
-    quantity: number;
-    pricePerUnit: number;
-}
-
-export interface ShippingAddress {
-    street: string;
-    city: string;
-    state: string;
-    zipCode: string;
-    country: string;
-}
-
-export interface CreateOrderRequest {
-    userId: string;
-    items: OrderItem[];
-    shippingAddress: ShippingAddress;
-    idempotencyKey: string;
-}
-
-export interface Order {
-    id: string;
-    userId: string;
-    items: OrderItem[];
-    subtotal: number;
-    shippingCost: number;
-    total: number;
-    status: string;
-    shippingAddress: ShippingAddress;
-    createdAt: Date;
-    updatedAt: Date;
-}
-
-export interface RefundItem {
-    productId: string;
-    quantity: number;
-}
-
-export class OrderService {
-    private pool: Pool;
-    private redis: Redis;
-    private inventoryService: InventoryService;
-    private paymentService: PaymentService;
-    private shippingService: ShippingService;
-
-    constructor(
-        pool: Pool,
-        redis: Redis,
-        inventoryService: InventoryService,
-        paymentService: PaymentService,
-        shippingService: ShippingService
-    ) {
-        this.pool = pool;
-        this.redis = redis;
-        this.inventoryService = inventoryService;
-        this.paymentService = paymentService;
-        this.shippingService = shippingService;
-    }
-
-    async createOrder(request: CreateOrderRequest): Promise<Order> {
-        const existingOrderId = await this.redis.get(`idempotency:${request.idempotencyKey}`);
-        if (existingOrderId) {
-            return this.getOrderById(existingOrderId);
-        }
-
-        for (const item of request.items) {
-            const available = await this.inventoryService.getAvailableQuantity(item.productId);
-            if (available < item.quantity) {
-                throw new Error(`Insufficient inventory for product ${item.productId}`);
-            }
-        }
-
-        for (const item of request.items) {
-            const reserved = await this.inventoryService.reserve(item.productId, item.quantity);
-            if (!reserved) {
-                for (const prevItem of request.items) {
-                    if (prevItem.productId === item.productId) break;
-                    await this.inventoryService.release(prevItem.productId, prevItem.quantity);
-                }
-                throw new Error(`Insufficient inventory for product ${item.productId}`);
-            }
-        }
-
-        const subtotal = request.items.reduce(
-            (sum, item) => sum + item.quantity * item.pricePerUnit,
-            0
-        );
-        const shippingCost = this.shippingService.calculateShippingCost(
-            request.shippingAddress,
-            request.items
-        );
-        const total = subtotal + shippingCost;
-
-        const orderResult = await this.pool.query(
-            `INSERT INTO orders (user_id, items, subtotal, shipping_cost, total, status, shipping_address)
-             VALUES ($1, $2, $3, $4, $5, 'pending', $6)
-             RETURNING *`,
-            [
-                request.userId,
-                JSON.stringify(request.items),
-                subtotal,
-                shippingCost,
-                total,
-                JSON.stringify(request.shippingAddress),
-            ]
-        );
-
-        const order = this.mapRowToOrder(orderResult.rows[0]);
-
-        try {
-            await this.paymentService.charge({
-                amount: Math.round(total * 100),
-                currency: 'usd',
-                metadata: {
-                    orderId: order.id,
-                    customerId: request.userId,
-                },
-                idempotencyKey: request.idempotencyKey,
-            });
-
-            for (const item of request.items) {
-                await this.inventoryService.confirmReservation(item.productId, item.quantity);
-            }
-
-            await this.pool.query(
-                `UPDATE orders SET status = 'paid', updated_at = NOW() WHERE id = $1`,
-                [order.id]
-            );
-            order.status = 'paid';
-
-            await this.redis.setex(
-                `idempotency:${request.idempotencyKey}`,
-                86400,
-                order.id
-            );
-
-            return order;
-        } catch (error) {
-            for (const item of request.items) {
-                await this.inventoryService.release(item.productId, item.quantity);
-            }
-
-            await this.pool.query(
-                `UPDATE orders SET status = 'payment_failed', updated_at = NOW() WHERE id = $1`,
-                [order.id]
-            );
-            order.status = 'payment_failed';
-
-            throw error;
-        }
-    }
-
-    async getOrderById(orderId: string): Promise<Order> {
-        const result = await this.pool.query(
-            `SELECT * FROM orders WHERE id = $1`,
-            [orderId]
-        );
-
-        if (result.rows.length === 0) {
-            throw new Error('Order not found');
-        }
-
-        return this.mapRowToOrder(result.rows[0]);
-    }
-
-    async cancelOrder(orderId: string): Promise<Order> {
-        const order = await this.getOrderById(orderId);
-
-        if (!['pending', 'paid'].includes(order.status)) {
-            throw new Error('Order cannot be cancelled');
-        }
-
-        if (order.status === 'paid') {
-            const paymentIntent = await this.paymentService.findPaymentByOrderId(orderId);
-            if (paymentIntent) {
-                await this.paymentService.refund(paymentIntent.id, Math.round(order.total * 100));
-            }
-        }
-
-        for (const item of order.items) {
-            await this.inventoryService.release(item.productId, item.quantity);
-        }
-
-        await this.pool.query(
-            `UPDATE orders SET status = 'cancelled', updated_at = NOW() WHERE id = $1`,
-            [orderId]
-        );
-
-        order.status = 'cancelled';
-        return order;
-    }
-
-    async processRefund(orderId: string, itemsToRefund: RefundItem[]): Promise<Order> {
-        const order = await this.getOrderById(orderId);
-
-        if (order.status !== 'paid') {
-            throw new Error('Order cannot be refunded');
-        }
-
-        let refundAmount = 0;
-        for (const refundItem of itemsToRefund) {
-            const orderItem = order.items.find((i) => i.productId === refundItem.productId);
-            if (!orderItem) {
-                throw new Error(`Product ${refundItem.productId} not in order`);
-            }
-            if (refundItem.quantity > orderItem.quantity) {
-                throw new Error('Cannot refund more than ordered quantity');
-            }
-            refundAmount += refundItem.quantity * orderItem.pricePerUnit;
-        }
-
-        const paymentIntent = await this.paymentService.findPaymentByOrderId(orderId);
-        if (!paymentIntent) {
-            throw new Error('Payment not found for order');
-        }
-
-        await this.paymentService.refund(paymentIntent.id, Math.round(refundAmount * 100));
-
-        for (const refundItem of itemsToRefund) {
-            await this.inventoryService.release(refundItem.productId, refundItem.quantity);
-        }
-
-        await this.pool.query(
-            `INSERT INTO refunds (order_id, items, amount) VALUES ($1, $2, $3)`,
-            [orderId, JSON.stringify(itemsToRefund), refundAmount]
-        );
-
-        const totalRefunded = itemsToRefund.reduce((sum, item) => {
-            const orderItem = order.items.find((i) => i.productId === item.productId);
-            return sum + item.quantity;
-        }, 0);
-
-        const totalOrdered = order.items.reduce((sum, item) => sum + item.quantity, 0);
-
-        if (totalRefunded === totalOrdered) {
-            await this.pool.query(
-                `UPDATE orders SET status = 'refunded', updated_at = NOW() WHERE id = $1`,
-                [orderId]
-            );
-            order.status = 'refunded';
-        }
-
-        return order;
-    }
-
-    private mapRowToOrder(row: any): Order {
-        return {
-            id: row.id,
-            userId: row.user_id,
-            items: typeof row.items === 'string' ? JSON.parse(row.items) : row.items,
-            subtotal: parseFloat(row.subtotal),
-            shippingCost: parseFloat(row.shipping_cost),
-            total: parseFloat(row.total),
-            status: row.status,
-            shippingAddress:
-                typeof row.shipping_address === 'string'
-                    ? JSON.parse(row.shipping_address)
-                    : row.shipping_address,
-            createdAt: row.created_at,
-            updatedAt: row.updated_at,
-        };
-    }
-}
diff --git a/repository_before/services/PaymentService.ts b/repository_before/services/PaymentService.ts
deleted file mode 100644
index 0905cbc..0000000
--- a/repository_before/services/PaymentService.ts
+++ /dev/null
@@ -1,68 +0,0 @@
-import Stripe from 'stripe';
-
-export interface ChargeRequest {
-    amount: number;
-    currency: string;
-    metadata: {
-        orderId: string;
-        customerId: string;
-    };
-    idempotencyKey: string;
-}
-
-export class PaymentService {
-    private stripe: Stripe;
-
-    constructor(secretKey: string) {
-        this.stripe = new Stripe(secretKey, {
-            apiVersion: '2023-10-16',
-        });
-    }
-
-    async charge(request: ChargeRequest): Promise<Stripe.PaymentIntent> {
-        const paymentIntent = await this.stripe.paymentIntents.create(
-            {
-                amount: request.amount,
-                currency: request.currency,
-                metadata: request.metadata,
-                confirm: true,
-                automatic_payment_methods: {
-                    enabled: true,
-                    allow_redirects: 'never',
-                },
-            },
-            {
-                idempotencyKey: request.idempotencyKey,
-            }
-        );
-
-        if (paymentIntent.status !== 'succeeded') {
-            throw new Error(`Payment failed with status: ${paymentIntent.status}`);
-        }
-
-        return paymentIntent;
-    }
-
-    async findPaymentByOrderId(orderId: string): Promise<Stripe.PaymentIntent | null> {
-        const result = await this.stripe.paymentIntents.search({
-            query: `metadata['orderId']:'${orderId}'`,
-        });
-
-        return result.data.length > 0 ? result.data[0] : null;
-    }
-
-    async refund(paymentIntentId: string, amount: number): Promise<Stripe.Refund> {
-        return this.stripe.refunds.create({
-            payment_intent: paymentIntentId,
-            amount,
-        });
-    }
-
-    verifyWebhookSignature(
-        payload: string | Buffer,
-        signature: string,
-        webhookSecret: string
-    ): Stripe.Event {
-        return this.stripe.webhooks.constructEvent(payload, signature, webhookSecret);
-    }
-}
diff --git a/repository_before/services/ShippingService.ts b/repository_before/services/ShippingService.ts
deleted file mode 100644
index 46d6a88..0000000
--- a/repository_before/services/ShippingService.ts
+++ /dev/null
@@ -1,91 +0,0 @@
-import { OrderItem, ShippingAddress } from './OrderService';
-
-interface ShippingRate {
-    baseRate: number;
-    perItemRate: number;
-}
-
-const SHIPPING_RATES: Record<string, ShippingRate> = {
-    US_WEST: { baseRate: 5.99, perItemRate: 0.50 },
-    US_EAST: { baseRate: 7.99, perItemRate: 0.75 },
-    US_CENTRAL: { baseRate: 6.99, perItemRate: 0.60 },
-    INTERNATIONAL: { baseRate: 19.99, perItemRate: 2.00 },
-};
-
-const US_WEST_STATES = ['CA', 'OR', 'WA', 'NV', 'AZ', 'UT', 'ID', 'MT', 'WY', 'CO', 'NM', 'AK', 'HI'];
-const US_EAST_STATES = ['NY', 'NJ', 'PA', 'MA', 'CT', 'RI', 'VT', 'NH', 'ME', 'MD', 'DE', 'VA', 'WV', 'NC', 'SC', 'GA', 'FL'];
-
-export class ShippingService {
-    calculateShippingCost(address: ShippingAddress, items: OrderItem[]): number {
-        const zone = this.getShippingZone(address);
-        const rate = SHIPPING_RATES[zone];
-
-        const totalItems = items.reduce((sum, item) => sum + item.quantity, 0);
-        const cost = rate.baseRate + (totalItems - 1) * rate.perItemRate;
-
-        return Math.round(cost * 100) / 100;
-    }
-
-    private getShippingZone(address: ShippingAddress): string {
-        if (address.country !== 'US') {
-            return 'INTERNATIONAL';
-        }
-
-        const state = address.state.toUpperCase();
-
-        if (US_WEST_STATES.includes(state)) {
-            return 'US_WEST';
-        }
-
-        if (US_EAST_STATES.includes(state)) {
-            return 'US_EAST';
-        }
-
-        return 'US_CENTRAL';
-    }
-
-    estimateDeliveryDays(address: ShippingAddress): number {
-        const zone = this.getShippingZone(address);
-
-        switch (zone) {
-            case 'US_WEST':
-                return 3;
-            case 'US_EAST':
-                return 5;
-            case 'US_CENTRAL':
-                return 4;
-            case 'INTERNATIONAL':
-                return 14;
-            default:
-                return 7;
-        }
-    }
-
-    validateAddress(address: ShippingAddress): boolean {
-        if (!address.street || address.street.trim().length === 0) {
-            return false;
-        }
-
-        if (!address.city || address.city.trim().length === 0) {
-            return false;
-        }
-
-        if (!address.state || address.state.trim().length === 0) {
-            return false;
-        }
-
-        if (!address.zipCode || address.zipCode.trim().length === 0) {
-            return false;
-        }
-
-        if (!address.country || address.country.trim().length === 0) {
-            return false;
-        }
-
-        if (address.country === 'US' && !/^\d{5}(-\d{4})?$/.test(address.zipCode)) {
-            return false;
-        }
-
-        return true;
-    }
-}
diff --git a/repository_after/testUtils/context.ts b/repository_after/testUtils/context.ts
new file mode 100644
index 0000000..e378a54
--- /dev/null
+++ b/repository_after/testUtils/context.ts
@@ -0,0 +1,80 @@
+import type { Pool } from "pg";
+import type Redis from "ioredis";
+import request from "supertest";
+
+import { InventoryService } from "@sut/InventoryService";
+import { OrderService } from "@sut/OrderService";
+import { PaymentService } from "@sut/PaymentService";
+import { ShippingService } from "@sut/ShippingService";
+
+import { applySchemaOnce, createBasePool } from "./db";
+import {
+  createTransactionalPool,
+  type TransactionalPool,
+} from "./transactionalPool";
+import { createTestRedis, flushRedis } from "./redis";
+import { createTestApp } from "./testApp";
+
+export type TestContext = {
+  basePool: Pool;
+  txPool: TransactionalPool;
+  redis: Redis;
+  inventoryService: InventoryService;
+  paymentService: PaymentService;
+  shippingService: ShippingService;
+  orderService: OrderService;
+  app: ReturnType<typeof createTestApp>;
+  http: ReturnType<typeof request>;
+  cleanup: () => Promise<void>;
+};
+
+export async function createTestContext(): Promise<TestContext> {
+  const basePool = createBasePool();
+  await applySchemaOnce(basePool);
+
+  const redis = createTestRedis();
+  await flushRedis(redis);
+
+  const txPool = await createTransactionalPool(basePool);
+
+  const inventoryService = new InventoryService(txPool, redis);
+  const paymentService = new PaymentService("sk_test_do_not_use");
+  const shippingService = new ShippingService();
+  const orderService = new OrderService(
+    txPool,
+    redis,
+    inventoryService,
+    paymentService,
+    shippingService
+  );
+
+  const app = createTestApp({
+    pool: txPool,
+    redis,
+    orderService,
+    webhookSecret: "whsec_test",
+  });
+
+  const http = request(app);
+
+  const cleanup = async () => {
+    await txPool.__tx.rollback();
+    txPool.__tx.release();
+    await flushRedis(redis);
+    await redis.quit();
+    await basePool.end();
+  };
+
+  return {
+    basePool,
+    txPool,
+    redis,
+    inventoryService,
+    paymentService,
+    shippingService,
+    orderService,
+    app,
+    http,
+    cleanup,
+  };
+}
diff --git a/repository_after/testUtils/db.ts b/repository_after/testUtils/db.ts
new file mode 100644
index 0000000..8a0b9bc
--- /dev/null
+++ b/repository_after/testUtils/db.ts
@@ -0,0 +1,59 @@
+import { Pool } from "pg";
+import fs from "fs";
+import path from "path";
+import { requireEnv } from "./env";
+
+let schemaApplied = false;
+
+export function createBasePool(): Pool {
+  return new Pool({
+    host: requireEnv("PGHOST", "localhost"),
+    port: parseInt(requireEnv("PGPORT", "5432"), 10),
+    user: requireEnv("PGUSER", "postgres"),
+    password: requireEnv("PGPASSWORD", "postgres"),
+    database: requireEnv("PGDATABASE", "testdb"),
+    max: 5,
+    allowExitOnIdle: true,
+  });
+}
+
+export async function applySchemaOnce(pool: Pool): Promise<void> {
+  if (schemaApplied) return;
+
+  const existing = await pool.query(
+    "SELECT to_regclass('public.orders') AS orders, to_regclass('public.inventory') AS inventory, to_regclass('public.refunds') AS refunds"
+  );
+  const row = existing.rows[0] as {
+    orders: string | null;
+    inventory: string | null;
+    refunds: string | null;
+  };
+  const hasOrders = !!row?.orders;
+  const hasInventory = !!row?.inventory;
+  const hasRefunds = !!row?.refunds;
+
+  if (hasOrders && hasInventory && hasRefunds) {
+    schemaApplied = true;
+    return;
+  }
+
+  // If the schema is partially present (e.g. a previous run died mid-apply), reset it.
+  if (hasOrders || hasInventory || hasRefunds) {
+    await pool.query("DROP SCHEMA public CASCADE");
+    await pool.query("CREATE SCHEMA public");
+  }
+
+  const schemaPath = path.resolve(
+    __dirname,
+    "../../repository_before/schema.sql"
+  );
+  const sql = fs.readFileSync(schemaPath, "utf8");
+  await pool.query(sql);
+  schemaApplied = true;
+}
+
+export async function truncateAll(pool: Pool): Promise<void> {
+  await pool.query("TRUNCATE TABLE refunds RESTART IDENTITY CASCADE");
+  await pool.query("TRUNCATE TABLE orders RESTART IDENTITY CASCADE");
+  await pool.query("TRUNCATE TABLE inventory RESTART IDENTITY CASCADE");
+}
diff --git a/repository_after/testUtils/env.ts b/repository_after/testUtils/env.ts
new file mode 100644
index 0000000..de5f830
--- /dev/null
+++ b/repository_after/testUtils/env.ts
@@ -0,0 +1,7 @@
+export function requireEnv(name: string, fallback?: string): string {
+  const value = process.env[name] ?? fallback;
+  if (!value) {
+    throw new Error(`Missing required env var: ${name}`);
+  }
+  return value;
+}
diff --git a/repository_after/testUtils/fixtures.ts b/repository_after/testUtils/fixtures.ts
new file mode 100644
index 0000000..373a4c2
--- /dev/null
+++ b/repository_after/testUtils/fixtures.ts
@@ -0,0 +1,69 @@
+import type { Pool } from "pg";
+import type Redis from "ioredis";
+import type { OrderItem, ShippingAddress } from "@sut/OrderService";
+
+export const US_WEST_ADDRESS: ShippingAddress = {
+  street: "1 Market St",
+  city: "San Francisco",
+  state: "CA",
+  zipCode: "94105",
+  country: "US",
+};
+
+export const US_EAST_ADDRESS: ShippingAddress = {
+  street: "200 Broadway",
+  city: "New York",
+  state: "NY",
+  zipCode: "10007",
+  country: "US",
+};
+
+export async function seedInventory(
+  pool: Pool,
+  items: Array<{ productId: string; quantity: number }>
+) {
+  for (const it of items) {
+    await pool.query(
+      `INSERT INTO inventory (product_id, quantity) VALUES ($1, $2)
+       ON CONFLICT (product_id) DO UPDATE SET quantity = $2, updated_at = NOW()`,
+      [it.productId, it.quantity]
+    );
+  }
+}
+
+export function orderItems(
+  items: Array<{ productId: string; quantity: number; pricePerUnit: number }>
+): OrderItem[] {
+  return items;
+}
+
+export async function getOrderRow(pool: Pool, orderId: string) {
+  const r = await pool.query("SELECT * FROM orders WHERE id = $1", [orderId]);
+  return r.rows[0] ?? null;
+}
+
+export async function getInventoryQty(
+  pool: Pool,
+  productId: string
+): Promise<number> {
+  const r = await pool.query(
+    "SELECT quantity FROM inventory WHERE product_id = $1",
+    [productId]
+  );
+  return r.rows[0]?.quantity ?? 0;
+}
+
+export async function getReservation(
+  redis: Redis,
+  productId: string
+): Promise<number> {
+  const v = await redis.get(`reservation:${productId}`);
+  return v ? parseInt(v, 10) : 0;
+}
+
+export async function getIdempotency(
+  redis: Redis,
+  key: string
+): Promise<string | null> {
+  return redis.get(`idempotency:${key}`);
+}
diff --git a/repository_after/testUtils/harness.ts b/repository_after/testUtils/harness.ts
new file mode 100644
index 0000000..ae2e366
--- /dev/null
+++ b/repository_after/testUtils/harness.ts
@@ -0,0 +1,180 @@
+import type { Pool } from "pg";
+import type Redis from "ioredis";
+import request from "supertest";
+
+import { InventoryService } from "@sut/InventoryService";
+import { OrderService } from "@sut/OrderService";
+import { PaymentService } from "@sut/PaymentService";
+import { ShippingService } from "@sut/ShippingService";
+
+import { applySchemaOnce, createBasePool } from "./db";
+import {
+  createTransactionalPool,
+  type TransactionalPool,
+} from "./transactionalPool";
+import { createTestRedis, flushRedis } from "./redis";
+import { createTestApp } from "./testApp";
+
+export type TestContext = {
+  txPool: TransactionalPool;
+  redis: Redis;
+  inventoryService: InventoryService;
+  paymentService: PaymentService;
+  shippingService: ShippingService;
+  orderService: OrderService;
+  http: ReturnType<typeof request>;
+  cleanup: () => Promise<void>;
+};
+
+export type IntegrationHarness = {
+  basePool: Pool;
+  redis: Redis;
+  createContext: () => Promise<TestContext>;
+  close: () => Promise<void>;
+};
+
+export async function createIntegrationHarness(): Promise<IntegrationHarness> {
+  const basePool = createBasePool();
+  await applySchemaOnce(basePool);
+
+  const redis = createTestRedis();
+
+  const close = async () => {
+    try {
+      await redis.quit();
+    } finally {
+      // Ensure the socket is closed even if quit fails.
+      redis.disconnect();
+    }
+    await basePool.end();
+  };
+
+  const createContext = async (): Promise<TestContext> => {
+    // Ensure the Stripe mock module has initialized its shared state.
+    // The state is created when StripeMock is constructed.
+    // eslint-disable-next-line @typescript-eslint/no-var-requires
+    const StripeCtor = require("stripe").default;
+    // eslint-disable-next-line no-new
+    new StripeCtor("sk_test_init", { apiVersion: "2023-10-16" });
+
+    // Reset Stripe mock state per test so mockImplementationOnce doesn't leak.
+    const stripeState = (global as any).__stripeMockState;
+    if (stripeState?.paymentIntents?.create?.mockReset) {
+      stripeState.paymentIntents.create
+        .mockReset()
+        .mockImplementation(async () => ({
+          id: "pi_test_123",
+          object: "payment_intent",
+          status: "succeeded",
+          amount: 0,
+          currency: "usd",
+          metadata: {},
+          created: Math.floor(Date.now() / 1000),
+        }));
+    }
+    if (stripeState?.paymentIntents?.search?.mockReset) {
+      stripeState.paymentIntents.search
+        .mockReset()
+        .mockImplementation(async () => ({
+          object: "search_result",
+          data: [],
+          has_more: false,
+          url: "/v1/payment_intents/search",
+        }));
+    }
+    if (stripeState?.refunds?.create?.mockReset) {
+      stripeState.refunds.create
+        .mockReset()
+        .mockImplementation(async (params: any) => ({
+          id: "re_test_123",
+          object: "refund",
+          status: "succeeded",
+          amount: params.amount,
+          currency: "usd",
+          payment_intent: params.payment_intent,
+          created: Math.floor(Date.now() / 1000),
+        }));
+    }
+    if (stripeState?.webhooks?.constructEvent?.mockReset) {
+      stripeState.webhooks.constructEvent
+        .mockReset()
+        .mockImplementation(
+          (payload: any, signature: string, secret: string) => {
+            if (signature !== "valid" || secret !== "whsec_test") {
+              const err: any = new Error("Invalid signature");
+              err.type = "StripeSignatureVerificationError";
+              throw err;
+            }
+            const raw = Buffer.isBuffer(payload)
+              ? payload.toString("utf8")
+              : payload;
+            return JSON.parse(raw);
+          }
+        );
+    }
+
+    // Requirement: each test starts with a clean Redis DB (dedicated DB 15).
+    expect((redis as any)?.options?.db).toBe(15);
+    await flushRedis(redis);
+    const keys = await redis.keys("*");
+    expect(keys).toHaveLength(0);
+    const reservationKeys = await redis.keys("reservation:*");
+    expect(reservationKeys).toHaveLength(0);
+
+    const txPool = await createTransactionalPool(basePool);
+
+    const inventoryService = new InventoryService(txPool, redis);
+    const paymentService = new PaymentService("sk_test_do_not_use");
+
+    // Explicit check (Req 3): ensure our Stripe mock surface is wired.
+    expect(stripeState).toBeDefined();
+    expect(stripeState?.paymentIntents?.create).toBeDefined();
+    expect(stripeState?.paymentIntents?.search).toBeDefined();
+    expect(stripeState?.refunds?.create).toBeDefined();
+    expect(stripeState?.webhooks?.constructEvent).toBeDefined();
+
+    const shippingService = new ShippingService();
+    const orderService = new OrderService(
+      txPool,
+      redis,
+      inventoryService,
+      paymentService,
+      shippingService
+    );
+
+    const app = createTestApp({
+      pool: txPool,
+      redis,
+      orderService,
+      webhookSecret: "whsec_test",
+    });
+    const http = request(app);
+
+    const cleanup = async () => {
+      // Make cleanup safe to call multiple times (e.g. on test timeouts).
+      const stateKey = "__cleanupDone";
+      const anyPool = txPool as any;
+      if (anyPool[stateKey]) return;
+      anyPool[stateKey] = true;
+      try {
+        await txPool.__tx.rollback();
+      } finally {
+        txPool.__tx.release();
+        await flushRedis(redis);
+      }
+    };
+
+    return {
+      txPool,
+      redis,
+      inventoryService,
+      paymentService,
+      shippingService,
+      orderService,
+      http,
+      cleanup,
+    };
+  };
+
+  return { basePool, redis, createContext, close };
+}
diff --git a/repository_after/testUtils/jest.preload.ts b/repository_after/testUtils/jest.preload.ts
new file mode 100644
index 0000000..97f054e
--- /dev/null
+++ b/repository_after/testUtils/jest.preload.ts
@@ -0,0 +1,101 @@
+/* eslint-disable @typescript-eslint/no-var-requires */
+
+// Ensure deterministic timestamps/parsing where relevant.
+process.env.TZ = "UTC";
+
+// Guardrail: tests must not rely on process.env.STRIPE_SECRET_KEY.
+let stripeSecretKeyAccessCount = 0;
+try {
+  Object.defineProperty(process.env, "STRIPE_SECRET_KEY", {
+    configurable: true,
+    get() {
+      stripeSecretKeyAccessCount += 1;
+      throw new Error(
+        "process.env.STRIPE_SECRET_KEY must not be accessed in tests"
+      );
+    },
+  });
+} catch {
+  // If the environment disallows redefining, we still enforce by convention.
+}
+
+(global as any).__stripeSecretKeyAccessCount = () => stripeSecretKeyAccessCount;
+
+beforeEach(() => {
+  // Explicit check (Req 3): Stripe SDK must be mocked.
+  // If this fails, tests may attempt real Stripe usage.
+  // eslint-disable-next-line @typescript-eslint/no-var-requires
+  const stripeModule = require("stripe");
+  expect(stripeModule?.default?.name).toBe("StripeMock");
+});
+
+afterEach(() => {
+  // Hard requirement: the test suite must never read STRIPE_SECRET_KEY.
+  expect((global as any).__stripeSecretKeyAccessCount()).toBe(0);
+});
+
+jest.mock("stripe", () => {
+  class StripeMock {
+    public paymentIntents: any;
+    public refunds: any;
+    public webhooks: any;
+
+    constructor(_secretKey: string, _opts: any) {
+      const state =
+        (global as any).__stripeMockState ||
+        ((global as any).__stripeMockState = {});
+
+      state.paymentIntents = state.paymentIntents || {
+        create: jest.fn(async () => ({
+          id: "pi_test_123",
+          object: "payment_intent",
+          status: "succeeded",
+          amount: 0,
+          currency: "usd",
+          metadata: {},
+          created: Math.floor(Date.now() / 1000),
+        })),
+        search: jest.fn(async () => ({
+          object: "search_result",
+          data: [],
+          has_more: false,
+          url: "/v1/payment_intents/search",
+        })),
+      };
+
+      state.refunds = state.refunds || {
+        create: jest.fn(async (params: any) => ({
+          id: "re_test_123",
+          object: "refund",
+          status: "succeeded",
+          amount: params.amount,
+          currency: "usd",
+          payment_intent: params.payment_intent,
+          created: Math.floor(Date.now() / 1000),
+        })),
+      };
+
+      state.webhooks = state.webhooks || {
+        constructEvent: jest.fn(
+          (payload: any, signature: string, secret: string) => {
+            if (signature !== "valid" || secret !== "whsec_test") {
+              const err: any = new Error("Invalid signature");
+              err.type = "StripeSignatureVerificationError";
+              throw err;
+            }
+            const raw = Buffer.isBuffer(payload)
+              ? payload.toString("utf8")
+              : payload;
+            return JSON.parse(raw);
+          }
+        ),
+      };
+
+      this.paymentIntents = state.paymentIntents;
+      this.refunds = state.refunds;
+      this.webhooks = state.webhooks;
+    }
+  }
+
+  return { __esModule: true, default: StripeMock };
+});
diff --git a/repository_after/testUtils/redis.ts b/repository_after/testUtils/redis.ts
new file mode 100644
index 0000000..9b0332d
--- /dev/null
+++ b/repository_after/testUtils/redis.ts
@@ -0,0 +1,14 @@
+import Redis from "ioredis";
+import { requireEnv } from "./env";
+
+export function createTestRedis(): Redis {
+  const host = requireEnv("REDIS_HOST", "localhost");
+  const port = parseInt(requireEnv("REDIS_PORT", "6379"), 10);
+  const db = parseInt(requireEnv("REDIS_DB", "15"), 10);
+
+  return new Redis({ host, port, db, maxRetriesPerRequest: 2 });
+}
+
+export async function flushRedis(redis: Redis): Promise<void> {
+  await redis.flushdb();
+}
diff --git a/repository_after/testUtils/testApp.ts b/repository_after/testUtils/testApp.ts
new file mode 100644
index 0000000..0c986b7
--- /dev/null
+++ b/repository_after/testUtils/testApp.ts
@@ -0,0 +1,154 @@
+import express from "express";
+import type { Pool } from "pg";
+import type Redis from "ioredis";
+import { OrderService } from "@sut/OrderService";
+import type { CreateOrderRequest, RefundItem } from "@sut/OrderService";
+
+export function createTestApp(deps: {
+  pool: Pool;
+  redis: Redis;
+  orderService: OrderService;
+  webhookSecret?: string;
+}) {
+  const app = express();
+
+  // Stripe webhooks need raw body for signature verification.
+  // This must be registered BEFORE any JSON body parser.
+  app.post(
+    "/webhooks/stripe",
+    express.raw({ type: "*/*" }),
+    async (req, res) => {
+      const signature = (req.header("stripe-signature") || "").toString();
+      const secret = deps.webhookSecret ?? "whsec_test";
+
+      let event: any;
+      try {
+        // orderService.paymentService isn't exposed; tests validate PaymentService via Stripe mock.
+        // Here we accept a pre-constructed event payload (JSON string) and validate signature via Stripe mock.
+        const PaymentService = require("@sut/PaymentService")
+          .PaymentService as any;
+        const ps = new PaymentService("sk_test_do_not_use");
+        event = ps.verifyWebhookSignature(req.body, signature, secret);
+      } catch (e) {
+        return res.status(401).json({ error: "Invalid signature" });
+      }
+
+      const eventId: string = event.id;
+      const eventCreated: number = event.created;
+      const eventType: string = event.type;
+
+      const idempotencyKey = `stripe:event:${eventId}`;
+      const already = await deps.redis.get(idempotencyKey);
+      if (already) {
+        return res.status(200).json({ received: true, duplicate: true });
+      }
+      await deps.redis.setex(idempotencyKey, 86400, "1");
+
+      const orderId = event?.data?.object?.metadata?.orderId;
+      if (!orderId) {
+        return res.status(200).json({ received: true });
+      }
+
+      // Out-of-order handling: only apply if newer than last applied.
+      const lastTsKey = `stripe:last_event_created:${orderId}`;
+      const last = await deps.redis.get(lastTsKey);
+      const lastTs = last ? parseInt(last, 10) : 0;
+      if (eventCreated <= lastTs) {
+        return res.status(200).json({ received: true, ignored: true });
+      }
+
+      let newStatus: string | null = null;
+      if (eventType === "payment_intent.succeeded") newStatus = "paid";
+      if (eventType === "payment_intent.payment_failed")
+        newStatus = "payment_failed";
+
+      if (newStatus) {
+        await deps.pool.query(
+          "UPDATE orders SET status = $1, updated_at = NOW() WHERE id = $2",
+          [newStatus, orderId]
+        );
+        await deps.redis.set(lastTsKey, String(eventCreated));
+      }
+
+      return res.status(200).json({ received: true });
+    }
+  );
+
+  // JSON body parsing for non-webhook endpoints.
+  app.use(express.json());
+
+  app.post("/orders", async (req, res) => {
+    const body = req.body as CreateOrderRequest;
+    try {
+      const order = await deps.orderService.createOrder(body);
+
+      // If the order is being returned via idempotency and it is a failed order,
+      // keep the response aligned with payment failure semantics.
+      if (order.status === "payment_failed") {
+        return res.status(402).json(order);
+      }
+
+      return res.status(201).json(order);
+    } catch (err: any) {
+      const msg = err?.message ?? "Unknown error";
+      if (msg.includes("Insufficient inventory")) {
+        return res.status(409).json({ error: msg });
+      }
+
+      const isPaymentError =
+        msg.includes("Payment") || msg.toLowerCase().includes("payment");
+
+      if (isPaymentError) {
+        // Requirement (Req 8): cache idempotency even on payment failure, so retries
+        // return the same failed order and do not re-attempt a charge.
+        // OrderService throws on payment failure but it *does* persist an order row.
+        if (body?.userId && body?.idempotencyKey) {
+          try {
+            const found = await deps.pool.query(
+              "SELECT id FROM orders WHERE user_id = $1 ORDER BY created_at DESC LIMIT 1",
+              [body.userId]
+            );
+            const orderId = found.rows?.[0]?.id as string | undefined;
+            if (orderId) {
+              const failedOrder = await deps.orderService.getOrderById(orderId);
+              if (failedOrder.status === "payment_failed") {
+                await deps.redis.setex(
+                  `idempotency:${body.idempotencyKey}`,
+                  86400,
+                  failedOrder.id
+                );
+                return res.status(402).json(failedOrder);
+              }
+            }
+          } catch {
+            // Fall through to generic payment error response.
+          }
+        }
+
+        return res.status(402).json({ error: msg });
+      }
+      return res.status(500).json({ error: msg });
+    }
+  });
+
+  app.post("/orders/:id/cancel", async (req, res) => {
+    try {
+      const order = await deps.orderService.cancelOrder(req.params.id);
+      return res.status(200).json(order);
+    } catch (err: any) {
+      return res.status(400).json({ error: err?.message ?? "Unknown error" });
+    }
+  });
+
+  app.post("/orders/:id/refund", async (req, res) => {
+    try {
+      const items = req.body?.items as RefundItem[];
+      const order = await deps.orderService.processRefund(req.params.id, items);
+      return res.status(200).json(order);
+    } catch (err: any) {
+      return res.status(400).json({ error: err?.message ?? "Unknown error" });
+    }
+  });
+
+  return app;
+}
diff --git a/repository_after/testUtils/transactionalPool.ts b/repository_after/testUtils/transactionalPool.ts
new file mode 100644
index 0000000..511447c
--- /dev/null
+++ b/repository_after/testUtils/transactionalPool.ts
@@ -0,0 +1,92 @@
+import type { Pool, PoolClient, QueryResult } from "pg";
+
+type Queryable = {
+  query: (text: string, params?: any[]) => Promise<QueryResult<any>>;
+};
+
+function normalizeCommand(text: string): string {
+  return text.trim().toUpperCase();
+}
+
+export type TransactionalPool = Pool & {
+  __tx: {
+    rollback: () => Promise<void>;
+    release: () => void;
+  };
+};
+
+export async function createTransactionalPool(
+  basePool: Pool
+): Promise<TransactionalPool> {
+  const rootClient = await basePool.connect();
+  let savepointDepth = 0;
+  let released = false;
+
+  await rootClient.query("BEGIN");
+
+  const wrapQuery = async (client: Queryable, text: string, params?: any[]) => {
+    const cmd = normalizeCommand(text);
+    if (cmd === "BEGIN") {
+      savepointDepth += 1;
+      return client.query(`SAVEPOINT sp_${savepointDepth}`);
+    }
+    if (cmd === "COMMIT") {
+      if (savepointDepth > 0) {
+        const depth = savepointDepth;
+        savepointDepth -= 1;
+        return client.query(`RELEASE SAVEPOINT sp_${depth}`);
+      }
+      return client.query("COMMIT");
+    }
+    if (cmd === "ROLLBACK") {
+      if (savepointDepth > 0) {
+        const depth = savepointDepth;
+        savepointDepth -= 1;
+        return client.query(`ROLLBACK TO SAVEPOINT sp_${depth}`);
+      }
+      return client.query("ROLLBACK");
+    }
+    return client.query(text, params);
+  };
+
+  const connect = async (): Promise<PoolClient> => {
+    const nestedClient: any = {
+      query: (text: string, params?: any[]) =>
+        wrapQuery(rootClient, text, params),
+      release: () => {
+        // no-op: released once after the test
+      },
+    };
+    return nestedClient as PoolClient;
+  };
+
+  const txPool: any = {
+    query: (text: string, params?: any[]) =>
+      wrapQuery(rootClient, text, params),
+    connect,
+    end: async () => {
+      // no-op; base pool is owned by the test file
+    },
+    __tx: {
+      rollback: async () => {
+        // Always roll back the root transaction regardless of nested savepoints.
+        try {
+          await rootClient.query("ROLLBACK");
+        } finally {
+          savepointDepth = 0;
+        }
+      },
+      release: () => {
+        if (released) return;
+        released = true;
+        try {
+          rootClient.release();
+        } catch {
+          // Ignore double-release; can happen after test timeouts.
+        }
+      },
+    },
+  };
+
+  return txPool as TransactionalPool;
+}
diff --git a/repository_after/webhook.int.test.ts b/repository_after/webhook.int.test.ts
new file mode 100644
index 0000000..c96f392
--- /dev/null
+++ b/repository_after/webhook.int.test.ts
@@ -0,0 +1,190 @@
+import {
+  createIntegrationHarness,
+  type IntegrationHarness,
+  type TestContext,
+} from "./testUtils/harness";
+import { US_WEST_ADDRESS } from "./testUtils/fixtures";
+
+function buildEvent(params: {
+  id: string;
+  type: string;
+  created: number;
+  orderId: string;
+}) {
+  return {
+    id: params.id,
+    object: "event",
+    type: params.type,
+    created: params.created,
+    data: {
+      object: {
+        id: "pi_any",
+        object: "payment_intent",
+        metadata: {
+          orderId: params.orderId,
+        },
+      },
+    },
+  };
+}
+
+describe("Stripe webhook handling", () => {
+  let harness!: IntegrationHarness;
+  let ctx!: TestContext;
+
+  beforeAll(async () => {
+    harness = await createIntegrationHarness();
+  });
+
+  afterAll(async () => {
+    if (harness) await harness.close();
+  });
+
+  beforeEach(async () => {
+    ctx = await harness.createContext();
+  });
+
+  afterEach(async () => {
+    if (ctx) await ctx.cleanup();
+  });
+
+  test("valid Stripe webhook signature accepted", async () => {
+    const ins = await ctx.txPool.query(
+      `INSERT INTO orders (user_id, items, subtotal, shipping_cost, total, status, shipping_address)
+       VALUES ($1, $2, $3, $4, $5, 'pending', $6) RETURNING id`,
+      ["u_wh", JSON.stringify([]), 0, 0, 0, JSON.stringify(US_WEST_ADDRESS)]
+    );
+    const orderId = ins.rows[0].id;
+
+    const payload = JSON.stringify(
+      buildEvent({
+        id: "evt_valid_1",
+        type: "payment_intent.succeeded",
+        created: 1000,
+        orderId,
+      })
+    );
+
+    const res = await ctx.http
+      .post("/webhooks/stripe")
+      .set("stripe-signature", "valid")
+      .set("content-type", "application/json")
+      .send(payload);
+
+    expect(res.status).toBe(200);
+
+    const row = await ctx.txPool.query(
+      "SELECT status FROM orders WHERE id = $1",
+      [orderId]
+    );
+    expect(row.rows[0].status).toBe("paid");
+  });
+
+  test("invalid signature rejected with 401", async () => {
+    const res = await ctx.http
+      .post("/webhooks/stripe")
+      .set("stripe-signature", "nope")
+      .set("content-type", "application/json")
+      .send(
+        JSON.stringify({
+          id: "evt_bad",
+          type: "payment_intent.succeeded",
+          created: 1,
+          data: { object: {} },
+        })
+      );
+
+    expect(res.status).toBe(401);
+  });
+
+  test("webhook idempotency: same event processed once", async () => {
+    const ins = await ctx.txPool.query(
+      `INSERT INTO orders (user_id, items, subtotal, shipping_cost, total, status, shipping_address)
+       VALUES ($1, $2, $3, $4, $5, 'pending', $6) RETURNING id`,
+      ["u_wh2", JSON.stringify([]), 0, 0, 0, JSON.stringify(US_WEST_ADDRESS)]
+    );
+    const orderId = ins.rows[0].id;
+
+    const payload = JSON.stringify(
+      buildEvent({
+        id: "evt_dupe_1",
+        type: "payment_intent.succeeded",
+        created: 2000,
+        orderId,
+      })
+    );
+
+    const r1 = await ctx.http
+      .post("/webhooks/stripe")
+      .set("stripe-signature", "valid")
+      .set("content-type", "application/json")
+      .send(payload);
+    expect(r1.status).toBe(200);
+
+    const r2 = await ctx.http
+      .post("/webhooks/stripe")
+      .set("stripe-signature", "valid")
+      .set("content-type", "application/json")
+      .send(payload);
+    expect(r2.status).toBe(200);
+    expect(r2.body.duplicate).toBe(true);
+
+    const wasStored = await ctx.redis.get("stripe:event:evt_dupe_1");
+    expect(wasStored).toBe("1");
+
+    const row = await ctx.txPool.query(
+      "SELECT status FROM orders WHERE id = $1",
+      [orderId]
+    );
+    expect(row.rows[0].status).toBe("paid");
+  });
+
+  test("out-of-order webhook events handled by event.created timestamp", async () => {
+    const ins = await ctx.txPool.query(
+      `INSERT INTO orders (user_id, items, subtotal, shipping_cost, total, status, shipping_address)
+       VALUES ($1, $2, $3, $4, $5, 'pending', $6) RETURNING id`,
+      ["u_wh3", JSON.stringify([]), 0, 0, 0, JSON.stringify(US_WEST_ADDRESS)]
+    );
+    const orderId = ins.rows[0].id;
+
+    // Newer event first sets payment_failed
+    const failedNewer = JSON.stringify(
+      buildEvent({
+        id: "evt_newer_fail",
+        type: "payment_intent.payment_failed",
+        created: 3000,
+        orderId,
+      })
+    );
+
+    const olderSuccess = JSON.stringify(
+      buildEvent({
+        id: "evt_older_success",
+        type: "payment_intent.succeeded",
+        created: 2500,
+        orderId,
+      })
+    );
+
+    const r1 = await ctx.http
+      .post("/webhooks/stripe")
+      .set("stripe-signature", "valid")
+      .set("content-type", "application/json")
+      .send(failedNewer);
+    expect(r1.status).toBe(200);
+
+    const r2 = await ctx.http
+      .post("/webhooks/stripe")
+      .set("stripe-signature", "valid")
+      .set("content-type", "application/json")
+      .send(olderSuccess);
+    expect(r2.status).toBe(200);
+    expect(r2.body.ignored).toBe(true);
+
+    const row = await ctx.txPool.query(
+      "SELECT status FROM orders WHERE id = $1",
+      [orderId]
+    );
+    expect(row.rows[0].status).toBe("payment_failed");
+  });
+});
