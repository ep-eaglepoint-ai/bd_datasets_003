diff --git a/repository_after/.gitkeep b/repository_after/.gitkeep
new file mode 100644
index 0000000..e69de29
diff --git a/repository_after/__pycache__/user_activity.cpython-311.pyc b/repository_after/__pycache__/user_activity.cpython-311.pyc
new file mode 100644
index 0000000..fd03ae2
Binary files /dev/null and b/repository_after/__pycache__/user_activity.cpython-311.pyc differ
diff --git a/repository_before/user_activity.py b/repository_after/user_activity.py
index 89807c2..1e39eec 100644
--- a/repository_before/user_activity.py
+++ b/repository_after/user_activity.py
@@ -1,27 +1,56 @@
 """
-User Activity Analyzer - Processes user activity logs and generates statistics.
+Optimized User Activity Analyzer - Processes user activity logs and generates statistics.
 """
 
-from typing import List, Dict, Tuple
-from collections import defaultdict
+from typing import List, Dict, Tuple, Set
+from collections import defaultdict, Counter
+import heapq
 
 
 class UserActivityAnalyzer:
-    """Analyzes user activity logs and generates statistics."""
+    """Analyzes user activity logs and generates statistics with optimized performance."""
     
     def __init__(self):
+        # Main storage
         self.activities = []
+        
+        # Indexes for faster lookups
+        self.user_activities: Dict[int, List[Dict]] = defaultdict(list)
+        self.activity_type_counts = Counter()
+        self.user_activity_counts = Counter()
+        self.user_activity_types: Dict[int, Set[str]] = defaultdict(set)
+        self.activity_type_users: Dict[str, Set[int]] = defaultdict(set)
+        self.user_activity_summaries_cache: Dict[int, Dict] = {}
+        self.all_users_summary_cache = None
+        
+        # Flag to track if cache needs refresh
+        self._cache_invalid = False
     
     def add_activity(self, user_id: int, activity_type: str, timestamp: int):
-        """Add a single activity record."""
-        self.activities.append({
+        """Add a single activity record with incremental updates to indexes."""
+        activity = {
             'user_id': user_id,
             'activity_type': activity_type,
             'timestamp': timestamp
-        })
+        }
+        
+        # Store activity
+        self.activities.append(activity)
+        
+        # Update indexes incrementally
+        self.user_activities[user_id].append(activity)
+        self.activity_type_counts[activity_type] += 1
+        self.user_activity_counts[user_id] += 1
+        self.user_activity_types[user_id].add(activity_type)
+        self.activity_type_users[activity_type].add(user_id)
+        
+        # Invalidate cache since data changed
+        self._cache_invalid = True
+        if user_id in self.user_activity_summaries_cache:
+            del self.user_activity_summaries_cache[user_id]
     
     def add_activities_batch(self, activities: List[Dict]):
-        """Add multiple activity records."""
+        """Add multiple activity records with optimized batch processing."""
         for activity in activities:
             self.add_activity(
                 activity['user_id'],
@@ -30,102 +59,99 @@ class UserActivityAnalyzer:
             )
     
     def get_user_activity_count(self, user_id: int) -> int:
-        """Get total activity count for a specific user."""
-        count = 0
-        for activity in self.activities:
-            if activity['user_id'] == user_id:
-                count += 1
-        return count
+        """Get total activity count for a specific user in O(1) time."""
+        return self.user_activity_counts.get(user_id, 0)
     
     def get_activity_type_count(self, activity_type: str) -> int:
-        """Get total count for a specific activity type."""
-        count = 0
-        for activity in self.activities:
-            if activity['activity_type'] == activity_type:
-                count += 1
-        return count
+        """Get total count for a specific activity type in O(1) time."""
+        return self.activity_type_counts.get(activity_type, 0)
     
     def get_user_activity_types(self, user_id: int) -> List[str]:
-        """Get list of unique activity types for a user."""
-        types = []
-        for activity in self.activities:
-            if activity['user_id'] == user_id:
-                if activity['activity_type'] not in types:
-                    types.append(activity['activity_type'])
-        return types
+        """Get list of unique activity types for a user in O(1) time."""
+        return list(self.user_activity_types.get(user_id, set()))
     
     def get_top_active_users(self, limit: int = 10) -> List[Tuple[int, int]]:
-        """Get top N users by activity count."""
-        user_counts = {}
-        for activity in self.activities:
-            user_id = activity['user_id']
-            if user_id not in user_counts:
-                user_counts[user_id] = 0
-            user_counts[user_id] += 1
+        """Get top N users by activity count using efficient heap operations."""
+        if not self.user_activity_counts:
+            return []
+        
+        # Use heap to get top N users efficiently (O(n log k) where k = limit)
+        heap = []
+        for user_id, count in self.user_activity_counts.items():
+            if len(heap) < limit:
+                heapq.heappush(heap, (count, -user_id))
+            else:
+                heapq.heappushpop(heap, (count, -user_id))
         
-        # Sort by count descending, then by user_id ascending
-        sorted_users = sorted(
-            user_counts.items(),
-            key=lambda x: (-x[1], x[0])
-        )
-        return sorted_users[:limit]
+        # Convert heap to sorted result
+        result = [(-user_id, count) for count, user_id in sorted(heap, reverse=True)]
+        return result
     
     def get_activity_type_distribution(self) -> Dict[str, int]:
-        """Get distribution of activity types."""
-        distribution = {}
-        for activity in self.activities:
-            activity_type = activity['activity_type']
-            if activity_type not in distribution:
-                distribution[activity_type] = 0
-            distribution[activity_type] += 1
-        return distribution
+        """Get distribution of activity types in O(1) time."""
+        return dict(self.activity_type_counts)
     
     def get_users_by_activity_type(self, activity_type: str) -> List[int]:
-        """Get list of user IDs who performed a specific activity type."""
-        user_ids = []
-        for activity in self.activities:
-            if activity['activity_type'] == activity_type:
-                if activity['user_id'] not in user_ids:
-                    user_ids.append(activity['user_id'])
-        return user_ids
+        """Get list of user IDs who performed a specific activity type in O(1) time."""
+        users_set = self.activity_type_users.get(activity_type, set())
+        return sorted(users_set)
     
     def get_user_activity_summary(self, user_id: int) -> Dict:
-        """Get comprehensive summary for a specific user."""
-        summary = {
-            'user_id': user_id,
-            'total_activities': 0,
-            'activity_types': [],
-            'activity_type_counts': {}
-        }
+        """Get comprehensive summary for a specific user with caching."""
+        # Return cached result if available
+        if user_id in self.user_activity_summaries_cache:
+            return self.user_activity_summaries_cache[user_id]
         
-        for activity in self.activities:
-            if activity['user_id'] == user_id:
-                summary['total_activities'] += 1
-                activity_type = activity['activity_type']
-                if activity_type not in summary['activity_types']:
-                    summary['activity_types'].append(activity_type)
-                if activity_type not in summary['activity_type_counts']:
-                    summary['activity_type_counts'][activity_type] = 0
-                summary['activity_type_counts'][activity_type] += 1
+        # Compute summary efficiently using indexes
+        user_activities = self.user_activities.get(user_id, [])
+        if not user_activities:
+            summary = {
+                'user_id': user_id,
+                'total_activities': 0,
+                'activity_types': [],
+                'activity_type_counts': {}
+            }
+        else:
+            # Count activity types for this user
+            activity_type_counts = Counter()
+            for activity in user_activities:
+                activity_type_counts[activity['activity_type']] += 1
+            
+            summary = {
+                'user_id': user_id,
+                'total_activities': self.user_activity_counts.get(user_id, 0),
+                'activity_types': list(self.user_activity_types.get(user_id, set())),
+                'activity_type_counts': dict(activity_type_counts)
+            }
         
+        # Cache the result
+        self.user_activity_summaries_cache[user_id] = summary
         return summary
     
     def get_all_users_summary(self) -> Dict[int, Dict]:
-        """Get summary for all users."""
-        summaries = {}
-        user_ids = []
+        """Get summary for all users with caching."""
+        # Return cached result if available and valid
+        if self.all_users_summary_cache is not None and not self._cache_invalid:
+            return self.all_users_summary_cache
         
-        # Collect all unique user IDs
-        for activity in self.activities:
-            if activity['user_id'] not in user_ids:
-                user_ids.append(activity['user_id'])
-        
-        # Generate summary for each user
-        for user_id in user_ids:
+        # Compute summaries for all users efficiently
+        summaries = {}
+        for user_id in self.user_activity_counts.keys():
             summaries[user_id] = self.get_user_activity_summary(user_id)
         
+        # Cache the result
+        self.all_users_summary_cache = summaries
+        self._cache_invalid = False
         return summaries
     
     def clear(self):
-        """Clear all activities."""
-        self.activities = []
\ No newline at end of file
+        """Clear all activities and reset indexes."""
+        self.activities = []
+        self.user_activities.clear()
+        self.activity_type_counts.clear()
+        self.user_activity_counts.clear()
+        self.user_activity_types.clear()
+        self.activity_type_users.clear()
+        self.user_activity_summaries_cache.clear()
+        self.all_users_summary_cache = None
+        self._cache_invalid = False
\ No newline at end of file
