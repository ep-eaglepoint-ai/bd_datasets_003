{
    "instance_id": "SGEF9A",
    "problem_statement": "The notification service webhook delivery is failing silently in production. Downstream services report receiving duplicate payloads when network timeouts trigger uncontrolled retries, and there's no way to verify payload authenticity since signatures are missing. When a popular endpoint goes down, all pending retries fire simultaneously causing cascading failures across the infrastructure. The async database queries use synchronous patterns that block the event loop, and scheduled retry tasks crash because they reference database sessions that closed after the parent request completed. Health metrics show 100% success rate despite obvious failures because the scoring algorithm corrupts its own counters. Core implementation is in delivery.py, signatures.py, and retry.py with API routes in webhooks.py.",
    "base_commit": "repository_before/",
    "test_patch": "tests/",
    "github_url": "https://github.com/ep-eaglepoint-ai/bd_datasets_003/tree/main/sgef9a-webhook-delivery-system",
    "environment_setup": "Dockerfile",
    "FAIL_TO_PASS": [
        "tests/test_webhooks.py::TestSignatureGeneration::test_generate_secret_key_returns_string",
        "tests/test_webhooks.py::TestSignatureGeneration::test_generate_secret_key_is_unique",
        "tests/test_webhooks.py::TestSignatureGeneration::test_generate_secret_key_has_sufficient_length",
        "tests/test_webhooks.py::TestSignatureGeneration::test_generate_signature_format",
        "tests/test_webhooks.py::TestSignatureGeneration::test_signature_changes_with_different_timestamps",
        "tests/test_webhooks.py::TestSignatureGeneration::test_signature_changes_with_payload",
        "tests/test_webhooks.py::TestSignatureGeneration::test_signature_changes_with_secret_key",
        "tests/test_webhooks.py::TestSignatureGeneration::test_format_signature_header",
        "tests/test_webhooks.py::TestSignatureGeneration::test_parse_signature_header",
        "tests/test_webhooks.py::TestSignatureGeneration::test_parse_signature_header_invalid_format",
        "tests/test_webhooks.py::TestSignatureGeneration::test_verify_signature_valid",
        "tests/test_webhooks.py::TestSignatureGeneration::test_verify_signature_invalid_secret",
        "tests/test_webhooks.py::TestSignatureGeneration::test_verify_signature_expired_timestamp",
        "tests/test_webhooks.py::TestSignatureGeneration::test_verify_signature_future_timestamp",
        "tests/test_webhooks.py::TestSignatureGeneration::test_verify_signature_tampered_payload",
        "tests/test_webhooks.py::TestSignatureGeneration::test_create_signed_payload",
        "tests/test_webhooks.py::TestExponentialBackoff::test_exponential_delay_sequence",
        "tests/test_webhooks.py::TestExponentialBackoff::test_exponential_delay_custom_base",
        "tests/test_webhooks.py::TestExponentialBackoff::test_exponential_delay_invalid_attempt",
        "tests/test_webhooks.py::TestJitter::test_jitter_bidirectional",
        "tests/test_webhooks.py::TestJitter::test_jitter_range",
        "tests/test_webhooks.py::TestJitter::test_jitter_zero_delay",
        "tests/test_webhooks.py::TestRetryDelay::test_retry_delay_sequences",
        "tests/test_webhooks.py::TestRetryDelay::test_get_next_retry_time",
        "tests/test_webhooks.py::TestRetryDelay::test_should_retry",
        "tests/test_webhooks.py::TestRetryDelay::test_should_retry_custom_max",
        "tests/test_webhooks.py::TestWebhookModel::test_webhook_creation",
        "tests/test_webhooks.py::TestWebhookModel::test_webhook_default_values",
        "tests/test_webhooks.py::TestWebhookModel::test_webhook_repr",
        "tests/test_webhooks.py::TestDeliveryAttemptModel::test_delivery_attempt_creation",
        "tests/test_webhooks.py::TestDeliveryAttemptModel::test_delivery_attempt_default_values",
        "tests/test_webhooks.py::TestDeliveryAttemptModel::test_delivery_status_values",
        "tests/test_webhooks.py::TestWebhookHealthModel::test_webhook_health_creation",
        "tests/test_webhooks.py::TestWebhookHealthModel::test_webhook_health_default_score",
        "tests/test_webhooks.py::TestHealthScoring::test_initial_health_score",
        "tests/test_webhooks.py::TestHealthScoring::test_health_score_after_failures",
        "tests/test_webhooks.py::TestHealthScoring::test_health_score_recovery",
        "tests/test_webhooks.py::TestIdempotency::test_idempotency_key_scope",
        "tests/test_webhooks.py::TestIdempotency::test_same_idempotency_key_same_webhook",
        "tests/test_webhooks.py::TestIdempotency::test_idempotency_key_allows_different_webhooks",
        "tests/test_webhooks.py::TestPayloadSize::test_default_payload_limit",
        "tests/test_webhooks.py::TestPayloadSize::test_small_payload_under_limit",
        "tests/test_webhooks.py::TestPayloadSize::test_large_payload_over_limit",
        "tests/test_webhooks.py::TestGracefulShutdown::test_shutdown_preserves_retry_state",
        "tests/test_webhooks.py::TestGracefulShutdown::test_shutdown_handles_in_flight",
        "tests/test_webhooks.py::TestConstants::test_default_max_attempts",
        "tests/test_webhooks.py::TestConstants::test_default_base_delay",
        "tests/test_webhooks.py::TestConstants::test_default_jitter_range",
        "tests/test_webhooks.py::TestConstants::test_exponential_backoff_off_by_one",
        "tests/test_webhooks.py::TestSecretKeyImplementation::test_generate_secret_key_uses_secrets_module",
        "tests/test_webhooks.py::TestSecretKeyImplementation::test_generate_secret_key_not_uuid",
        "tests/test_webhooks.py::TestSignatureRawBytes::test_signature_input_uses_raw_bytes",
        "tests/test_webhooks.py::TestSignatureRawBytes::test_signature_with_binary_payload",
        "tests/test_webhooks.py::TestConstantTimeComparison::test_verify_signature_uses_compare_digest",
        "tests/test_webhooks.py::TestConstantTimeComparison::test_verify_signature_returns_boolean",
        "tests/test_webhooks.py::TestDatabaseSessionSafety::test_scheduled_retry_creates_own_session",
        "tests/test_webhooks.py::TestDatabaseSessionSafety::test_session_closed_after_processing",
        "tests/test_webhooks.py::TestAsyncSQLAlchemyStyle::test_delivery_module_uses_select_statements",
        "tests/test_webhooks.py::TestAsyncSQLAlchemyStyle::test_query_returns_scalar_one_or_none",
        "tests/test_webhooks.py::TestPayloadSizeValidation::test_payload_size_middleware_exists",
        "tests/test_webhooks.py::TestPayloadSizeValidation::test_middleware_rejects_large_payload",
        "tests/test_webhooks.py::TestPayloadSizeValidation::test_delivery_attempt_validates_size_early",
        "tests/test_webhooks.py::TestManualRetryValidation::test_retry_endpoint_validates_status",
        "tests/test_webhooks.py::TestManualRetryValidation::test_retry_message_for_success",
        "tests/test_webhooks.py::TestManualRetryValidation::test_retry_allows_failed_deliveries",
        "tests/test_webhooks.py::TestGracefulShutdownImplementation::test_stop_scheduler_waits_for_in_flight",
        "tests/test_webhooks.py::TestGracefulShutdownImplementation::test_shutdown_persists_retry_records",
        "tests/test_webhooks.py::TestGracefulShutdownImplementation::test_scheduler_shutdown_called",
        "tests/test_webhooks.py::TestHealthScoreEMA::test_ema_weights_recent_results",
        "tests/test_webhooks.py::TestHealthScoreEMA::test_recovery_with_successes",
        "tests/test_webhooks.py::TestHealthScoreEMA::test_failure_degrades_health",
        "tests/test_webhooks.py::TestIdempotencyConstraintIntegration::test_same_idempotency_key_different_webhooks_allowed",
        "tests/test_webhooks.py::TestIdempotencyConstraintIntegration::test_same_idempotency_key_same_webhook_raises",
        "tests/test_webhooks.py::TestIdempotencyConstraintIntegration::test_idempotency_prevents_duplicate_processing",
        "tests/test_webhooks.py::TestWebhookModelIntegration::test_create_webhook_with_secret_key",
        "tests/test_webhooks.py::TestWebhookModelIntegration::test_webhook_cascade_delete",
        "tests/test_webhooks.py::TestHealthScoreIntegration::test_health_score_ema_update",
        "tests/test_webhooks.py::TestRetryLogicIntegration::test_retry_scheduling_creates_new_attempt",
        "tests/test_webhooks.py::TestRetryLogicIntegration::test_retry_exponential_backoff_times",
        "tests/test_webhooks.py::TestSignatureIntegration::test_signature_round_trip",
        "tests/test_webhooks.py::TestSignatureIntegration::test_signature_tampering_detected",
        "tests/test_webhooks.py::TestSignatureIntegration::test_wrong_secret_rejected"
    ],
    "PASS_TO_PASS": []
}
