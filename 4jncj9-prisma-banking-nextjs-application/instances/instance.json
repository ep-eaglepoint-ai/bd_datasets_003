{
  "instance_id": "4JNCJ9",
  "problem_statement": "Fullstack development of a financial ledger system with strict state consistency. This involves building a React interface and a Prisma-backed API that enforces multi-stage validation within an atomic database transaction to prevent over-refunding during high-concurrency admin actions.",
  "base_commit": "repository_before/",
  "test_patch": "tests/",
  "github_url": "https://github.com/ep-eaglepoint-ai/bd_datasets_003/tree/main/4jncj9-prisma-banking-nextjs-application",
  "environment_setup": "Dockerfile",
  "FAIL_TO_PASS": [],
  "PASS_TO_PASS": [
    "refund-service.test.ts::Refund Service - Requirement 3: Fiscal Consistency Rules::validateRefundAmount::should accept valid positive amounts",
    "refund-service.test.ts::Refund Service - Requirement 3: Fiscal Consistency Rules::validateRefundAmount::should reject zero amount",
    "refund-service.test.ts::Refund Service - Requirement 3: Fiscal Consistency Rules::validateRefundAmount::should reject negative amounts",
    "refund-service.test.ts::Refund Service - Requirement 3: Fiscal Consistency Rules::validateRefundAmount::should reject invalid number formats",
    "refund-service.test.ts::Refund Service - Requirement 3: Fiscal Consistency Rules::calculateTotalRefunded::should calculate sum of refunds correctly",
    "refund-service.test.ts::Refund Service - Requirement 3: Fiscal Consistency Rules::calculateTotalRefunded::should return zero for empty refunds array",
    "refund-service.test.ts::Refund Service - Requirement 3: Fiscal Consistency Rules::calculateTotalRefunded::should handle Decimal type amounts",
    "refund-service.test.ts::Refund Service - Requirement 3: Fiscal Consistency Rules::calculateRemainingBalance::should calculate remaining balance correctly",
    "refund-service.test.ts::Refund Service - Requirement 3: Fiscal Consistency Rules::calculateRemainingBalance::should return zero when fully refunded",
    "refund-service.test.ts::Refund Service - Requirement 3: Fiscal Consistency Rules::calculateRemainingBalance::should return full amount when no refunds",
    "refund-service.test.ts::Refund Service - Requirement 3: Fiscal Consistency Rules::determineTransactionStatus::should return SETTLED when no refunds",
    "refund-service.test.ts::Refund Service - Requirement 3: Fiscal Consistency Rules::determineTransactionStatus::should return PARTIALLY_REFUNDED for partial refunds",
    "refund-service.test.ts::Refund Service - Requirement 3: Fiscal Consistency Rules::determineTransactionStatus::should return REFUNDED when fully refunded",
    "refund-service.test.ts::Refund Service - Requirement 3: Fiscal Consistency Rules::validateRefundAgainstBalance - Sum(All Refunds) ≤ Original Amount::should accept refund within balance",
    "refund-service.test.ts::Refund Service - Requirement 3: Fiscal Consistency Rules::validateRefundAgainstBalance - Sum(All Refunds) ≤ Original Amount::should accept refund equal to balance",
    "refund-service.test.ts::Refund Service - Requirement 3: Fiscal Consistency Rules::validateRefundAgainstBalance - Sum(All Refunds) ≤ Original Amount::should reject refund exceeding balance",
    "refund-service.test.ts::Refund Service - Requirement 5: Data Type Precision::Decimal arithmetic precision::should handle floating point precision correctly",
    "refund-service.test.ts::Refund Service - Requirement 5: Data Type Precision::Decimal arithmetic precision::should handle many small refunds without precision loss",
    "refund-service.test.ts::Refund Service - Requirement 5: Data Type Precision::Decimal arithmetic precision::should handle large amounts with cents precision",
    "refund-service.test.ts::Refund Service - Requirement 5: Data Type Precision::Decimal arithmetic precision::should maintain precision through multiple calculations",
    "refund-service.test.ts::Refund Service - Request Validation::validateRefundRequest::should accept valid request",
    "refund-service.test.ts::Refund Service - Request Validation::validateRefundRequest::should reject missing transaction ID",
    "refund-service.test.ts::Refund Service - Request Validation::validateRefundRequest::should reject missing idempotency key",
    "refund-service.test.ts::Refund Service - Request Validation::validateRefundRequest::should reject invalid amount",
    "refund-service.test.ts::Refund Service - HTTP Status Codes::getHttpStatusForError::should return 400 for validation errors",
    "refund-service.test.ts::Refund Service - HTTP Status Codes::getHttpStatusForError::should return 404 for not found",
    "refund-service.test.ts::Refund Service - HTTP Status Codes::getHttpStatusForError::should return 409 for concurrent modification",
    "refund-service.test.ts::Refund Service - HTTP Status Codes::getHttpStatusForError::should return 422 for business rule violations",
    "refund-service.test.ts::Refund Service - HTTP Status Codes::getHttpStatusForError::should return 500 for internal errors",
    "atomic-transactions.test.ts::Atomic Transactions - Requirement 2::processRefundAtomic::should process refund successfully within transaction",
    "atomic-transactions.test.ts::Atomic Transactions - Requirement 2::processRefundAtomic::should verify balance before creating refund",
    "atomic-transactions.test.ts::Atomic Transactions - Requirement 2::processRefundAtomic::should atomically create refund AND update transaction",
    "atomic-transactions.test.ts::Atomic Transactions - Requirement 2::processRefundAtomic::should set status to REFUNDED when fully refunded",
    "atomic-transactions.test.ts::Atomic Transactions - Requirement 2::processRefundAtomic::should reject if transaction not found",
    "atomic-transactions.test.ts::Atomic Transactions - Requirement 2::processRefundAtomic::should reject if transaction already fully refunded",
    "atomic-transactions.test.ts::Atomic Transactions - Requirement 2::processRefundAtomic::should increment version on each update",
    "atomic-transactions.test.ts::Atomic Transaction Boundaries::should not partially update on validation failure",
    "atomic-transactions.test.ts::Atomic Transaction Boundaries::should calculate correct remaining balance with multiple prior refunds",
    "concurrency.test.ts::Concurrency - Requirement 4: Conflict Handling::Optimistic Locking::should reject request when version mismatch detected",
    "concurrency.test.ts::Concurrency - Requirement 4: Conflict Handling::Optimistic Locking::should succeed when version matches",
    "concurrency.test.ts::Concurrency - Requirement 4: Conflict Handling::Optimistic Locking::should proceed without version check when expectedVersion not provided",
    "concurrency.test.ts::Concurrency - Requirement 4: Conflict Handling::Stale Balance Problem::should detect when balance changed between read and write",
    "concurrency.test.ts::Idempotency - Requirement 7::Duplicate Request Prevention::should return existing refund for duplicate idempotency key",
    "concurrency.test.ts::Idempotency - Requirement 7::Duplicate Request Prevention::should allow different idempotency keys for same transaction",
    "concurrency.test.ts::Idempotency - Requirement 7::Duplicate Request Prevention::should use unique idempotency key check before balance validation",
    "concurrency.test.ts::Requirement 8: Concurrent Refund Requests::Simulated Concurrent Access::should handle race condition - only one request should succeed",
    "concurrency.test.ts::Requirement 8: Concurrent Refund Requests::Simulated Concurrent Access::should prevent total refunds exceeding transaction amount",
    "concurrency.test.ts::Requirement 8: Concurrent Refund Requests::Simulated Concurrent Access::should handle multiple sequential refunds correctly",
    "concurrency.test.ts::Requirement 8: Concurrent Refund Requests::Simulated Concurrent Access::should reject 5th refund after 4 x $25 refunds",
    "server-side-enforcement.test.ts::Server-Side Enforcement - Requirement 1::Prisma Module Markers::should have PRISMA_SERVER_ONLY marker set to true",
    "server-side-enforcement.test.ts::Server-Side Enforcement - Requirement 1::Prisma Module Markers::should NOT expose DATABASE_URL",
    "server-side-enforcement.test.ts::Server-Side Enforcement - Requirement 1::Prisma Module Markers::should have isServerSide utility function",
    "server-side-enforcement.test.ts::Server-Side Enforcement - Requirement 1::Client Component Isolation::should not import Prisma in TransactionCard component",
    "server-side-enforcement.test.ts::Server-Side Enforcement - Requirement 1::Client Component Isolation::should not import Prisma in RefundForm component",
    "server-side-enforcement.test.ts::Server-Side Enforcement - Requirement 1::Client Component Isolation::should not import Prisma in TransactionDashboard component",
    "server-side-enforcement.test.ts::Server-Side Enforcement - Requirement 1::Client Component Isolation::client components should have use client directive",
    "server-side-enforcement.test.ts::Server-Side Enforcement - Requirement 1::Server Actions Isolation::server actions should have use server directive",
    "server-side-enforcement.test.ts::Server-Side Enforcement - Requirement 1::Server Actions Isolation::server actions should import Prisma (server-side only)",
    "server-side-enforcement.test.ts::Client Bundle Verification - Requirement 10::Database Credentials Protection::should not have DATABASE_URL in environment accessible to tests",
    "server-side-enforcement.test.ts::Client Bundle Verification - Requirement 10::Database Credentials Protection::should have server-only check in prisma module",
    "server-side-enforcement.test.ts::Client Bundle Verification - Requirement 10::Database Credentials Protection::should configure Next.js to exclude Prisma from client bundle",
    "server-side-enforcement.test.ts::Client Bundle Verification - Requirement 10::Prisma Client Singleton Pattern::should use singleton pattern for development",
    "server-side-enforcement.test.ts::Client Bundle Verification - Requirement 10::Prisma Client Singleton Pattern::should have PrismaClient import only in server module",
    "server-side-enforcement.test.ts::API Routes Server-Side Only::API routes should import prisma from lib module",
    "server-side-enforcement.test.ts::API Routes Server-Side Only::API routes should NOT have use client directive",
    "error-handling.test.ts::Error Handling - Requirement 9::Error Message Generation::should have user-friendly error code for INVALID_AMOUNT",
    "error-handling.test.ts::Error Handling - Requirement 9::Error Message Generation::should have user-friendly error code for INSUFFICIENT_BALANCE",
    "error-handling.test.ts::Error Handling - Requirement 9::Error Message Generation::should have user-friendly error code for TRANSACTION_NOT_FOUND",
    "error-handling.test.ts::Error Handling - Requirement 9::Error Message Generation::should have user-friendly error code for CONCURRENT_MODIFICATION",
    "error-handling.test.ts::Error Handling - Requirement 9::Error Response Structure::should have consistent error structure",
    "error-handling.test.ts::Error Handling - Requirement 9::Error Response Structure::should work without optional details",
    "error-handling.test.ts::Error Handling - Requirement 9::Refund Amount Validation Errors::should return clear error for amount exceeding balance",
    "error-handling.test.ts::Error Handling - Requirement 9::Refund Amount Validation Errors::should return clear error for negative amount",
    "error-handling.test.ts::Error Handling - Requirement 9::Refund Amount Validation Errors::should return clear error for non-numeric amount",
    "error-handling.test.ts::Error Handling - Requirement 9::Concurrent Modification Errors::should provide version mismatch details",
    "error-handling.test.ts::Error Handling - Requirement 9::Error Handling in Components (Simulated)::should handle null/undefined errors gracefully",
    "error-handling.test.ts::Error Handling - Requirement 9::Error Handling in Components (Simulated)::should render all error types without throwing",
    "error-handling.test.ts::Error Handling - Requirement 9::Error Handling in Components (Simulated)::should handle unexpected error codes gracefully",
    "error-handling.test.ts::Error Display Verification::RefundForm component should have error display element",
    "error-handling.test.ts::Error Display Verification::RefundForm should catch and handle submission errors",
    "ui-state-sync.test.ts::UI State Synchronization - Requirement 6::revalidatePath Usage::should have revalidatePath imported in server actions",
    "ui-state-sync.test.ts::UI State Synchronization - Requirement 6::revalidatePath Usage::should call revalidatePath after successful refund",
    "ui-state-sync.test.ts::UI State Synchronization - Requirement 6::revalidatePath Usage::should revalidate both transaction list and detail pages",
    "ui-state-sync.test.ts::UI State Synchronization - Requirement 6::Server Actions Pattern::server actions file should export async functions",
    "ui-state-sync.test.ts::UI State Synchronization - Requirement 6::Server Actions Pattern::page should use server-side data fetching",
    "ui-state-sync.test.ts::UI State Synchronization - Requirement 6::Server Actions Pattern::page should pass server actions to client components",
    "ui-state-sync.test.ts::UI State Synchronization - Requirement 6::Dynamic Data Updates::page should be dynamically rendered",
    "ui-state-sync.test.ts::UI State Synchronization - Requirement 6::Dynamic Data Updates::dashboard should have refresh capability",
    "ui-state-sync.test.ts::UI State Synchronization - Requirement 6::useTransition for Loading States::RefundForm should use useTransition hook",
    "ui-state-sync.test.ts::UI State Synchronization - Requirement 6::useTransition for Loading States::RefundForm should show loading state during submission",
    "ui-state-sync.test.ts::Balance Display Updates::TransactionCard should display remaining balance",
    "ui-state-sync.test.ts::Balance Display Updates::TransactionWithBalance type should have computed balance fields",
    "ui-state-sync.test.ts::Balance Display Updates::refund-service should compute balance correctly"
  ]
}
