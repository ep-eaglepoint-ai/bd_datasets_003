{
    "instance_id": "H4A5L9",
    "problem_statement": "A link management platform needs URL shortening capabilities beyond basic CRUD operations. The current system stores links but lacks short code generation, expiry handling, click tracking, and duplicate prevention. Users need deterministic short codes derived from link IDs, optional custom codes with validation, normalized URL storage to prevent duplicates, configurable expiry with proper 410 responses, click analytics with deduplication, and rate limiting. The redirect endpoint must record clicks without adding latency. Core logic is in app.py and requirements.txt lists allowed dependencies",
    "base_commit": "repository_before/",
    "test_patch": "tests/",
    "github_url": "https://github.com/ep-eaglepoint-ai/bd_datasets_003/tree/main/h4a5l9-url-shortener-with-deterministic-encoding-and-click-analytics",
    "environment_setup": "Dockerfile",
    "FAIL_TO_PASS": [
        "tests/test_url_shortener.py::TestBase62Encoding::test_auto_generated_code_length",
        "tests/test_url_shortener.py::TestBase62Encoding::test_code_uses_base62_charset",
        "tests/test_url_shortener.py::TestBase62Encoding::test_deterministic_encoding_different_links",
        "tests/test_url_shortener.py::TestBase62Encoding::test_encoding_is_deterministic",
        "tests/test_url_shortener.py::TestCustomCodeValidation::test_custom_code_6_chars_accepted",
        "tests/test_url_shortener.py::TestCustomCodeValidation::test_custom_code_10_chars_accepted",
        "tests/test_url_shortener.py::TestCustomCodeValidation::test_custom_code_5_chars_rejected",
        "tests/test_url_shortener.py::TestCustomCodeValidation::test_custom_code_11_chars_rejected",
        "tests/test_url_shortener.py::TestCustomCodeValidation::test_custom_code_special_chars_rejected",
        "tests/test_url_shortener.py::TestCustomCodeValidation::test_custom_code_profanity_rejected",
        "tests/test_url_shortener.py::TestCustomCodeValidation::test_custom_code_profanity_case_insensitive",
        "tests/test_url_shortener.py::TestCustomCodeValidation::test_custom_code_profanity_substring",
        "tests/test_url_shortener.py::TestCustomCodeValidation::test_custom_code_duplicate_rejected",
        "tests/test_url_shortener.py::TestURLValidation::test_http_url_accepted",
        "tests/test_url_shortener.py::TestURLValidation::test_https_url_accepted",
        "tests/test_url_shortener.py::TestURLValidation::test_ftp_url_rejected",
        "tests/test_url_shortener.py::TestURLValidation::test_file_url_rejected",
        "tests/test_url_shortener.py::TestURLValidation::test_self_reference_rejected",
        "tests/test_url_shortener.py::TestURLNormalization::test_normalize_lowercase_scheme",
        "tests/test_url_shortener.py::TestURLNormalization::test_normalize_lowercase_host",
        "tests/test_url_shortener.py::TestURLNormalization::test_normalize_strip_http_default_port",
        "tests/test_url_shortener.py::TestURLNormalization::test_normalize_strip_https_default_port",
        "tests/test_url_shortener.py::TestURLNormalization::test_normalize_keep_non_default_port",
        "tests/test_url_shortener.py::TestURLNormalization::test_normalize_remove_trailing_slash",
        "tests/test_url_shortener.py::TestURLNormalization::test_normalize_sort_query_params",
        "tests/test_url_shortener.py::TestDuplicatePrevention::test_same_normalized_url_returns_existing",
        "tests/test_url_shortener.py::TestDuplicatePrevention::test_different_users_same_url_different_codes",
        "tests/test_url_shortener.py::TestDuplicatePrevention::test_custom_code_bypasses_duplicate_check",
        "tests/test_url_shortener.py::TestConfigurableExpiry::test_default_expiry_included",
        "tests/test_url_shortener.py::TestConfigurableExpiry::test_custom_expiry_7_days",
        "tests/test_url_shortener.py::TestConfigurableExpiry::test_custom_expiry_365_days",
        "tests/test_url_shortener.py::TestConfigurableExpiry::test_expiry_0_days_rejected",
        "tests/test_url_shortener.py::TestConfigurableExpiry::test_expiry_366_days_rejected",
        "tests/test_url_shortener.py::TestExpiredLinksReturn410::test_expired_link_returns_410",
        "tests/test_url_shortener.py::TestExpiredLinksReturn410::test_active_link_redirects_302",
        "tests/test_url_shortener.py::TestClickTracking::test_click_recorded_in_analytics",
        "tests/test_url_shortener.py::TestClickTracking::test_click_records_unique_visitor",
        "tests/test_url_shortener.py::TestClickDeduplication::test_duplicate_clicks_same_ip_deduplicated",
        "tests/test_url_shortener.py::TestClickDeduplication::test_deduplication_expires_after_30_seconds",
        "tests/test_url_shortener.py::TestAnalyticsEndpoint::test_analytics_endpoint_exists",
        "tests/test_url_shortener.py::TestAnalyticsEndpoint::test_analytics_includes_total_clicks",
        "tests/test_url_shortener.py::TestAnalyticsEndpoint::test_analytics_includes_unique_visitors",
        "tests/test_url_shortener.py::TestAnalyticsEndpoint::test_analytics_includes_clicks_by_day",
        "tests/test_url_shortener.py::TestAnalyticsEndpoint::test_analytics_includes_top_referrers",
        "tests/test_url_shortener.py::TestRateLimiting::test_rate_limit_100_links_enforced",
        "tests/test_url_shortener.py::TestRateLimiting::test_rate_limit_returns_429",
        "tests/test_url_shortener.py::TestAtomicConflicts::test_duplicate_custom_code_returns_409",
        "tests/test_url_shortener.py::TestAtomicConflicts::test_concurrent_custom_code_atomic"
    ],
    "PASS_TO_PASS": [
        "tests/test_url_shortener.py::TestBasicCRUD::test_create_link_returns_201",
        "tests/test_url_shortener.py::TestBasicCRUD::test_create_link_returns_id_and_code",
        "tests/test_url_shortener.py::TestBasicCRUD::test_list_links_returns_200",
        "tests/test_url_shortener.py::TestBasicCRUD::test_delete_link_returns_200",
        "tests/test_url_shortener.py::TestBasicCRUD::test_redirect_returns_302",
        "tests/test_url_shortener.py::TestBasicCRUD::test_nonexistent_link_returns_404",
        "tests/test_url_shortener.py::TestBasicCRUD::test_create_without_url_returns_400",
        "tests/test_url_shortener.py::TestBasicCRUD::test_delete_nonexistent_returns_404"
    ]
}